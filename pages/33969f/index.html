<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>2022 Review | 三行代码</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Web development, Frontend, JavaScript">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.c149dbaa.css" as="style"><link rel="preload" href="/assets/js/app.c17531b4.js" as="script"><link rel="preload" href="/assets/js/2.3e7b8786.js" as="script"><link rel="preload" href="/assets/js/85.7ef6ce1f.js" as="script"><link rel="prefetch" href="/assets/js/10.2234e2c8.js"><link rel="prefetch" href="/assets/js/100.42ab15ac.js"><link rel="prefetch" href="/assets/js/101.e6fef504.js"><link rel="prefetch" href="/assets/js/11.14461477.js"><link rel="prefetch" href="/assets/js/12.157d8dc0.js"><link rel="prefetch" href="/assets/js/13.a7890c3d.js"><link rel="prefetch" href="/assets/js/14.d0894eb7.js"><link rel="prefetch" href="/assets/js/15.bb14362f.js"><link rel="prefetch" href="/assets/js/16.e34746ec.js"><link rel="prefetch" href="/assets/js/17.ca83e363.js"><link rel="prefetch" href="/assets/js/18.9a14520a.js"><link rel="prefetch" href="/assets/js/19.ceb87610.js"><link rel="prefetch" href="/assets/js/20.0d0d893e.js"><link rel="prefetch" href="/assets/js/21.a2cae791.js"><link rel="prefetch" href="/assets/js/22.9bd77fe5.js"><link rel="prefetch" href="/assets/js/23.3ca57ee7.js"><link rel="prefetch" href="/assets/js/24.5df7731a.js"><link rel="prefetch" href="/assets/js/25.becd8254.js"><link rel="prefetch" href="/assets/js/26.21837df4.js"><link rel="prefetch" href="/assets/js/27.12585d76.js"><link rel="prefetch" href="/assets/js/28.4aff2d40.js"><link rel="prefetch" href="/assets/js/29.606a725e.js"><link rel="prefetch" href="/assets/js/3.953185bb.js"><link rel="prefetch" href="/assets/js/30.281826a9.js"><link rel="prefetch" href="/assets/js/31.3e0344fb.js"><link rel="prefetch" href="/assets/js/32.1ef62439.js"><link rel="prefetch" href="/assets/js/33.7f023c0c.js"><link rel="prefetch" href="/assets/js/34.ad479baf.js"><link rel="prefetch" href="/assets/js/35.dc52b883.js"><link rel="prefetch" href="/assets/js/36.a8a20daf.js"><link rel="prefetch" href="/assets/js/37.c33aae67.js"><link rel="prefetch" href="/assets/js/38.d458af07.js"><link rel="prefetch" href="/assets/js/39.668922f9.js"><link rel="prefetch" href="/assets/js/4.c115e727.js"><link rel="prefetch" href="/assets/js/40.dd259277.js"><link rel="prefetch" href="/assets/js/41.0685dabf.js"><link rel="prefetch" href="/assets/js/42.90bf1511.js"><link rel="prefetch" href="/assets/js/43.81710a1b.js"><link rel="prefetch" href="/assets/js/44.a20853a1.js"><link rel="prefetch" href="/assets/js/45.a0a76abf.js"><link rel="prefetch" href="/assets/js/46.95e74803.js"><link rel="prefetch" href="/assets/js/47.ba80bcea.js"><link rel="prefetch" href="/assets/js/48.ddc3aede.js"><link rel="prefetch" href="/assets/js/49.3040c348.js"><link rel="prefetch" href="/assets/js/5.7d5490f2.js"><link rel="prefetch" href="/assets/js/50.9e45cd68.js"><link rel="prefetch" href="/assets/js/51.3a5eacd8.js"><link rel="prefetch" href="/assets/js/52.2a50b570.js"><link rel="prefetch" href="/assets/js/53.8059a783.js"><link rel="prefetch" href="/assets/js/54.3e54252d.js"><link rel="prefetch" href="/assets/js/55.50b455ff.js"><link rel="prefetch" href="/assets/js/56.43d7e6b7.js"><link rel="prefetch" href="/assets/js/57.dc8bbc95.js"><link rel="prefetch" href="/assets/js/58.c0b76901.js"><link rel="prefetch" href="/assets/js/59.28ec02f3.js"><link rel="prefetch" href="/assets/js/6.8749434b.js"><link rel="prefetch" href="/assets/js/60.001ff532.js"><link rel="prefetch" href="/assets/js/61.b9d6b6db.js"><link rel="prefetch" href="/assets/js/62.81245a10.js"><link rel="prefetch" href="/assets/js/63.8332ae73.js"><link rel="prefetch" href="/assets/js/64.357b1d40.js"><link rel="prefetch" href="/assets/js/65.947a76a1.js"><link rel="prefetch" href="/assets/js/66.59c57da7.js"><link rel="prefetch" href="/assets/js/67.02d525a5.js"><link rel="prefetch" href="/assets/js/68.808b1fd2.js"><link rel="prefetch" href="/assets/js/69.703935c0.js"><link rel="prefetch" href="/assets/js/7.7aa8fb69.js"><link rel="prefetch" href="/assets/js/70.9c6a4dbf.js"><link rel="prefetch" href="/assets/js/71.955445a1.js"><link rel="prefetch" href="/assets/js/72.5ae810be.js"><link rel="prefetch" href="/assets/js/73.40b461f0.js"><link rel="prefetch" href="/assets/js/74.eb777c24.js"><link rel="prefetch" href="/assets/js/75.cf25358f.js"><link rel="prefetch" href="/assets/js/76.f2b37de5.js"><link rel="prefetch" href="/assets/js/77.5db6e6e5.js"><link rel="prefetch" href="/assets/js/78.2fcfdf72.js"><link rel="prefetch" href="/assets/js/79.501697d3.js"><link rel="prefetch" href="/assets/js/8.6aee0b06.js"><link rel="prefetch" href="/assets/js/80.1c75a4c9.js"><link rel="prefetch" href="/assets/js/81.eb9a1728.js"><link rel="prefetch" href="/assets/js/82.d18239f7.js"><link rel="prefetch" href="/assets/js/83.b4360fed.js"><link rel="prefetch" href="/assets/js/84.206370c0.js"><link rel="prefetch" href="/assets/js/86.711072c9.js"><link rel="prefetch" href="/assets/js/87.8db4bcfa.js"><link rel="prefetch" href="/assets/js/88.d23ba184.js"><link rel="prefetch" href="/assets/js/89.9cd79b2e.js"><link rel="prefetch" href="/assets/js/9.9d5551f6.js"><link rel="prefetch" href="/assets/js/90.1000b730.js"><link rel="prefetch" href="/assets/js/91.0c90c597.js"><link rel="prefetch" href="/assets/js/92.e6b9a689.js"><link rel="prefetch" href="/assets/js/93.3ba18b6b.js"><link rel="prefetch" href="/assets/js/94.8eb468d2.js"><link rel="prefetch" href="/assets/js/95.7b5e4261.js"><link rel="prefetch" href="/assets/js/96.6d0c67f2.js"><link rel="prefetch" href="/assets/js/97.98f63f27.js"><link rel="prefetch" href="/assets/js/98.f7445085.js"><link rel="prefetch" href="/assets/js/99.f9a1abbd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c149dbaa.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://cdn.jsdelivr.net/gh/artoriaschan/image-hosting@master/blog/20200105104632.15vzpyhnwvuk.png" alt="三行代码" class="logo"> <span class="site-name can-hide">三行代码</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/d533f9/" class="nav-link">基础知识</a></li><li class="dropdown-subitem"><a href="/pages/6d91ad/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/pages/c5fd6c/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/pages/8da03e/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/pages/28de07/" class="nav-link">杂谈</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/vue2/" class="nav-link">Vue 2 源码解析</a></li><li class="dropdown-subitem"><a href="/note/vue3/" class="nav-link">Vue 3 源码解析</a></li><li class="dropdown-subitem"><a href="/note/react17/" class="nav-link">React 17 源码解析</a></li><li class="dropdown-subitem"><a href="/note/vite/" class="nav-link">Vite 源码解析</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/9f15c1a281d8bedb/" class="nav-link">Stylus</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/33969f/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Interview</a></li><li class="dropdown-item"><h4>Rust</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/rust-notes/" class="nav-link">Rust 学习笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="转载" class="dropdown-title"><a href="/reship/" class="link-title">转载</a> <span class="title" style="display:none;">转载</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/ed5303/" class="nav-link">前端精读</a></li></ul></div></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/artoriaschan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/artoriaschan/image-hosting@master/blog/WechatIMG1.6c8n1rhrpqg0.jpeg"> <div class="blogger-info"><h3>陈先生</h3> <span>☭ 让我们一起粉碎资本主义吧， 达瓦里氏！☭</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/d533f9/" class="nav-link">基础知识</a></li><li class="dropdown-subitem"><a href="/pages/6d91ad/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/pages/c5fd6c/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/pages/8da03e/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/pages/28de07/" class="nav-link">杂谈</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/vue2/" class="nav-link">Vue 2 源码解析</a></li><li class="dropdown-subitem"><a href="/note/vue3/" class="nav-link">Vue 3 源码解析</a></li><li class="dropdown-subitem"><a href="/note/react17/" class="nav-link">React 17 源码解析</a></li><li class="dropdown-subitem"><a href="/note/vite/" class="nav-link">Vite 源码解析</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/9f15c1a281d8bedb/" class="nav-link">Stylus</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/33969f/" aria-current="page" class="nav-link router-link-exact-active router-link-active">Interview</a></li><li class="dropdown-item"><h4>Rust</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/rust-notes/" class="nav-link">Rust 学习笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="转载" class="dropdown-title"><a href="/reship/" class="link-title">转载</a> <span class="title" style="display:none;">转载</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/ed5303/" class="nav-link">前端精读</a></li></ul></div></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/artoriaschan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术文档</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>GitHub技巧</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Nodejs</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Rust</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>面试</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/33969f/" aria-current="page" class="active sidebar-link">2022 Review</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/33969f/#前言" class="sidebar-link">前言</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#大纲" class="sidebar-link">大纲</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#基础" class="sidebar-link">基础</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/33969f/#html" class="sidebar-link">HTML</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#css" class="sidebar-link">CSS</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#js" class="sidebar-link">JS</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#ts" class="sidebar-link">TS</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/33969f/#网络协议" class="sidebar-link">网络协议</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/33969f/#tcp" class="sidebar-link">TCP</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#http协议" class="sidebar-link">HTTP协议</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#dns协议" class="sidebar-link">DNS协议</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#cdn" class="sidebar-link">CDN</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/33969f/#浏览器" class="sidebar-link">浏览器</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/33969f/#常见概念" class="sidebar-link">常见概念</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#渲染流程" class="sidebar-link">渲染流程</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#v8" class="sidebar-link">V8</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#从输入url到页面展示出来-浏览器都经历了什么步骤" class="sidebar-link">从输入URL到页面展示出来，浏览器都经历了什么步骤</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/33969f/#框架" class="sidebar-link">框架</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/33969f/#vue" class="sidebar-link">Vue</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#vue3" class="sidebar-link">Vue3</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#ssr" class="sidebar-link">SSR</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#react" class="sidebar-link">React</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/33969f/#工程化" class="sidebar-link">工程化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/33969f/#编译工具" class="sidebar-link">编译工具</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#打包工具" class="sidebar-link">打包工具</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#bundleless" class="sidebar-link">bundleless</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/33969f/#性能优化" class="sidebar-link">性能优化</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/33969f/#网络优化" class="sidebar-link">网络优化</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#体积优化" class="sidebar-link">体积优化</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#加载优化" class="sidebar-link">加载优化</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#代码优化" class="sidebar-link">代码优化</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/33969f/#前端安全" class="sidebar-link">前端安全</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/33969f/#xss" class="sidebar-link">XSS</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#csrf" class="sidebar-link">CSRF</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/33969f/#node-js" class="sidebar-link">Node.js</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/33969f/#基本概念及原理" class="sidebar-link">基本概念及原理</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#常用模块" class="sidebar-link">常用模块</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#web-框架" class="sidebar-link">Web 框架</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/33969f/#其他" class="sidebar-link">其他</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/33969f/#面向对象的特征" class="sidebar-link">面向对象的特征</a></li><li class="sidebar-sub-header"><a href="/pages/33969f/#为什么堆比栈大" class="sidebar-link">为什么堆比栈大</a></li></ul></li></ul></li><li><a href="/pages/fe34cd/" class="sidebar-link">2022 Interview</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/technology" title="技术-目录页" data-v-1cd794fe>技术</a></li> <li data-v-1cd794fe><a href="/technology/#面试" title="技术#面试" data-v-1cd794fe>面试</a></li> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/artoriaschan" target="_blank" title="作者" class="beLink" data-v-1cd794fe>Artorias Chan</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2022-02-28</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><!---->
          2022 Review
        </h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="前言"><a href="#前言" class="header-anchor">#</a> 前言</h2> <p>加油呗
</p> <h2 id="大纲"><a href="#大纲" class="header-anchor">#</a> 大纲</h2> <p><img src="https://cdn.jsdelivr.net/gh/artoriaschan/image-hosting@master/blog/%E5%A4%A7%E7%BA%B2.3ttblao9ahw0.webp" alt="大纲"></p> <h2 id="基础"><a href="#基础" class="header-anchor">#</a> 基础</h2> <h3 id="html"><a href="#html" class="header-anchor">#</a> HTML</h3> <ul><li>HTML5 语义化标签
<ul><li>语义化标签： <code>header</code>，<code>nav</code>，<code>main</code>，<code>article</code>，<code>section</code>，<code>aside</code>，<code>footer</code></li> <li>语义化意味着顾名思义，HTML5的语义化指的是合理正确的使用语义化的标签来创建页面结构，而不是滥用div。</li> <li>语义化的优点有:
<ul><li>代码结构清晰，易于阅读，利于开发和维护</li> <li>方便其他设备解析（如屏幕阅读器）根据语义渲染网页。</li> <li>有利于搜索引擎优化（SEO），搜索引擎爬虫会根据不同的标签来赋予不同的权重</li></ul></li></ul></li> <li>script标签中的 <code>defer</code>和<code>async</code>属性
<ul><li>相同点：
<ul><li>都是<code>异步加载资源</code></li></ul></li> <li>区别：
<ul><li><code>async</code>属性是异步加载，<code>加载完成后立即执行</code>，标记为async的脚本<code>不保证按照出现顺序</code>执行</li> <li>标记为<code>defer</code>属性的脚本会<code>等到HTML解析完成后再执行</code>，执行顺序就是<code>按照出现顺序</code></li></ul></li></ul></li></ul> <h3 id="css"><a href="#css" class="header-anchor">#</a> CSS</h3> <ul><li><p>CSS 盒模型</p> <ul><li>box-sizing: border-box, content-box</li> <li>分为标准盒模型和IE盒模型，在标准盒子模型中，width 指 content 部分的宽度，在IE盒子模型中，width 表示 content+padding+border 这三个部分的宽度</li> <li>box-sizing:content-box 表示标准盒子模型，box-sizing:border-box 表示的是IE盒子模型</li></ul></li> <li><p>flex布局</p> <ul><li>常用属性：
<ul><li><code>flex-direction</code>: 主轴方向，默认值为<code>row</code>，<code>column</code>为垂直方向排列</li> <li><code>justify-content</code>：主轴方向排列方式，可选属性为：<code>flex-start</code>，<code>flex-end</code>，<code>center</code>，<code>space-between</code>，<code>space-around</code></li> <li><code>align-items</code>：副轴方向排列方式，可选属性与<code>justify-content</code>相同</li> <li><code>flex-wrap</code>：换行规则，可选属性为：<code>nowrap</code>，<code>wrap</code>，<code>wrap-reverse</code></li> <li><code>flex-grow</code>：定义项目的放大比例，默认为1</li> <li><code>flex-shrink</code>：定义项目的缩放比例，定义为0则代表不缩放</li> <li><code>flex-basic</code>：定义再分配多余空间，项目占用的空间</li> <li><code>flex</code>：是<code>flex-grow</code>，<code>flex-shrink</code>，<code>flex-basic</code>的简写，默认为<code>0 1 auto</code></li> <li><code>order</code>：定义项目的排列顺序，顺序越小，排列越靠前，默认为0</li></ul></li></ul></li> <li><p>三栏布局</p> <ul><li>圣杯布局</li></ul> <div data-config="" data-type="vanilla" data-code="%3Cstyle%3E%0A.holy-grail-header%20%7B%0A%20%20%20%20background-color%3A%20blue%3B%0A%7D%0A.holy-grail-main%20%7B%0A%20%20%20%20background-color%3A%20orange%3B%0A%20%20%20%20padding%3A%200%20100px%3B%20%2F*%20%E5%B7%A6%E5%8F%B3%E4%B8%A4%E8%BE%B9%E7%9A%84padding%E6%9D%A5%E6%94%BE%E7%BD%AEleft%E5%92%8Cright%E5%8C%BA%E5%9F%9F%20*%2F%0A%7D%0A.holy-grail-main-left%2C.holy-grail-main-center%2C.holy-grail-main-right%20%7B%0A%20%20%20%20float%3A%20left%3B%0A%7D%0A.holy-grail-main-center%20%7B%0A%20%20%20%20background-color%3A%20purple%3B%0A%20%20%20%20width%3A%20100%25%3B%20%2F*%20%E8%BF%99%E4%BC%9A%E6%8A%8Aleft%E5%92%8Cright%E6%8C%A4%E5%88%B0%E4%B8%8B%E4%B8%80%E8%A1%8C%20*%2F%0A%7D%0A.holy-grail-main-left%20%7B%0A%20%20%20%20background-color%3A%20red%3B%0A%20%20%20%20width%3A%20100px%3B%0A%20%20%20%20margin-left%3A%20-100%25%3B%20%2F*%20%E6%8A%8Aleft%E7%A7%BB%E5%8A%A8%E5%88%B0%E5%92%8Ccenter%E5%90%8C%E4%B8%80%E8%A1%8C%E5%B9%B6%E4%B8%94%E5%B7%A6%E8%BE%B9%E5%AF%B9%E9%BD%90%20*%2F%0A%20%20%20%20position%3A%20relative%3B%0A%20%20%20%20left%3A%20-100px%3B%20%2F*%20%E5%86%8D%E5%90%91%E5%B7%A6%E7%A7%BB%E5%8A%A8%E5%88%B0main%E7%9A%84padding%E5%8C%BA%E5%9F%9F%2C%E5%B0%B1%E4%B8%8D%E4%BC%9A%E6%8C%A1%E4%BD%8Fcenter%E4%BA%86%20*%2F%0A%7D%0A.holy-grail-main-right%20%7B%0A%20%20%20%20background-color%3A%20grey%3B%0A%20%20%20%20width%3A%20100px%3B%0A%20%20%20%20margin-left%3A%20-100px%3B%20%2F*%20%E6%8A%8Aleft%E7%A7%BB%E5%8A%A8%E5%88%B0%E5%92%8Ccenter%E5%90%8C%E4%B8%80%E8%A1%8C%E5%B9%B6%E4%B8%94%E5%8F%B3%E8%BE%B9%E5%AF%B9%E9%BD%90%20*%2F%0A%20%20%20%20position%3A%20relative%3B%0A%20%20%20%20left%3A%20100px%3B%20%2F*%20%E5%90%91%E5%8F%B3%E7%A7%BB%E5%8A%A8%E5%88%B0%E5%8F%B3%E8%BE%B9%E7%9A%84padding%E5%8C%BA%E5%9F%9F*%2F%0A%7D%0A.holy-grail-footer%20%7B%0A%20%20%20%20background-color%3A%20pink%3B%0A%7D%0A%2F*%20%E6%B8%85%E9%99%A4%E6%B5%AE%E5%8A%A8%20*%2F%0A.clear-fix%3A%3Aafter%20%7B%0A%20%20%20%20content%3A%20%22%22%3B%0A%20%20%20%20display%3A%20block%3B%0A%20%20%20%20clear%3A%20both%3B%0A%7D%0A%3C%2Fstyle%3E%0A%3Chtml%3E%0A%20%20%3Cheader%20class%3D%22holy-grail-header%22%3E%E5%A4%B4%E9%83%A8%3C%2Fheader%3E%0A%20%20%3Cdiv%20class%3D%22holy-grail-main%20clear-fix%22%3E%0A%20%20%20%20%20%20%3Cdiv%20class%3D%22holy-grail-main-center%22%3E%E4%B8%AD%E9%97%B4%3C%2Fdiv%3E%0A%20%20%20%20%20%20%3Cdiv%20class%3D%22holy-grail-main-left%22%3E%E5%B7%A6%E4%BE%A7%3C%2Fdiv%3E%0A%20%20%20%20%20%20%3Cdiv%20class%3D%22holy-grail-main-right%22%3E%E5%8F%B3%E4%BE%A7%3C%2Fdiv%3E%0A%20%20%3C%2Fdiv%3E%0A%20%20%3Cfooter%20class%3D%22holy-grail-footer%22%3E%E5%BA%95%E9%83%A8%3C%2Ffooter%3E%0A%3C%2Fhtml%3E%0A" class="vuepress-plugin-demo-block__wrapper" style="display:none;"><div class="vuepress-plugin-demo-block__display"><div class="vuepress-plugin-demo-block__app"></div></div> <div class="vuepress-plugin-demo-block__code"><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.holy-grail-header</span> <span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.holy-grail-main</span> <span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> orange<span class="token punctuation">;</span>
    <span class="token property">padding</span><span class="token punctuation">:</span> 0 100px<span class="token punctuation">;</span> <span class="token comment">/* 左右两边的padding来放置left和right区域 */</span>
<span class="token punctuation">}</span>
<span class="token selector">.holy-grail-main-left,.holy-grail-main-center,.holy-grail-main-right</span> <span class="token punctuation">{</span>
    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.holy-grail-main-center</span> <span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> purple<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span> <span class="token comment">/* 这会把left和right挤到下一行 */</span>
<span class="token punctuation">}</span>
<span class="token selector">.holy-grail-main-left</span> <span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">margin-left</span><span class="token punctuation">:</span> -100%<span class="token punctuation">;</span> <span class="token comment">/* 把left移动到和center同一行并且左边对齐 */</span>
    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> -100px<span class="token punctuation">;</span> <span class="token comment">/* 再向左移动到main的padding区域,就不会挡住center了 */</span>
<span class="token punctuation">}</span>
<span class="token selector">.holy-grail-main-right</span> <span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> grey<span class="token punctuation">;</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">margin-left</span><span class="token punctuation">:</span> -100px<span class="token punctuation">;</span> <span class="token comment">/* 把left移动到和center同一行并且右边对齐 */</span>
    <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
    <span class="token property">left</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span> <span class="token comment">/* 向右移动到右边的padding区域*/</span>
<span class="token punctuation">}</span>
<span class="token selector">.holy-grail-footer</span> <span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> pink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 清除浮动 */</span>
<span class="token selector">.clear-fix::after</span> <span class="token punctuation">{</span>
    <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    <span class="token property">display</span><span class="token punctuation">:</span> block<span class="token punctuation">;</span>
    <span class="token property">clear</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>holy-grail-header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>头部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>holy-grail-main clear-fix<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>holy-grail-main-center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>中间<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>holy-grail-main-left<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>左侧<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>holy-grail-main-right<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>右侧<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>holy-grail-footer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>底部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div></div> <div class="vuepress-plugin-demo-block__footer"></div></div> <ul><li>双飞翼布局</li></ul> <div data-config="" data-type="vanilla" data-code="%3Cstyle%3E%0A.wings-header%20%7B%0A%20%20%20%20background-color%3A%20blue%3B%0A%7D%0A.wings-first%2C.wings-second%2C.wings-third%20%7B%0A%20%20%20%20float%3A%20left%3B%0A%7D%0A%2F*%20%E7%94%A8%E8%BF%99%E4%B8%AAdiv%E6%8A%8A%E4%B8%BB%E5%86%85%E5%AE%B9%E5%8C%85%E8%B5%B7%E6%9D%A5%E4%B9%8B%E5%90%8E%2C%E4%B8%BB%E5%86%85%E5%AE%B9%E5%B0%B1%E5%8F%AF%E4%BD%BF%E7%94%A8margin%E7%A9%BA%E5%87%BA%E4%B8%A4%E8%BE%B9%E7%9A%84%E5%8C%BA%E5%9F%9F%E4%BA%86%20*%2F%0A.wings-first%20%7B%0A%20%20%20%20width%3A%20100%25%3B%0A%20%20%20%20background-color%3A%20purple%3B%0A%7D%0A.wings-first-content%20%7B%0A%20%20%20%20margin%3A%200%20100px%3B%0A%7D%0A.wings-second%20%7B%0A%20%20%20%20width%3A%20100px%3B%0A%20%20%20%20background-color%3A%20red%3B%0A%20%20%20%20margin-left%3A%20-100%25%3B%20%2F*%20%E4%BD%9C%E7%94%A8%E5%92%8C%E5%9C%A3%E6%9D%AF%E4%B8%80%E6%A0%B7%20*%2F%0A%7D%0A.wings-third%20%7B%0A%20%20%20%20width%3A%20100px%3B%0A%20%20%20%20background-color%3A%20grey%3B%0A%20%20%20%20margin-left%3A%20-100px%3B%20%2F*%20%E4%BD%9C%E7%94%A8%E5%92%8C%E5%9C%A3%E6%9D%AF%E4%B8%80%E6%A0%B7%20*%2F%0A%7D%0A.wings-footer%20%7B%0A%20%20%20%20background-color%3A%20pink%3B%0A%20%20%20%20clear%3A%20both%3B%20%2F*%20%E6%B8%85%E9%99%A4footer%E4%B8%8A%E9%9D%A2%E5%85%83%E7%B4%A0%E7%9A%84%E6%B5%AE%E5%8A%A8%20*%2F%0A%7D%0A%3C%2Fstyle%3E%0A%3Chtml%3E%0A%20%20%3Cheader%20class%3D%22wings-header%22%3E%E5%A4%B4%E9%83%A8%3C%2Fheader%3E%0A%20%20%3Cdiv%20class%3D%22wings-first%22%3E%0A%20%20%20%20%3Cdiv%20class%3D%22wings-first-content%22%3E%E4%B8%AD%E9%97%B4%3C%2Fdiv%3E%0A%20%20%3C%2Fdiv%3E%0A%20%20%3Cdiv%20class%3D%22wings-second%22%3E%E5%B7%A6%E4%BE%A7%3C%2Fdiv%3E%0A%20%20%3Cdiv%20class%3D%22wings-third%22%3E%E5%8F%B3%E4%BE%A7%3C%2Fdiv%3E%0A%20%20%3Cfooter%20class%3D%22wings-footer%22%3E%E5%BA%95%E9%83%A8%3C%2Ffooter%3E%20%0A%3C%2Fhtml%3E%0A" class="vuepress-plugin-demo-block__wrapper" style="display:none;"><div class="vuepress-plugin-demo-block__display"><div class="vuepress-plugin-demo-block__app"></div></div> <div class="vuepress-plugin-demo-block__code"><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.wings-header</span> <span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.wings-first,.wings-second,.wings-third</span> <span class="token punctuation">{</span>
    <span class="token property">float</span><span class="token punctuation">:</span> left<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/* 用这个div把主内容包起来之后,主内容就可使用margin空出两边的区域了 */</span>
<span class="token selector">.wings-first</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> purple<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.wings-first-content</span> <span class="token punctuation">{</span>
    <span class="token property">margin</span><span class="token punctuation">:</span> 0 100px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.wings-second</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
    <span class="token property">margin-left</span><span class="token punctuation">:</span> -100%<span class="token punctuation">;</span> <span class="token comment">/* 作用和圣杯一样 */</span>
<span class="token punctuation">}</span>
<span class="token selector">.wings-third</span> <span class="token punctuation">{</span>
    <span class="token property">width</span><span class="token punctuation">:</span> 100px<span class="token punctuation">;</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> grey<span class="token punctuation">;</span>
    <span class="token property">margin-left</span><span class="token punctuation">:</span> -100px<span class="token punctuation">;</span> <span class="token comment">/* 作用和圣杯一样 */</span>
<span class="token punctuation">}</span>
<span class="token selector">.wings-footer</span> <span class="token punctuation">{</span>
    <span class="token property">background-color</span><span class="token punctuation">:</span> pink<span class="token punctuation">;</span>
    <span class="token property">clear</span><span class="token punctuation">:</span> both<span class="token punctuation">;</span> <span class="token comment">/* 清除footer上面元素的浮动 */</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wings-header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>头部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wings-first<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wings-first-content<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>中间<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wings-second<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>左侧<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wings-third<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>右侧<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>wings-footer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>底部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">&gt;</span></span> 
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div></div> <div class="vuepress-plugin-demo-block__footer"></div></div> <ul><li>flex布局</li></ul> <div data-config="" data-type="vanilla" data-code="%3Cstyle%3E%0A.flex-header%20%7B%0A%20%20background-color%3A%20blue%3B%0A%7D%0A.flex-box%20%7B%0A%20%20%20%20display%3A%20flex%3B%0A%7D%0A.flex-center%20%7B%0A%20%20background-color%3A%20purple%3B%0A%20%20flex-grow%3A%201%3B%0A%7D%0A.flex-left%20%7B%0A%20%20background-color%3A%20red%3B%0A%20%20order%3A%20-1%3B%0A%20%20flex%3A%200%200%20100px%3B%0A%7D%0A.flex-right%20%7B%0A%20%20background-color%3A%20grey%3B%0A%20%20flex%3A%200%200%20100px%3B%0A%7D%0A.flex-footer%20%7B%0A%20%20background-color%3A%20pink%3B%0A%7D%0A%3C%2Fstyle%3E%0A%3Chtml%3E%0A%20%20%3Cheader%20class%3D%22flex-header%22%3E%E5%A4%B4%E9%83%A8%3C%2Fheader%3E%0A%20%20%3Cdiv%20class%3D%22flex-box%22%3E%0A%20%20%20%20%3Cdiv%20class%3D%22flex-center%22%3E%E4%B8%AD%E9%97%B4%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20class%3D%22flex-left%22%3E%E5%B7%A6%E4%BE%A7%3C%2Fdiv%3E%0A%20%20%20%20%3Cdiv%20class%3D%22flex-right%22%3E%E5%8F%B3%E4%BE%A7%3C%2Fdiv%3E%0A%20%20%3C%2Fdiv%3E%0A%20%20%3Cfooter%20class%3D%22flex-footer%22%3E%E5%BA%95%E9%83%A8%3C%2Ffooter%3E%0A%3C%2Fhtml%3E%0A" class="vuepress-plugin-demo-block__wrapper" style="display:none;"><div class="vuepress-plugin-demo-block__display"><div class="vuepress-plugin-demo-block__app"></div></div> <div class="vuepress-plugin-demo-block__code"><div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
<span class="token selector">.flex-header</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> blue<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.flex-box</span> <span class="token punctuation">{</span>
    <span class="token property">display</span><span class="token punctuation">:</span> flex<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.flex-center</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> purple<span class="token punctuation">;</span>
  <span class="token property">flex-grow</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.flex-left</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> red<span class="token punctuation">;</span>
  <span class="token property">order</span><span class="token punctuation">:</span> -1<span class="token punctuation">;</span>
  <span class="token property">flex</span><span class="token punctuation">:</span> 0 0 100px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.flex-right</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> grey<span class="token punctuation">;</span>
  <span class="token property">flex</span><span class="token punctuation">:</span> 0 0 100px<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token selector">.flex-footer</span> <span class="token punctuation">{</span>
  <span class="token property">background-color</span><span class="token punctuation">:</span> pink<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>header</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex-header<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>头部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>header</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex-box<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex-center<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>中间<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex-left<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>左侧<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex-right<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>右侧<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>footer</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>flex-footer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>底部<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>footer</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div></div> <div class="vuepress-plugin-demo-block__footer"></div></div></li> <li><p><code>BFC</code>(块级格式化上下文)</p> <ul><li><code>BFC</code>这是一个独立的<code>渲染区域</code>，规定了内部如何布局，并且这个区域的子元素不会影响到外面的元素</li> <li>块格式化上下文对浮动定位与清除浮动都很重要</li> <li>BFC内部box<code>垂直放置</code></li> <li>计算BFC的高度的时候，<code>浮动元素</code>也参与计算</li> <li>哪些元素会生成 BFC：
<ul><li>根元素（<code>&lt;html&gt;</code>）</li> <li>浮动元素（元素的 float 不是 none）</li> <li>绝对定位元素（元素的 position 为 absolute 或 fixed）</li> <li>行内块元素（元素的 display 为 inline-block）</li> <li>表格单元格（元素的 display 为 table-cell，HTML表格单元格默认为该值）</li> <li>表格标题（元素的 display 为 table-caption，HTML表格标题默认为该值）</li> <li>匿名表格单元格元素（元素的 display 为 table、table-row、 table-row-group、table-header-group、table-footer-group（分别是HTML table、row、tbody、thead、tfoot 的默认属性）或 inline-table）</li> <li>overflow 计算值不为 visible 的块元素</li> <li>display 值为 flow-root 的元素</li> <li>contain 值为 layout、content 或 paint 的元素</li> <li>弹性元素（display 为 flex 或 inline-flex 元素的直接子元素）</li> <li>网格元素（display 为 grid 或 inline-grid 元素的直接子元素）</li> <li>多列容器（元素的 column-count 或 column-width 不为 auto，包括 column-count 为 1）</li> <li>column-span 为 all 的元素始终会创建一个新的BFC，即使该元素没有包裹在一个多列容器中。</li></ul></li></ul></li> <li><p><code>position</code> 属性</p> <ul><li><code>fixed</code>：固定定位，相对于浏览器窗口进行定位</li> <li><code>absolute</code>：绝对定位，绝对定位的元素的位置相对于最近的已定位父元素</li> <li><code>relative</code>：相对定位</li> <li><code>sticky</code>：粘性定位，元素先按照普通文档流定位，然后相对于该元素在流中的 <code>flow root</code>（BFC）和 <code>containing block</code>（最近的块级祖先元素）定位。而后，元素定位表现为在跨越特定阈值前为相对定位，之后为固定定位。</li></ul></li> <li><p>CSS的选择器有哪些？优先级？</p> <ul><li>CSS选择器有：
<ul><li>基本选择器：<code>通用选择器</code>(*)，<code>元素选择器</code>，<code>类选择器</code>，<code>ID选择器</code>，<code>属性选择器</code></li> <li>分组选择器：<code>选择器列表</code>(A, B)</li> <li>组合器：<code>后代组合器</code>(A B)，<code>直接子代组合器</code>(A&gt;B)，<code>一般兄组合器</code>(A-B)，<code>紧邻兄弟组合器</code>(A+B)</li> <li>伪选择器：<code>伪类</code>，<code>伪元素</code></li></ul></li> <li>选择器优先级：
<ul><li>第一优先级：!important</li> <li>内联样式，1000</li> <li>ID选择器，0100</li> <li>类、伪类、属性选择器，0010</li> <li>标签、伪元素选择器，0001</li> <li>通配符、子类选择器、兄弟选择器，0000</li></ul></li></ul></li> <li><p>清除浮动</p> <ul><li>浮动元素后使用带<code>clear: both;</code>属性的空元素</li> <li>浮动元素容器使用CSS的<code>overflow: hidden/auto;</code>属性，IE中还需要增加<code>zoom:1</code>属性</li> <li>给浮动的元素的容器添加浮动</li> <li>给浮动元素的容器添加一个<code>clear-fix</code>的class，然后给这个class添加一个<code>:after</code>伪元素实现元素末尾添加一个看不见的块元素清理浮动</li></ul></li> <li><p><code>link</code>和<code>@import</code>区别</p> <ul><li><code>link</code>属于<code>HTML</code>标签，而<code>@import</code>是<code>CSS</code>提供的</li> <li>页面被加载的时，<code>link</code>会同时被加载，而<code>@import</code>被引用的<code>CSS</code>会等到引用它的<code>CSS</code>文件被加载完再加载</li> <li><code>import</code>只在<code>IE5</code>以上才能识别，而<code>link</code>是<code>HTML</code>标签，无兼容问题</li> <li><code>link</code>方式的样式的权重 高于<code>@import</code>的权重</li></ul></li> <li><p>哪些样式可以被继承</p> <ul><li>文本相关属性：<code>font-family</code>、<code>font-size</code>、<code>font-weight</code>、<code>line-height</code></li> <li>列表相关的属性：<code>list-style-image</code>、<code>list-style-position</code>、<code>list-style-type</code>、<code>list-style</code></li> <li><code>color</code></li></ul></li></ul> <h3 id="js"><a href="#js" class="header-anchor">#</a> JS</h3> <ul><li><p>类型与判断</p> <ul><li>数据类型：<code>Number</code>、<code>String</code>、<code>Boolean</code>、<code>undefined</code>、<code>object</code>、<code>Null</code>、<code>Symbol</code>、<code>BigInt</code></li> <li>基本数据类型：<code>String</code>、<code>Number</code>、<code>boolean</code>、<code>null</code>、<code>undefined</code>、<code>Symbol</code></li> <li>引用类型：<code>object</code>。里面包含的 <code>function</code>、<code>Array</code>、<code>Date</code></li> <li>基本类型和引用类型的区别
<ul><li>基本类型不可变，引用类型的值是可变的</li> <li>基本类型的比较是值的比较，引用类型的比较是引用的比较</li> <li>基本类型的变量是存放在栈区的，引用类型的值是同时保存在栈内存和堆内存中的对象</li></ul></li> <li>JS中参数的传递是：
<ul><li>基础类型是值传递</li> <li>引用类型是共享传递，传递的是引用的一个副本，直接赋值形参时不会影响实参的值，若是对形参的属性修改时，则会影响实参的值。</li></ul></li> <li>类型判断
<ul><li><p><code>typeof</code></p> <ul><li><code>typeof</code>可以对基本类型<code>number</code>、<code>string</code>、<code>boolean</code>、<code>undefined</code>做出准确的判断</li> <li>而对于引用类型，除了<code>function</code>之外返回的都是<code>object</code></li></ul></li> <li><p><code>instanceof</code></p> <ul><li>当我们需要知道某个对象的具体类型时,可以用运算符<code>instanceof</code>，<code>instanceof</code>操作符判断左操作数对象的原型链上是否有右边这个构造函数的<code>prototype</code>属性，也就是说指定对象是否是某个构造函数的实例，最后返回布尔值。</li></ul></li> <li><p><code>constructor</code></p> <ul><li><code>constructor</code>属性的作用是，可以得知某个实例对象，到底是哪一个构造函数产生的。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">var</span> f <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
f<span class="token punctuation">.</span>constructor <span class="token operator">===</span> <span class="token constant">F</span><span class="token punctuation">;</span><span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div></li> <li><p><code>Object.prototype.toString.call</code></p> <ul><li><code>toString</code>是<code>Object</code>原型对象上的一个方法，该方法默认返回其调用者的具体类型</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object String]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Number]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Boolean]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">undefined</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Undefined]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Null]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Function]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// [object AsyncFunction]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Date]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Array]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">RegExp</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object RegExp]</span>
<span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [object Error]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div></li> <li><p>特定方法</p> <ul><li><code>Array.isArray</code> 用来判断是否是数组</li></ul></li></ul></li></ul></li> <li><p>原型链</p> <ul><li>每个对象拥有一个<code>原型对象</code>，对象以其原型为模板，从原型继承方法和属性，这些属性和方法定义在对象的构造函数的<code>prototype</code>属性上，而非对象实例本身。</li> <li>对象实例通过<code>__proto__</code>指向其<code>原型对象</code>，而构造函数则是通过其<code>prototype</code>属性指向其<code>原型对象</code>。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">const</span> p <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
p<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Parent</span><span class="token punctuation">.</span>prototype <span class="token comment">// true</span>
p<span class="token punctuation">.</span>constructor <span class="token operator">===</span> Parent <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><code>__proto__</code> 属性在<code>ES6</code>时才被标准化，以确保<code>Web浏览器</code>的<code>兼容性</code>，但是不推荐使用，除了标准化的原因之外还有<code>性能问题</code>。为了更好的支持，推荐使用 <code>Object.getPrototypeOf()</code>。</li> <li>每个对象拥有一个<code>原型对象</code>，通过<code>__proto__</code>指针指向上一个原型 ，并从中继承方法和属性。同时<code>原型对象</code>也可能拥有<code>原型</code>，这样一层一层，最终指向<code>null</code>。这种关系被称为<strong>原型链 (prototype chain)</strong>，通过原型链一个对象会拥有定义在其他对象中的属性和方法。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token keyword">null</span> <span class="token comment">// true</span>
  <span class="token keyword">new</span> <span class="token class-name">Object</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype <span class="token comment">// true</span>
  <span class="token comment">// Function.prototype是一个函数对象，但是 Function.prototype.prototype 为undefined</span>
  <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>prototype <span class="token comment">// undefined</span>
  <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Object</span><span class="token punctuation">.</span>prototype <span class="token comment">// true</span>
  <span class="token comment">// Object()</span>
  Object<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype <span class="token comment">// true</span>
  <span class="token comment">// Function()</span>
  Function<span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype <span class="token comment">// true</span>
  <span class="token keyword">new</span> <span class="token class-name">Function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>__proto__ <span class="token operator">===</span> <span class="token class-name">Function</span><span class="token punctuation">.</span>prototype <span class="token comment">// true</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div></li> <li><p>继承</p> <ul><li><p><code>原型链继承</code></p> <ul><li>通过在父类原型链上声明方法，并将子类的<code>prototype</code>指向父类的实例</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Parent</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">'kevin'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token class-name">Parent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">Child</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token class-name">Child</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> child1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">.</span><span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment">// kevin</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><ul><li>缺点
<ul><li>引用类型的属性被所有实例共享</li> <li>在创建<code>Child</code>的时候，不能向<code>Parent</code>传参</li></ul></li></ul></li> <li><p><code>借用构造函数</code></p> <ul><li>在<code>子类构造函数</code>中执行<code>父类的构造函数</code></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Parent</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>names <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'kevin'</span><span class="token punctuation">,</span> <span class="token string">'daisy'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Child</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Parent</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">var</span> child1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
child1<span class="token punctuation">.</span>names<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'yayu'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">.</span>names<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;kevin&quot;, &quot;daisy&quot;, &quot;yayu&quot;]</span>

<span class="token keyword">var</span> child2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child2<span class="token punctuation">.</span>names<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;kevin&quot;, &quot;daisy&quot;]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li>优点：
<ul><li>避免了引用类型的属性被所有实例共享</li> <li>可以在 Child 中向 Parent 传参</li></ul></li> <li>缺点：
<ul><li>方法都在构造函数中定义，每次创建实例都会自动创建一遍方法</li></ul></li></ul></li> <li><p><code>组合继承</code></p> <ul><li><code>借用构造函数</code> + 指定子类<code>prototype</code></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Parent</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Parent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Child</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Parent</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Child</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Parent</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name">Child</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span>constructor <span class="token operator">=</span> Child<span class="token punctuation">;</span>

<span class="token keyword">var</span> child1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">'kevin'</span><span class="token punctuation">,</span> <span class="token string">'18'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
child1<span class="token punctuation">.</span>colors<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token string">'black'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// kevin</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 18</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;, &quot;black&quot;]</span>

<span class="token keyword">var</span> child2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">'daisy'</span><span class="token punctuation">,</span> <span class="token string">'20'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child2<span class="token punctuation">.</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// daisy</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child2<span class="token punctuation">.</span>age<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child2<span class="token punctuation">.</span>colors<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;red&quot;, &quot;blue&quot;, &quot;green&quot;]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ul><li><code>组合继承</code>最大的缺点是会调用<code>两次父构造函数</code></li></ul></li> <li><p><code>原型式继承</code></p> <ul><li>已传入的对象实例为父类</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createObj</span><span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token constant">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> o
  <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li>缺点：
<ul><li>包含引用类型的属性值始终都会<code>共享</code>相应的值，这点跟原型链继承一样</li></ul></li></ul></li> <li><p>寄生式继承</p> <ul><li>创建一个仅用于<code>封装继承</code>过程的函数，该函数在内部以某种形式来做增强对象，最后返回对象</li> <li>借用<code>Object.create</code>实现继承关系</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">createObj</span> <span class="token punctuation">(</span><span class="token parameter">o</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> clone <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span>o<span class="token punctuation">)</span><span class="token punctuation">;</span>
  clone<span class="token punctuation">.</span><span class="token function-variable function">sayName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> clone<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>缺点：
<ul><li>跟借用构造函数模式一样，每次创建对象都会创建一遍方法</li></ul></li></ul></li> <li><p>寄生组合式继承</p> <ul><li>在组合继承的基础上，间接的让<code>Child.prototype</code>访问到<code>Parent.prototype</code></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">Parent</span> <span class="token punctuation">(</span><span class="token parameter">name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>name <span class="token operator">=</span> name<span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>colors <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'red'</span><span class="token punctuation">,</span> <span class="token string">'blue'</span><span class="token punctuation">,</span> <span class="token string">'green'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token class-name">Parent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">getName</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>name<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">Child</span> <span class="token punctuation">(</span><span class="token parameter">name<span class="token punctuation">,</span> age</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">Parent</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">,</span> name<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">this</span><span class="token punctuation">.</span>age <span class="token operator">=</span> age<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// 关键的三步，在组合继承中则是直接将Child,prototype指向新创建的Parent实例</span>
<span class="token keyword">const</span> <span class="token function-variable function">F</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token class-name">F</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token class-name">Parent</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
<span class="token class-name">Child</span><span class="token punctuation">.</span>prototype <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> child1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Child</span><span class="token punctuation">(</span><span class="token string">'kevin'</span><span class="token punctuation">,</span> <span class="token string">'18'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>child1<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li> <li><p>Class继承</p> <ul><li>主要是依赖<code>extends</code>关键字来实现继承，且继承的效果类似于<code>寄生组合继承</code></li> <li>使用了<code>extends</code>实现继承不一定要<code>constructor</code>和<code>super</code>，因为没有的话会默认产生并调用它们</li> <li><code>extends</code>后面接着的目标不一定是<code>class</code>，只要是个有<code>prototype</code>属性的<code>函数</code>就可以了</li></ul></li> <li><p>Super相关</p> <ul><li>在实现继承时，如果子类中有<code>constructor</code>函数，必须得在<code>constructor</code>中调用一下<code>super</code>函数，因为它就是用来产生实例<code>this</code>的。</li> <li>super有两种调用方式：当成<code>函数调用</code>和当成<code>对象调用</code>。</li> <li>super当成<code>函数调用</code>时，代表父类的构造函数，且返回的是子类的实例，也就是此时<code>super</code>内部的<code>this</code>指向子类。在子类的<code>constructor</code>中<code>super()</code>就相当于是<code>Parent.constructor.call(this)</code>。</li> <li>super当成<code>对象调用</code>时，普通函数中<code>super</code>对象指向父类的原型对象，静态函数中指向父类。且通过<code>super</code>调用父类的方法时，<code>super</code>会绑定子类的<code>this</code>，就相当于是<code>Parent.prototype.fn.call(this)</code>。</li></ul></li></ul></li> <li><p><code>this</code>与<code>apply/call/bind</code></p> <ul><li>通常下<code>this</code>指向有以下几种情况：
<ul><li>作为函数调用，非严格模式下，<code>this</code>指向<code>window</code>，严格模式下，<code>this</code>指向<code>undefined</code>；</li> <li>作为某对象的方法调用，<code>this</code>通常指向调用的对象。</li> <li>使用<code>apply</code>、<code>call</code>、<code>bind</code> 可以绑定<code>this</code>的指向。</li> <li>在构造函数中，<code>this</code>指向新创建的对象</li> <li>箭头函数没有单独的<code>this</code>值，<code>this</code>在箭头函数创建时确定，它与声明所在的上下文相同。</li></ul></li> <li><code>apply/call/bind</code> 区别
<ul><li><code>apply</code>调用后会执行函数，并且<code>apply</code>可以接受数组作为参数，并且将数组的元素解构传入被调用的函数中。</li> <li><code>call</code>调用后会执行函数，<code>call</code>接受的参数都会传入被调用的函数中。</li> <li><code>bind</code>调用后则是返回绑定<code>this</code>的函数，并且在调用时传入参数，那么返回的函数会自动保留传入的参数，再调用函数时可以接着传后续的参数。<code>bind</code>多次依然指向第一次<code>bind</code>的<code>this</code>。</li></ul></li></ul></li> <li><p>闭包</p> <ul><li>一个函数和对其周围状态（lexical environment，词法环境）的引用捆绑在一起（或者说函数被引用包围），这样的组合就是闭包（closure）。也就是说，闭包让你可以在一个内层函数中访问到其外层函数的作用域。</li> <li>作用域（Scope）表示变量的作用范围、可见区域，包括词法作用域和执行作用域。</li> <li>每个执行上下文都有3个基本属性：变量对象、作用域链和 this。</li> <li>函数执行上下文中的变量对象常常被称为活动对象。</li> <li>原理
<ul><li>利用了<code>函数作用域链</code>的特性，一个函数内部定义的函数会将包含外部函数的<code>活动对象</code>添加到它的作用域链中，函数执行完毕，其执行作用域销毁，但因内部函数的<code>作用域链</code>仍然在引用这个<code>活动对象</code>，所以其活动对象不会被销毁，直到内部函数被销毁后才被销毁</li></ul></li> <li>优点
<ul><li>可以从内部函数访问外部函数的作用域中的变量，且访问到的变量长期驻扎在内存中，可供之后使用</li> <li>避免变量<code>污染全局</code></li> <li>把变量存到独立的<code>作用域</code>，作为私有成员存在</li></ul></li> <li>缺点
<ul><li>对<code>内存消耗</code>有影响，因为内部函数保存了对外部变量的引用，导致无法被<code>垃圾回收</code>，增大内存的使用量，所以使用不当会造成<code>内存泄漏</code>。</li> <li>对<code>处理速度</code>有负面影响。闭包的层级决定了引用的外部变量在查找时经过的作用域链长度</li></ul></li> <li>应用
<ul><li>模块封装</li> <li>柯里化函数</li> <li>使用闭包实现私有化方法和变量</li> <li>缓存一些结果</li></ul></li></ul></li> <li><p>CommonJS 与 ES Module</p> <ul><li><code>CommonJS</code>模块的重要特性是<code>加载时执行</code>，即脚本代码在<code>require</code>的时候，就会<code>全部执行</code>。</li> <li><code>ESM</code>遇到模块加载命令<code>import</code>时，<strong>不</strong>会去执行模块，而是只<code>生成引用</code>。</li> <li>区别
<ul><li>导入导出语法不同。<code>CommonJS</code>使用<code>require</code>导入，使用<code>module.exports</code>和<code>exports</code>导出；<code>ESM</code>使用<code>import</code>导入，使用<code>export</code>导出。</li> <li><code>CommonJS</code>是<code>运行时</code>加载模块，<code>ESM</code>是在<code>静态编译期间</code>就确定<code>模块依赖</code>。</li> <li><code>ESM</code>在编译期间会将所有<code>import``提升</code>到顶部，<code>CommonJS</code>不会提升<code>require</code>。</li> <li><code>CommonJS</code>导出的是一个<code>值拷贝</code>，会对加载结果进行<code>缓存</code>，一旦<code>内部修改</code>这个值，则<code>不会同步</code>到外部。<code>ESM</code>是导出的一个<code>引用</code>，内部修改可以同步到外部。</li> <li>两者的<code>循环加载</code>的实现原理不同。</li> <li><code>CommonJS</code>中<code>顶层this</code>指向这个<code>模块本身</code>，而<code>ESM</code>中<code>顶层this</code>指向<code>undefined</code>。</li> <li><code>CommonJS</code>是<code>单值导出</code>，<code>ESM</code>可以导出<code>多个</code>。</li></ul></li> <li>循环加载
<ul><li><code>CommonJS</code>的做法是，一旦出现某个模块被<code>循环加载</code>，就只输出<code>已经执行</code>的部分，还未执行的部分不会输出。</li> <li><code>ESM</code>根本不会关心是否发生了<code>循环加载</code>，只是生成一个指向被加载模块的<code>引用</code>，需要开发者自己保证，真正取值的时候能够取到值。</li></ul></li></ul></li> <li><p>事件循环
<img src="https://cdn.jsdelivr.net/gh/artoriaschan/image-hosting@master/blog/16fb7ae3b678f1ea_tplv-t2oaga2asx-watermark.1x665gbn9n40.webp" alt="event-loop"></p> <ul><li><p>流程</p> <ul><li>JS分为<code>同步任务</code>和<code>异步任务</code>。</li> <li><code>同步任务</code>都在主线程上执行，会形成一个执行栈。</li> <li><code>事件触发线程</code>管理着一个<code>任务队列</code>，只要<code>异步任务</code>有了运行结果，就在任务队列之中放一个事件回调。</li> <li>一旦<code>执行栈</code>中的所有<code>同步任务</code>执行完毕，系统就会读取<code>任务队列</code>，将可运行的<code>异步任务</code>添加到<code>执行栈</code>中，开始执行。</li></ul></li> <li><p>宏任务</p> <ul><li>在<code>ECMAScript</code>中，<code>macrotask</code>也被称为<code>task</code>。</li> <li>由于<code>JS引擎线程</code>和<code>GUI渲染线程</code>是互斥的关系，浏览器为了能够使<code>宏任务</code>和<code>DOM任务</code>有序的进行，会在一个<code>宏任务</code>执行结果后，在下一个<code>宏任务</code>执行前，<code>GUI渲染线程</code>开始工作，对页面进行渲染。</li></ul> <div class="language-text line-numbers-mode"><pre class="language-text"><code>宏任务 -&gt; GUI渲染 -&gt; 宏任务 -&gt; ...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>常见的宏任务
<ul><li><code>主代码块(script)</code></li> <li><code>setTimeout/setInterval/setImmediate(Node)</code></li> <li><code>requestAnimationFrame</code></li> <li><code>MessageChannel</code></li></ul></li></ul></li> <li><p>微任务</p> <ul><li>ES6新引入了<code>Promise</code>标准，同时浏览器实现上多了一个<code>microtask</code>微任务概念，在<code>ECMAScript</code>中，<code>microtask</code>也被称为<code>jobs</code>。</li> <li>当一个<code>宏任务</code>执行完，会在渲染前，将执行期间所产生的所有<code>微任务</code>都执行完。</li></ul> <div class="language-text line-numbers-mode"><pre class="language-text"><code>宏任务 -&gt; 微任务 -&gt; GUI渲染 -&gt; 宏任务 -&gt; ...
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>常见的<code>微任务</code>：
<ul><li><code>process.nextTick[Node]</code></li> <li><code>Promise.[then/catch/finally]</code></li> <li><code>queueMicrotask</code></li> <li><code>Object.observe</code></li> <li><code>MutationObserver</code></li></ul></li></ul></li> <li><p>Node.js的事件循环</p></li></ul> <div class="language-text line-numbers-mode"><pre class="language-text"><code>   ┌───────────────────────┐
┌─&gt;│        timers           │
│  └──────────┬────────────┘
│  ┌──────────┴────────────┐
│  │     pending callback    │ I/O callbacks 
│  └──────────┬────────────┘
│  ┌──────────┴────────────┐
│  │     idle, prepare       │
│  └──────────┬────────────┘
│  ┌──────────┴────────────┐
│  │         poll            │
│  └──────────┬────────────┘
│  ┌──────────┴────────────┐
│  │        check            │ setImmediate
│  └──────────┬────────────┘
│  ┌──────────┴────────────┐
└──┤    close callbacks      │
   └───────────────────────┘
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><ul><li><code>Node.js</code>会先执行所有类型为 <code>timers</code> 的 <code>MacroTask</code>( <code>setTimeout</code>和<code>setInterval</code>)，然后执行所有的 <code>MicroTask</code>(NextTick例外)。</li> <li>进入 <code>poll</code> 阶段，执行几乎所有 <code>MacroTask</code>(<code>I/O callbacks</code>)，然后执行所有的 <code>MicroTask</code>。</li> <li>再执行所有类型为 <code>check</code> 的 <code>MacroTask</code>(<code>setImmediate</code>)，然后执行所有的 <code>MicroTask</code>。</li> <li>再执行所有类型为 <code>close callbacks</code> 的 <code>MacroTask</code>，然后执行所有的 <code>MicroTask</code>。</li> <li>至此，完成一个 <code>Tick</code>，回到 <code>timers</code> 阶段。</li> <li>另外，其他阶段的说明：
<ul><li><code>待定回调(pending callback)</code>：上一轮循环中有少数的<code>I/O callbacks</code>会被延迟到这一轮的这一阶段执行。</li> <li><code>idle, prepare</code>：队列的移动，仅内部使用。</li></ul></li></ul></li> <li><p>Promise</p> <ul><li><p><code>Promise</code>解决了什么问题？</p> <ul><li>“回调地狱”所说的嵌套其实是指异步的嵌套。它带来了两个问题：<code>可读性</code>的问题和<code>信任</code>问题。</li> <li>异步嵌套带来的<code>信任</code>问题，它的问题的根源在于<code>控制反转</code>。</li></ul></li> <li><p><code>Promise</code>有什么静态方法？</p> <ul><li><code>resolve</code></li> <li><code>reject</code></li> <li><code>race</code></li> <li><code>any</code></li> <li><code>all</code></li> <li><code>allSettled</code></li></ul></li> <li><p>手写<code>Promise A+</code></p> <ul><li>首先需要定义<code>status</code></li> <li>在就维护两个队列：<code>onFulfilledCallbacks</code>和<code>onRejectedCallbacks</code></li> <li>实现<code>then</code>方法，首先转化传入的参数，在就是创建<code>Promise</code>实例并返回
<ul><li>在创建<code>Promise</code>实例的时候，传入的函数中需要判断当前<code>Promise</code>的状态，看是将<code>fulfilledMicrotask</code>和<code>rejectedMicrotask</code>放入对应的队列还是直接执行</li> <li>在<code>fulfilledMicrotask</code>和<code>rejectedMicrotask</code>中需要使用<code>queueMicrotask</code>函数产生微任务，并且调用<code>resolvePromise</code>函数解决嵌套<code>Promise</code>的问题</li></ul></li> <li>还需要实现<code>resolve</code>和<code>reject</code>方法，传入<code>executor</code>中执行，这两个方法都是改变<code>Promise</code>的<code>status</code>，并执行对应的队列</li> <li>最后实现两个静态方法：<code>static resolve</code>和<code>static reject</code>，</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token constant">PENDING</span> <span class="token operator">=</span> <span class="token string">'pending'</span>
<span class="token keyword">const</span> <span class="token constant">FULFILLED</span> <span class="token operator">=</span> <span class="token string">'fulfilled'</span>
<span class="token keyword">const</span> <span class="token constant">REJECTED</span> <span class="token operator">=</span> <span class="token string">'rejected'</span>

<span class="token keyword">class</span> <span class="token class-name">MyPromise</span> <span class="token punctuation">{</span>
  status <span class="token operator">=</span> <span class="token constant">PENDING</span>
  value <span class="token operator">=</span> <span class="token keyword">null</span>
  reason <span class="token operator">=</span> <span class="token keyword">null</span>
  onFulfilledCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  onRejectedCallbacks <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token parameter">executor</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">try</span><span class="token punctuation">{</span>
      <span class="token function">executor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>resolve<span class="token punctuation">,</span><span class="token keyword">this</span><span class="token punctuation">.</span>reject<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">resolve</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">value</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">FULFILLED</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value
      <span class="token comment">// 执行缓存的回调函数</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallbacks<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallbacks<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>value<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function-variable function">reject</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token constant">REJECTED</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>reason <span class="token operator">=</span> reason
      <span class="token comment">// 执行缓存的回调函数</span>
      <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span>length<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">onFulfilled<span class="token punctuation">,</span> onRejected</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">const</span> realOnFulfilled <span class="token operator">=</span> <span class="token keyword">typeof</span> onFulfilled <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onFulfilled</span> <span class="token operator">:</span> <span class="token parameter">value</span> <span class="token operator">=&gt;</span> value
    <span class="token keyword">const</span> realOnRejected <span class="token operator">=</span> <span class="token keyword">typeof</span> onRejected <span class="token operator">===</span> <span class="token string">'function'</span> <span class="token operator">?</span> <span class="token function-variable function">onRejected</span> <span class="token operator">:</span> <span class="token parameter">reason</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token keyword">throw</span> reason<span class="token punctuation">}</span>
    <span class="token keyword">const</span> next <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token function-variable function">fulfilledMicrotask</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
          <span class="token comment">// then 执行的时错误捕获</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token keyword">const</span> value <span class="token operator">=</span> <span class="token function">realOnFulfilled</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>value<span class="token punctuation">)</span>
            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>next<span class="token punctuation">,</span> value<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">const</span> <span class="token function-variable function">rejectedMicrotask</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        <span class="token function">queueMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
          <span class="token keyword">try</span> <span class="token punctuation">{</span>
            <span class="token comment">// 调用失败回调，并且把原因返回</span>
            <span class="token keyword">const</span> reason <span class="token operator">=</span> <span class="token function">realOnRejected</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>reason<span class="token punctuation">)</span>
            <span class="token comment">// 传入 resolvePromise 集中处理</span>
            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>next<span class="token punctuation">,</span> reason<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span>
          <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">FULFILLED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">fulfilledMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">REJECTED</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">rejectedMicrotask</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token constant">PENDING</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// PENDING状态时缓存</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onFulfilledCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>fulfilledMicrotask<span class="token punctuation">)</span>
        <span class="token keyword">this</span><span class="token punctuation">.</span>onRejectedCallbacks<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>rejectedMicrotask<span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> next
  <span class="token punctuation">}</span>
  <span class="token comment">// resolve 静态方法</span>
  <span class="token keyword">static</span> <span class="token function">resolve</span><span class="token punctuation">(</span><span class="token parameter">parameter</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果传入 MyPromise 就直接返回</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>parameter <span class="token keyword">instanceof</span> <span class="token class-name">MyPromise</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> parameter<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// 转成常规方式</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token parameter">resolve</span> <span class="token operator">=&gt;</span>  <span class="token punctuation">{</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>parameter<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// reject 静态方法</span>
  <span class="token keyword">static</span> <span class="token function">reject</span> <span class="token punctuation">(</span><span class="token parameter">reason</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">new</span> <span class="token class-name">MyPromise</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token function">reject</span><span class="token punctuation">(</span>reason<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">resolvePromise</span><span class="token punctuation">(</span><span class="token parameter">promise<span class="token punctuation">,</span> x<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 解决循环调用的问题</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>promise <span class="token operator">===</span> x<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">'Chaining cycle detected for promise #&lt;Promise&gt;'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'object'</span> <span class="token operator">||</span> <span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// x 为 null 直接返回，走后面的逻辑会报错</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>x <span class="token operator">===</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">let</span> then<span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token comment">// 把 x.then 赋值给 then </span>
      then <span class="token operator">=</span> x<span class="token punctuation">.</span>then<span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 如果 then 是函数</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> then <span class="token operator">===</span> <span class="token string">'function'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> called <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token function">then</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>
          x<span class="token punctuation">,</span> <span class="token comment">// this 指向 x</span>
          <span class="token comment">// 如果 resolvePromise 以值 y 为参数被调用，则运行 [[Resolve]](promise, y)</span>
          <span class="token parameter">y</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token comment">// 如果 resolvePromise 和 rejectPromise 均被调用，</span>
            <span class="token comment">// 或者被同一参数调用了多次，则优先采用首次调用并忽略剩下的调用</span>
            <span class="token comment">// 实现这条需要前面加一个变量 called</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            called <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">resolvePromise</span><span class="token punctuation">(</span>promise<span class="token punctuation">,</span> y<span class="token punctuation">,</span> resolve<span class="token punctuation">,</span> reject<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          <span class="token comment">// 如果 rejectPromise 以据因 r 为参数被调用，则以据因 r 拒绝 promise</span>
          <span class="token parameter">r</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
            called <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
            <span class="token function">reject</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// 如果 resolvePromise 或 rejectPromise 已经被调用，直接返回</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>called<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
        <span class="token function">reject</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token comment">// 如果 then 不是函数，以 x 为参数执行 promise</span>
      <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token comment">// 如果 x 不为对象或者函数，以 x 为参数执行 promise</span>
    <span class="token function">resolve</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br><span class="line-number">124</span><br><span class="line-number">125</span><br><span class="line-number">126</span><br><span class="line-number">127</span><br><span class="line-number">128</span><br><span class="line-number">129</span><br><span class="line-number">130</span><br><span class="line-number">131</span><br><span class="line-number">132</span><br><span class="line-number">133</span><br><span class="line-number">134</span><br><span class="line-number">135</span><br><span class="line-number">136</span><br><span class="line-number">137</span><br><span class="line-number">138</span><br><span class="line-number">139</span><br><span class="line-number">140</span><br><span class="line-number">141</span><br><span class="line-number">142</span><br><span class="line-number">143</span><br><span class="line-number">144</span><br><span class="line-number">145</span><br><span class="line-number">146</span><br><span class="line-number">147</span><br><span class="line-number">148</span><br></div></div></li></ul></li> <li><p>new 运算符</p> <ul><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Operators/new" target="_blank" rel="noopener noreferrer">MDN<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">newOp</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token keyword">let</span> Con <span class="token operator">=</span> args<span class="token punctuation">.</span><span class="token function">shift</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  obj<span class="token punctuation">.</span>__proto__ <span class="token operator">=</span> <span class="token class-name">Con</span><span class="token punctuation">.</span>prototype<span class="token punctuation">;</span>
  <span class="token keyword">let</span> result <span class="token operator">=</span> <span class="token function">Con</span><span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> result <span class="token keyword">instanceof</span> <span class="token class-name">Object</span> <span class="token operator">?</span> result <span class="token operator">:</span> obj<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div></li></ul> <h3 id="ts"><a href="#ts" class="header-anchor">#</a> TS</h3> <ul><li><p>never 类型</p> <ul><li><code>never</code> 类型是 <code>TypeScript</code> 中的底层类型</li> <li>是任何类型的 <code>subtype</code></li> <li>除了 <code>never</code> ，没有其他类型是 <code>never</code> 的 <code>subtype</code></li> <li>不相交类型的交叉类型结果为 <code>never</code></li> <li>&quot;返回 <code>never</code> 的函数必须存在无法达到的终点&quot;</li> <li><code>never</code> 类型仅能被赋值给另外一个 <code>never</code></li> <li>与 <code>void</code> 的差异
<ul><li><code>void</code> 表示没有任何类型， <code>never</code> 表示永远不存在的值的类型</li> <li><code>void</code> 类型可以被赋值</li></ul></li></ul></li> <li><p>unknown 类型</p> <ul><li>就像所有类型都可以被归为 any ，所有类型也都可以被归为 unknown 。这使得 unknown 成为 TypeScript 类型系统的另一种顶级类型（另一种是 any ）</li> <li>在联合类型中，unknown 类型会吸收任何类型。这就意味着如果任一组成类型是 unknown，联合类型也会相当于 unknown 。这条规则的一个意外是 any 类型。如果至少一种组成类型是 any，联合类型会相当于 any 。</li> <li>在交叉类型中，任何类型都可以吸收 unknown 类型。这意味着将任何类型与 unknown 相交不会改变结果类型</li></ul></li> <li><p>in 操作符</p> <ul><li>判断当前对象中是否存在该属性</li></ul></li> <li><p>is 操作符</p> <ul><li>用于 <code>类型谓词(type predicate)</code> ，对函数参数进行判断，并用户函数返回类型</li> <li><code>类型谓词</code> 始终附加到使用单个参数并返回布尔值的函数。</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">function</span> <span class="token function">isString</span><span class="token punctuation">(</span>x<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span><span class="token operator">:</span> x <span class="token keyword">is</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token keyword">typeof</span> x <span class="token operator">===</span> <span class="token string">'string'</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><p>as 操作符</p> <ul><li>用于类型断言，将一个联合类型转换为其中一个类型</li> <li>可以使用尖括号语法(非.tsx文件中)</li> <li>as const</li></ul></li> <li><p>infer</p> <ul><li><p>在条件类型中，可以使用 <code>infer</code> 关键字来指定一个变量的类型，交由 TS 进行推断</p></li> <li><p>应用</p> <ul><li><code>Parameters&lt;Type&gt;</code></li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Parameters<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span> <span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">P</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">P</span> <span class="token operator">:</span> <span class="token builtin">any</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>ConstructorParameters&lt;Type&gt;</code></li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">ConstructorParameters<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token keyword">abstract</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span> <span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">abstract</span></span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">P</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">P</span> <span class="token operator">:</span> <span class="token builtin">any</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>ReturnType&lt;Type&gt;</code></li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">ReturnType<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span> <span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">infer</span> <span class="token constant">R</span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token operator">:</span> <span class="token builtin">any</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>InstanceType&lt;Type&gt;</code></li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">InstanceType<span class="token operator">&lt;</span><span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token keyword">abstract</span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span></span> <span class="token builtin">any</span><span class="token operator">&gt;</span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">abstract</span></span> <span class="token keyword">new</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">infer</span> <span class="token constant">R</span> <span class="token operator">?</span> <span class="token constant">R</span> <span class="token operator">:</span> <span class="token builtin">any</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>ThisParameterType&lt;Type&gt;</code></li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">ThisParameterType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token keyword">this</span><span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">U</span><span class="token punctuation">,</span> <span class="token operator">...</span>args<span class="token operator">:</span> <span class="token builtin">any</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token builtin">any</span> <span class="token operator">?</span> <span class="token constant">U</span> <span class="token operator">:</span> <span class="token builtin">unknown</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>OmitThisParameter&lt;Type&gt;</code></li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">OmitThisParameter<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token builtin">unknown</span> <span class="token keyword">extends</span> <span class="token class-name">ThisParameterType<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">?</span> <span class="token constant">T</span> <span class="token operator">:</span> <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token keyword">infer</span> <span class="token constant">A</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token keyword">infer</span> <span class="token constant">R</span> <span class="token operator">?</span> <span class="token punctuation">(</span><span class="token operator">...</span>args<span class="token operator">:</span> <span class="token constant">A</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token constant">R</span> <span class="token operator">:</span> <span class="token constant">T</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li></ul></li> <li><p>泛型</p> <ul><li><code>泛型</code>是指在定义<code>函数</code>、<code>接口</code>或<code>类</code>的时候，不预先指定<code>具体类型</code>，而在使用的时候再<code>指定类型</code>的一种特性。</li> <li>设计<code>泛型</code>的关键目的是在成员之间提供<code>有意义的约束</code>，这些成员可以是：
<ul><li>类的实例成员</li> <li>类的方法</li> <li>函数参数</li> <li>函数返回值</li></ul></li> <li>这里衍生出泛型的应用：
<ul><li>泛型类</li> <li>泛型方法</li> <li>泛型函数</li></ul></li></ul></li> <li><p>interface</p> <ul><li>同名的<code>interface</code>会<code>自动合并</code>，同名的<code>interface</code>和<code>class</code>会<code>自动聚合</code>。</li> <li><code>TypeScript</code> 中 <code>interface</code> 可以给 <code>Function</code> / <code>Array</code> / <code>Class</code>（Indexable）做声明吗？</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">/* 可以 */</span>
<span class="token comment">// 函数声明</span>
<span class="token keyword">interface</span> <span class="token class-name">Say</span> <span class="token punctuation">{</span>
  <span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> viod<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">let</span> say<span class="token operator">:</span> Say <span class="token operator">=</span> <span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span>viod <span class="token operator">=&gt;</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// Array 声明</span>
<span class="token keyword">interface</span> <span class="token class-name">NumberArray</span> <span class="token punctuation">{</span> 
  <span class="token punctuation">[</span>index<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span> 
<span class="token punctuation">}</span> 
<span class="token keyword">let</span> fibonacci<span class="token operator">:</span> NumberArray <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token comment">// Class 声明</span>
<span class="token keyword">interface</span> <span class="token class-name">PersonalIntl</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span>
  <span class="token function">sayHi</span> <span class="token punctuation">(</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><ul><li><code>type</code>与<code>interface</code>的区别
<ul><li>相同点：
<ul><li>都可以描述<code>对象</code>或者<code>函数</code></li> <li>都允许<code>拓展(extends)</code></li></ul></li> <li>不同点：
<ul><li><code>type</code>可以声明<code>基本类型</code>，<code>联合类型</code>，<code>元组</code></li> <li><code>type</code>可以使用<code>typeof</code>获取实例的类型进行赋值</li> <li><code>type</code> 定义之后不能扩展，而 <code>interface</code> 则可以通过多个命名相同的 <code>interface</code> 声明进行扩充</li></ul></li> <li>使用<code>interface</code>描述<code>数据结构</code>，使用<code>type</code>描述<code>类型关系</code></li></ul></li></ul></li> <li><p>Intersection Types(交叉类型)</p> <ul><li><code>交叉类型</code>是将多个类型合并为一个类型。这让我们可以把现有的多种类型叠加到一起成为一种类型，它包含了所需的<code>所有类型特性</code>。</li> <li><code>交叉类型</code>与<code>接口继承</code>的区别
<ul><li><code>接口继承</code>子接口<strong>不</strong>能覆盖父接口的成员，但是可以添加新的成员</li> <li><code>交叉类型</code>会把<code>相同成员</code>的<code>类型进行交叉</code>，但是在赋值的时候就会出现问题，显示当前为<code>never</code>类型</li></ul></li></ul></li> <li><p>Union Types(联合类型)</p> <ul><li>Narrowing(类型收窄)
<ul><li>typeof</li> <li>真值判断</li> <li>等价判断</li> <li>in</li> <li>instanceof</li> <li>赋值语句</li> <li>控制流程分析</li> <li>类型谓词 is</li> <li>可辨别联合</li> <li>never 穷举检查</li></ul></li></ul></li> <li><p>Utility Types(工具类型)</p> <ul><li><code>Partial&lt;Type&gt;</code>: 将传入的类型的属性全部设为可选</li> <li><code>Required&lt;Type&gt;</code>：将传入的类型的属性全部设为必传</li> <li><code>Readonly&lt;Type&gt;</code>：将传入的类型的属性全部设为只读</li> <li><code>Record&lt;Keys, Type&gt;</code>：构建一个对象类型，其键为Keys中声明的类型，其值为Type中声明的类型</li> <li><code>Pick&lt;Type, Keys&gt;</code>：从传入的Type中选择Keys对应的属性并组成新的类型</li> <li><code>Omit&lt;Type, Keys&gt;</code>：从传入的Type中剔除Keys对应的属性并组成新的类型</li> <li><code>Exclude&lt;UnionType, ExcludedMembers&gt;</code>：从联合类型UnionType中剔除ExcludedMembers组成新的类型</li> <li><code>Extract&lt;Type, Union&gt;</code>：提取Type和Union中的公共类型</li> <li><code>NonNullable&lt;Type&gt;</code>：从Type中剔除null和undefined的类型</li> <li><code>Parameters&lt;Type&gt;</code>：从函数类型Type中获取参数类型，并组成一个元组类型</li> <li><code>ConstructorParameters&lt;Type&gt;</code>：从构造函数类型Type中获取参数类型，并组成一个元组类型</li> <li><code>ReturnType&lt;Type&gt;</code>：获取函数类型Type的返回值类型</li> <li><code>InstanceType&lt;Type&gt;</code>：从构造函数类型Type中获取实例类型</li> <li><code>ThisParameterType&lt;Type&gt;</code>：获取函数类型Type的this参数的类型</li> <li><code>OmitThisParameter&lt;Type&gt;</code>：从函数类型Type中移除this参数，并生成新的类型</li> <li><code>ThisType&lt;Type&gt;</code>：此工具类型不返回转换后的类型。相反，它用作上下文这种类型的标记。</li> <li><code>Uppercase&lt;StringType&gt;</code>：全部大写传入的字符串类型</li> <li><code>Lowercase&lt;StringType&gt;</code>：全部小写传入的字符串类型</li> <li><code>Capitalize&lt;StringType&gt;</code>：转换首字母为大写</li> <li><code>Uncapitalize&lt;StringType&gt;</code>：转换首字母为小写</li></ul></li> <li><p>Type Operator(类型操作符)</p> <ul><li>keyof：<code>索引类型查询操作符</code>，获取索引类型的属性名，构成联合类型。</li> <li>typeof：获取一个变量或对象的类型。</li></ul></li> <li><p><a href="https://www.typescriptlang.org/docs/handbook/2/conditional-types.html" target="_blank" rel="noopener noreferrer">Conditional Types<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>(条件类型)</p> <ul><li>使用extends进行判断</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token comment">// 判断是否是联合类型</span>
<span class="token keyword">type</span> <span class="token class-name">IsUnion<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token punctuation">,</span> <span class="token constant">F</span> <span class="token operator">=</span> <span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span>
  <span class="token constant">T</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token constant">T</span></span>
    <span class="token operator">?</span> <span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token constant">F</span><span class="token operator">&gt;</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token builtin">Array</span><span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> 
      <span class="token operator">?</span> <span class="token boolean">false</span> 
      <span class="token operator">:</span> <span class="token boolean">true</span> 
  <span class="token operator">:</span> <span class="token builtin">never</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li>可以在泛型中判断T的类型</li> <li>当与any判断，并且判断类型传入并集时，就变成一个分布式条件类型</li></ul></li> <li><p><a href="https://www.typescriptlang.org/docs/handbook/2/mapped-types.html" target="_blank" rel="noopener noreferrer">Mapped Types<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>(映射类型)</p> <ul><li>基于一个类型去创建另一个类型</li> <li>可以使用-/+ 增加属性的修饰符，例如?、readonly</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Readonly<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">+</span><span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span>  <span class="token comment">// 使用 + 增加readonly修饰符</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> <span class="token class-name">Mutable<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token operator">-</span><span class="token keyword">readonly</span> <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span>  <span class="token comment">// 使用 - 移除readonly修饰符</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> <span class="token class-name">Partial<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span><span class="token constant">P</span> <span class="token keyword">in</span> <span class="token keyword">keyof</span> <span class="token constant">T</span><span class="token punctuation">]</span><span class="token operator">+</span><span class="token operator">?</span><span class="token operator">:</span> <span class="token constant">T</span><span class="token punctuation">[</span><span class="token constant">P</span><span class="token punctuation">]</span>  <span class="token comment">// 使用 + 增加?修饰符</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><ul><li>使用as对属性名重命名，结合字符串模板类型，可以支持更自由的命名规则</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">Getters<span class="token operator">&lt;</span>Type<span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token punctuation">[</span>Property <span class="token keyword">in</span> <span class="token keyword">keyof</span> Type <span class="token keyword">as</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">get</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>Capitalize<span class="token operator">&lt;</span>string <span class="token operator">&amp;</span> Property<span class="token operator">&gt;</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">]</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> Type<span class="token punctuation">[</span>Property<span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">interface</span> <span class="token class-name">Person</span> <span class="token punctuation">{</span>
  name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  age<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">;</span>
  location<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token keyword">type</span> <span class="token class-name">LazyPerson</span> <span class="token operator">=</span> Getters<span class="token operator">&lt;</span>Person<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment">// type LazyPerson = {</span>
<span class="token comment">//   getName: () =&gt; string;</span>
<span class="token comment">//   getAge: () =&gt; number;</span>
<span class="token comment">//   getLocation: () =&gt; string;</span>
<span class="token comment">// }</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div></li> <li><p>Template Literal Types</p> <ul><li><code>模板文本类型</code>建立在<code>字符串文本类型</code>的基础上，并能够通过联合扩展为许多字符串。</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">type</span> <span class="token class-name">World</span> <span class="token operator">=</span> <span class="token string">&quot;world&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">Greeting</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">hello </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>World<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// type Greeting = &quot;hello world&quot;</span>

<span class="token keyword">type</span> <span class="token class-name">EmailLocaleIDs</span> <span class="token operator">=</span> <span class="token string">&quot;welcome_email&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;email_heading&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">FooterLocaleIDs</span> <span class="token operator">=</span> <span class="token string">&quot;footer_title&quot;</span> <span class="token operator">|</span> <span class="token string">&quot;footer_sendoff&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">type</span> <span class="token class-name">AllLocaleIDs</span> <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>EmailLocaleIDs <span class="token operator">|</span> FooterLocaleIDs<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">_id</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span> <span class="token comment">// type AllLocaleIDs = &quot;welcome_email_id&quot; | &quot;email_heading_id&quot; | &quot;footer_title_id&quot; | &quot;footer_sendoff_id&quot;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>协变、逆变、双向协变以及不变性</p> <ul><li><code>JavaScript</code>中的复杂数据类型<code>Object</code>是一种<code>结构化类型</code>。哪怕使用了<code>ES6</code>的<code>class</code>语法糖，创建的类型本质上还是<code>Object</code>，因此<code>TypeScript</code>使用的也是一种<code>结构化</code>的<code>类型检查系统</code>。</li> <li>因此在TypeScript中，判断两个类型是否兼容，只需要判断他们的“<code>结构</code>”是否一致，也就是说<code>结构属性名</code>和<code>类型</code>是否一致。而不需要关心他们的“<code>名字</code>”是否相同。</li> <li>而<code>协变</code>和<code>逆变</code>就是<code>子类型</code>上的两个比较容易混淆的概念。</li> <li><code>协变</code> (Covariant)：指允许<code>子类型</code>转换为<code>父类型</code>，函数的返回值类型要协变才安全。</li> <li><code>逆变</code> (Contravariant)：指允许<code>父类型</code>转换为<code>子类型</code>，多发生在<code>函数参数类型</code>中。</li> <li><code>双向协变</code> (Bivariant)：指允许<code>子类型</code>转换为<code>父类型</code>，也允许<code>父类型</code>转换为<code>子类型</code>，老版本(2.6之前)中，<code>TypeScript</code>的函数参数是<code>双向协变</code>的，但这样并不安全。</li> <li>只有开启了<code>--strictFunctionTypes</code>或者<code>--strict</code>模式，ts才对函数参数类型进行逆变检查。默认情况下，ts对函数参数进行<code>Bivariance</code>检查，就是说既允许<code>协变</code>又允许<code>逆变</code>。</li> <li><code>不变</code> (Invariant)：指不同类型之间是无法相互转换的。
<ul><li>举例：<code>List&lt;Dog&gt;</code> 能否为 <code>List&lt;Animal&gt;</code> 的子类型，其中 <code>Dog ≼ Animal</code></li> <li>答案是如果列表是不可变列表，那么答案是肯定的，因为类型很安全。但是假如列表是可变的，那么答案绝对是否定的！</li> <li>总结一下，我们可以允许<code>不可变列表</code>在它的参数类型上是<code>协变</code>的，但是对于<code>可变列表</code>，其参数类型则必须是<code>不变</code>的，既不是协变也不是逆变。</li></ul></li></ul></li></ul> <h2 id="网络协议"><a href="#网络协议" class="header-anchor">#</a> 网络协议</h2> <h3 id="tcp"><a href="#tcp" class="header-anchor">#</a> TCP</h3> <ul><li>TCP/IP模型
<img src="https://cdn.jsdelivr.net/gh/artoriaschan/image-hosting@master/blog/v2-a0eeeef2d69e44e1434c01f341660a0f_r.38c312qzvdo0.webp" alt="TCP/IP"></li> <li>TCP协议
<ul><li>TCP的全称是<code>Transmission Control Protocol</code>，传输控制协议。它能够帮助你确定计算机连接到<code>Internet</code>以及它们之间的数据传输。</li> <li>通过<code>三次握手</code>来建立TCP连接，<code>三次握手</code>就是用来启动和确认TCP连接的过程。一旦连接建立后，就可以发送数据了，当数据传输完成后，会通过关闭虚拟电路来断开连接。</li></ul></li> <li>TCP协议特点
<ul><li>TCP能够确<code>保连接的建立</code>和<code>数据包的发送</code></li> <li>TCP支持<code>错误重传机制</code></li> <li>TCP支持<code>拥塞控制</code>，能够在网络拥堵的情况下<code>延迟发送</code></li> <li>TCP能够提供<code>错误校验和</code>，甄别有害的数据包</li></ul></li> <li>TCP三次握手
<ul><li><code>SYN</code>：<code>同步序列编号</code>。是<code>TCP/IP</code>建立连接时使用的握手信号。在客户机和服务器之间建立<code>TCP</code>连接时，首先会发送的一个信号。客户端在接受到<code>SYN</code>消息时，就会在自己的段内生成一个随机值<code>X</code>。</li> <li><code>SYN-ACK</code>：服务器收到SYN后，打开客户端连接，发送一个<code>SYN-ACK</code>作为答复。确认号设置为比接收到的序列号多一个，即<code>X+1</code>，服务器为数据包选择的序列号是另一个随机数<code>Y</code>。</li> <li><code>ACK</code>：<code>确认字符</code>，表示发来的数据已确认接收无误。最后，客户端将<code>ACK</code>发送给服务器。序列号被设置为所接收的确认值即<code>Y+1</code>。
<img src="https://cdn.jsdelivr.net/gh/artoriaschan/image-hosting@master/blog/v2-96858222f549bb65b122e4ea9481983f_r.2lclc3qduog0.webp" alt="三次握手"></li></ul></li> <li>TCP四次挥手
<ul><li>首先，客户端应用程序决定要终止连接(这里服务端也可以选择断开连接)。这会使客户端将<code>FIN</code>发送到服务器，并进入<code>FIN_WAIT_1</code>状态。当客户端处于<code>FIN_WAIT_1</code>状态时，它会等待来自服务器的<code>ACK</code>响应。</li> <li>然后第二步，当服务器收到<code>FIN</code>消息时，服务器会立刻向客户端发送<code>ACK</code>确认消息。</li> <li>当客户端收到服务器发送的<code>ACK</code>响应后，客户端就进入<code>FIN_WAIT_2</code>状态，然后等待来自服务器的<code>FIN</code>消息</li> <li>服务器发送<code>ACK</code>确认消息后，一段时间（可以进行关闭后）会发送<code>FIN</code>消息给客户端，告知客户端可以进行关闭。</li> <li>当客户端收到从服务端发送的<code>FIN</code>消息时，客户端就会由<code>FIN_WAIT_2</code>状态变为<code>TIME_WAIT</code>状态。处于<code>TIME_WAIT</code>状态的客户端允许重新发送<code>ACK</code>到服务器为了防止信息丢失。客户端在<code>TIME_WAIT</code>状态下花费的时间取决于它的实现，在等待一段时间后，连接关闭，客户端上所有的资源都被释放。
<img src="https://cdn.jsdelivr.net/gh/artoriaschan/image-hosting@master/blog/v2-16f1d27692320d9f60ba43aa4108e8ca_r.7jezr6u3a140.webp" alt="四次挥手"></li></ul></li></ul> <h3 id="http协议"><a href="#http协议" class="header-anchor">#</a> HTTP协议</h3> <ul><li><code>HTTP</code>是一种<code>超文本传输协议</code>(Hypertext Transfer Protocol)，基于<code>TCP</code>协议，是<code>无状态协议</code></li> <li>常见方法
<ul><li><code>GET</code>：GET方法一般用于请求，比如你在浏览器地址栏输入的链接其实就是发送了一个GET请求</li> <li><code>POST</code></li> <li><code>PUT</code></li> <li><code>DELETE</code></li> <li><code>OPTIONS</code></li></ul></li> <li>常见状态码
<ul><li>200：<code>OK</code>，请求成功。一般用于GET与POST请求</li> <li>301：<code>Moved Permanently</code>，永久移动。请求的资源已被永久的移动到新URI，返回信息会包括新的URI，浏览器会自动定向到新URI。今后任何新的请求都应使用新的URI代替</li> <li>302：<code>Found</code>，临时移动。与301类似。但资源只是临时被移动。客户端应继续使用原有URI</li> <li>304：<code>Not Modified</code>，未修改。所请求的资源未修改，服务器返回此状态码时，不会返回任何资源。客户端通常会缓存访问过的资源，通过提供一个头信息指出客户端希望只返回在指定日期之后修改的资源</li> <li>307：<code>Temporary Redirect</code>，临时重定向。与302类似。使用GET请求重定向</li> <li>308：<code>Permanent Redirect</code>，永久重定向。说明请求的资源已经被永久的移动到了由<code>Location</code>首部指定的<code>URL</code>上。浏览器会进行重定向，同时搜索引擎也会更新其链接</li> <li>400：<code>Bad Request</code>，客户端请求的语法错误，服务器无法理解</li> <li>401：<code>Unauthorized</code>，请求要求用户的身份认证</li> <li>404：<code>Not Found</code>，服务器无法根据客户端的请求找到资源（网页）。通过此代码，网站设计人员可设置&quot;您所请求的资源无法找到&quot;的个性页面</li> <li>406：<code>Not Acceptable</code>，服务器无法根据客户端请求的内容特性完成请求</li> <li>500：<code>Internal Server Error</code>，服务器内部错误，无法完成请求</li> <li>502：<code>Bad Gateway</code>，作为网关或者代理工作的服务器尝试执行请求时，从远程服务器接收到了一个无效的响应</li> <li>504：<code>Gateway Time-out</code>，充当网关或代理的服务器，未及时从远端服务器获取请求</li></ul></li> <li>HTTP/1.1
<ul><li>默认使用<code>长连接</code>，<code>长连接</code>就是只需一次建立就可以传输多次数据，传输完成后，只需要一次切断连接即可。<code>长连接</code>的连接时长可以通过请求头中的<code>Connection: keep-alive</code>来设置</li> <li>中新增加了<code>E-tag</code>，<code>If-Unmodified-Since</code>, <code>If-Match</code>, <code>If-None-Match</code> 等<code>缓存控制标头</code>来控制缓存失效。</li> <li>支持<code>断点续传</code>，通过使用请求头中的<code>Range</code>来实现。</li></ul></li> <li>HTTP/2
<ul><li><code>头部压缩</code>：<code>HTTP/2</code>使用<code>HPACK</code>算法进行压缩。</li> <li><code>二进制分帧</code>：<code>HTTP/2</code>使用了更加靠近<code>TCP/IP</code>的二进制格式，而抛弃了ASCII码，提升了解析效率</li> <li><code>多路复用</code>：即每一个请求都是是用作连接共享。一个请求对应一个id，这样一个连接上可以有多个请求。</li> <li><code>强化安全</code>：由于安全已经成为重中之重，所以<code>HTTP/2</code>一般都跑在<code>HTTPS</code>上。</li></ul></li> <li>HTTP/3
<ul><li>QUIC 协议：主要为了解决<code>HTTP/2</code>中存在的<code>队头阻塞</code>问题。由于<code>HTTP/2</code>在单个TCP连接上使用了<code>多路复用</code>，受到<code>TCP拥塞控制</code>的影响，少量的丢包就可能导致整个<code>TCP</code>连接上的所有流被阻塞。</li></ul></li> <li>HTTPS
<ul><li><code>HTTPS</code>的握手过程，其实就是<code>SSL/TLS</code>的握手过程。</li> <li><code>TLS</code>握手是启动和使用<code>TLS加密</code>的通信会话的过程。在<code>TLS握手</code>期间，<code>Internet</code>中的通信双方会彼此<code>交换信息</code>，<code>验证密码套件</code>，<code>交换会话密钥</code>。</li> <li>每当用户通过<code>HTTPS</code>导航到具体的网站并发送请求时，就会进行<code>TLS握手</code>。除此之外，每当其他任何通信使用<code>HTTPS</code>（包括API调用和在<code>HTTPS</code>上查询<code>DNS</code>）时，也会发生TLS握手。</li> <li><code>TLS</code>通讯流程：
<ul><li>在进行通信前，首先会进行<code>HTTP</code>的<code>三次握手</code>，握手完成后，再进行TLS的握手过程</li> <li><code>ClientHello</code>：客户端通过向服务器发送<code>hello</code>消息来发起握手过程。这个消息中会夹带着客户端支持的<code>TLS版本号</code>(TLS1.0 、TLS1.2、TLS1.3)、客户端支持的<code>密码套件</code>、以及一串<code>客户端随机数</code>。</li> <li><code>ServerHello</code>：在客户端发送<code>hello</code>消息后，服务器会发送一条消息，这条消息包含了服务器的<code>SSL证书</code>、服务器选择的<code>密码套件</code>和服务器生成的<code>随机数</code>。</li> <li><code>认证(Authentication)</code>：客户端的证书颁发机构会<code>认证SSL证书</code>，然后发送<code>Certificate</code>报文，报文中包含<code>公开密钥</code>证书。最后服务器发送<code>ServerHelloDone</code>作为hello请求的响应。第一部分握手阶段结束。</li> <li><code>加密阶段</code>：在第一个阶段握手完成后，客户端会发送<code>ClientKeyExchange</code>作为响应，这个响应中包含了一种称为<code>The premaster secret</code>的密钥字符串，这个字符串就是使用上面<code>公开密钥证书</code>进行加密的字符串。随后客户端会发送<code>ChangeCipherSpec</code>，告诉服务端使用<code>私钥解密</code>这个<code>The premaster secret</code>的字符串，然后客户端发送<code>Finished</code>告诉服务端自己发送完成了。</li> <li>实现了安全的<code>非对称加密</code>：然后，服务器再发送<code>ChangeCipherSpec</code>和<code>Finished</code>告诉客户端解密完成，至此实现了<code>RSA的非对称加密</code>。
<img src="https://cdn.jsdelivr.net/gh/artoriaschan/image-hosting@master/blog/v2-18f480a3c81a3313c8c312772884eece_r.34ageujsauc0.webp" alt="TLS通讯流程"> <img src="https://cdn.jsdelivr.net/gh/artoriaschan/image-hosting@master/blog/v2-2295aa8205ce9d03782cf88e8548ec5e_r.56dncwmk16o0.webp" alt="HTTPS"></li></ul></li></ul></li> <li>HTTP缓存策略
<ul><li>强制缓存
<ul><li>通过确定一定时间范围内不用请求资源，直接访问缓存即可</li> <li>通过<code>Expires</code>和<code>Cache-Control</code>两个头部确定
<ul><li><code>Expires</code>的值是一个时间，表示在这个时间之前再次访问该资源不用重新发送请求，直接访问缓存即可</li> <li><code>Cache-Control</code>返回<code>max-age=xxxx</code>，单位是秒，表示在这段时间内不需要重新发送请求，直接访问缓存即可</li> <li><code>Cache-Control</code>的其他常用属性还有：
<ul><li><code>no-cache</code>：使用缓存前，强制要求把请求提交给服务器进行验证(协商缓存验证)。</li> <li><code>no-store</code>：不存储有关客户端请求或服务器响应的任何内容，即不使用任何缓存。</li></ul></li> <li><code>Cache-Control</code>的优先级高于<code>Expire</code></li></ul></li></ul></li> <li>协商缓存
<ul><li>协商缓存要发请求去问服务器有没有更新</li> <li><code>ETag</code> &amp; <code>If-None-Match</code>(优先级高)
<ul><li><code>ETag</code>是<code>URL</code>的<code>Entity Tag</code>，就是一个<code>URL资源</code>的<code>标识符</code>，类似于文件的md5</li> <li>服务端的<code>Response Header</code>会携带<code>ETag</code>头部，客户端收到后存储</li> <li>当客户端请求相同资源时，会携带<code>If-None-Match</code>头部，值为之前<code>ETag</code>下发的值</li> <li>服务端接收后，查询<code>ETag</code>没有改变，则会返回<code>304(Not Modified)</code>，告诉客户端直接使用缓存，否则会返回<code>200</code>和<code>新资源</code></li></ul></li> <li><code>Last-Modified</code> &amp; <code>If-Modified-Since</code>(优先级低)
<ul><li><code>Last-Modified</code>放的是资源的最后修改时间</li> <li>服务端的<code>Response Header</code>会携带<code>Last-Modified</code>头部，客户端收到后存储</li> <li>当客户端请求相同资源时，会携带<code>If-Modified-Since</code>头部，值为之前<code>Last-Modified</code>下发的值</li> <li>服务端拿到这个头后，会跟当前版本的修改时间进行比较:
<ul><li>当前版本的修改时间比这个晚，也就是这个时间后又改过了，返回200和新的内容</li> <li>当前版本的修改时间和这个一样，也就是没有更新，返回304，不返回内容，只返回头，客户端直接使用缓存</li></ul></li></ul></li></ul></li> <li><code>强制缓存</code>的优先级高于<code>协商缓存</code></li> <li>如果什么缓存策略都没有设置，那么浏览器会采用一个启发式的算法，通常会读取<code>Response Header</code>中的<code>Date</code>头，减去<code>Last-Modified</code>值的<code>10%</code>作为缓存时间。</li></ul></li></ul> <h3 id="dns协议"><a href="#dns协议" class="header-anchor">#</a> DNS协议</h3> <ul><li>与<code>HTTP</code>、<code>FTP</code>和<code>SMTP</code>一样，<code>DNS</code>协议也是<code>应用层</code>的协议，<code>DNS</code>使用<code>客户-服务器模式</code>运行在通信的端系统之间，在通信的端系统之间通过下面的端到端运输协议来传送<code>DNS</code>报文。</li> <li><code>DNS</code>通常不是一门独立的协议，它通常为其他应用层协议所使用，这些协议包括<code>HTTP</code>、<code>SMTP</code>和<code>FTP</code>，将用户提供的主机名解析为<code>IP地址</code>。</li> <li>DNS层次结构
<ul><li><code>根域名服务器</code>：<code>根域名服务器</code>提供<code>TLD服务器</code>的<code>IP地址</code></li> <li><code>顶级域名服务器(TLD)</code>：顶级域<code>DNS</code>服务器，对于每个顶级域名比如<code>com</code>、<code>org</code>、<code>net</code>、<code>edu</code>和<code>gov</code>和所有的国家级域名<code>uk</code>、<code>fr</code>、<code>ca</code>和<code>jp</code>都有<code>TLD服务器</code>或服务器集群。<code>TLD服务器</code>提供了<code>权威DNS服务器</code>的<code>IP地址</code>。</li> <li><code>权威DNS服务器</code>：在因特网上具有公共可访问的主机，如Web服务器和邮件服务器，这些主机的组织机构必须提供可供访问的DNS记录，这些记录将这些主机的名字映射为<code>IP地址</code>。</li></ul></li> <li>DNS缓存
<ul><li><code>DNS缓存</code>(DNS caching)有时也叫做<code>DNS解析器缓存</code>，它是由操作系统维护的临时数据库，它包含有最近的网站和其他<code>Internet域</code>的访问记录。</li> <li><code>浏览器缓存</code>：发出对DNS记录的请求时，浏览器缓存是针对所请求的记录而检查的第一个位置。</li> <li><code>操作系统内核缓存</code>：在浏览器缓存查询后，会进行操作系统级DNS解析器的查询，操作系统级DNS解析器是DNS查询离开你的计算机前的第二站，也是本地查询的最后一个步骤。</li></ul></li> <li>DNS查询过程
<ul><li>用户在浏览器中输入网址<code>www.example.com</code>并点击回车后，查询会进入网络，并且由<code>DNS解析器</code>进行接收。</li> <li><code>DNS解析器</code>会首先去<code>浏览器DNS缓存</code>查找DNS记录。</li> <li>若无命中浏览器的DNS缓存，则会去<code>操作系统内核DNS缓存</code>，查找DNS记录。</li> <li><code>DNS解析</code>器会向根域名发起查询请求，要求返回顶级域名的<code>IP地址</code>。</li> <li>根DNS服务器会注意到请求地址的前缀并向<code>DNS解析器</code>返回com的<code>顶级域名服务器(TLD)</code>的<code>IP地址</code>列表。</li> <li>然后，<code>DNS解析器</code>会向<code>顶级域名服务器(TLD)</code>发送查询报文</li> <li><code>顶级域名服务器(TLD)</code>接收请求后，会根据域名的地址把<code>权威DNS服务器</code>的<code>IP地址</code>返回给DNS解析器。</li> <li>最后，<code>DNS解析器</code>将查询直接发送到<code>权威DNS服务器</code></li> <li><code>权威DNS服务器</code>将<code>IP地址</code>返回给<code>DNS解析器</code></li> <li><code>DNS解析器</code>将会使用<code>IP地址</code>响应Web浏览器</li></ul></li></ul> <h3 id="cdn"><a href="#cdn" class="header-anchor">#</a> CDN</h3> <ul><li>CDN (全称 Content Delivery Network)，即内容分发网络。</li> <li>构建在现有网络基础之上的智能虚拟网络，依靠部署在各地的<code>边缘服务器</code>，通过中心平台的<code>负载均衡</code>、<code>内容分发</code>、<code>调度</code>等功能模块，使用户<code>就近</code>获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。<code>CDN</code>的关键技术主要有<code>内容存储</code>和<code>分发技术</code>。</li> <li>在没有应用CDN时，我们使用域名访问某一个站点时的路径为</li></ul> <blockquote><p>用户提交域名 → 浏览器对域名进行解释 → <code>DNS</code>解析得到目的主机的IP地址 → 根据IP地址访问发出请求 → 得到请求数据并回复</p></blockquote> <ul><li>应用<code>CDN</code>后，<code>DNS</code>返回的不再是<code>IP</code>地址，而是一个<code>CNAME</code>(Canonical Name)别名记录，指向<code>CDN</code>的全局负载均衡。<code>CNAME</code>实际上在域名解析的过程中承担了<code>中间人</code>（或者说代理）的角色，这是CDN实现的关键。</li> <li><strong>负载均衡系统</strong> <ul><li>由于没有返回IP地址，于是本地DNS会向负载均衡系统再发送请求 ，则进入到<code>CDN</code>的全局负载均衡系统进行智能调度：
<ul><li>看用户的 IP 地址，查表得知<code>地理位置</code>，找相对最近的边缘节点</li> <li>看用户所在的<code>运营商</code>网络，找相同网络的边缘节点</li> <li>检查边缘节点的<code>负载情况</code>，找负载较轻的节点</li> <li>其他，比如节点的<code>健康状况</code>、<code>服务能力</code>、<code>带宽</code>、<code>响应时间</code>等</li></ul></li> <li>结合上面的因素，得到最合适的边缘节点，然后把这个节点返回给用户，用户就能够就近访问CDN的缓存代理
<img src="https://cdn.jsdelivr.net/gh/artoriaschan/image-hosting@master/blog/588d7890-b86b-11eb-85f6-6fac77c0c9b3.5v92wcq1tqs0.webp" alt="flow"></li></ul></li> <li><strong>缓存代理</strong> <ul><li>两个衡量<code>CDN</code>服务质量的指标：
<ul><li><code>命中率</code>：用户访问的资源恰好在缓存系统里，可以直接返回给用户，命中次数与所有访问次数之比</li> <li><code>回源率</code>：缓存里没有，必须用代理的方式回源站取，回源次数与所有访问次数之比</li></ul></li> <li>缓存系统也可以划分出层次，分成<code>一级缓存节点</code>和<code>二级缓存节点</code>。一级缓存配置高一些，直连源站，二级缓存配置低一些，直连用户</li> <li>回源的时候二级缓存只找一级缓存，一级缓存没有才回源站，可以有效地减少真正的回源。</li></ul></li></ul> <h2 id="浏览器"><a href="#浏览器" class="header-anchor">#</a> 浏览器</h2> <h3 id="常见概念"><a href="#常见概念" class="header-anchor">#</a> 常见概念</h3> <ul><li>重绘和回流(重排)
<ul><li>回流(重排)
<ul><li><code>回流</code>又名<code>重排</code>，指<code>几何属性</code>需改变的渲染。</li> <li><code>渲染树</code>的节点发生改变，影响了该节点的<code>几何属性</code>，导致该节点位置发生变化，此时就会触发浏览器<code>回流</code>并重新生成<code>渲染树</code>。</li> <li><code>回流</code>意味着节点的<code>几何属性</code>改变，需重新计算并生成<code>渲染树</code>，导致<code>渲染树</code>的全部或部分发生变化。</li></ul></li> <li>重绘
<ul><li><code>重绘</code>指更改<code>外观属性</code>而不影响<code>几何属性</code>的渲染。</li> <li><code>渲染树</code>的节点发生改变，但不影响该节点的<code>几何属性</code>。由此可见，<code>回流</code>对浏览器性能的消耗是高于<code>重绘</code>的，而且<code>回流</code>一定会伴随<code>重绘</code>，<code>重绘</code>却不一定伴随<code>回流</code>。</li></ul></li> <li>如何减少回流和重绘
<ul><li>使用<code>visibility:hidden</code>替换<code>display:none</code></li> <li>使用<code>transform</code>代替<code>top</code></li> <li>避免使用<code>Table</code>布局</li> <li>避免规则<code>层级过多</code></li> <li>避免节点属性值放在循环里当成循环变量</li> <li>动态改变类而不改变样式</li></ul></li></ul></li> <li>同源策略
<ul><li><p><code>同源策略</code>是一个重要的<code>安全策略</code>，它用于限制一个origin的文档或者它加载的脚本如何能与另一个源的资源进行交互。它能帮助阻隔恶意文档，减少可能被攻击的媒介。</p></li> <li><p>如果两个<code>URL</code>的<code>protocol</code>、<code>host</code>和<code>port</code>都相同的话，则这两个<code>URL</code>是同源。</p></li> <li><p><code>同源策略</code>限制的内容有：</p> <ul><li><code>Cookie</code>、<code>LocalStorage</code>、<code>IndexedDB</code>等存储性内容</li> <li><code>DOM节点</code></li> <li><code>AJAX</code>请求发送后，结果被浏览器拦截了</li></ul></li> <li><p>但是有三个标签是允许跨域加载资源：</p> <ul><li><code>&lt;img src=XXX&gt;</code></li> <li><code>&lt;link href=XXX&gt;</code></li> <li><code>&lt;script src=XXX&gt;</code></li></ul></li> <li><p>如何解决跨域</p> <ul><li><code>JSONP</code></li> <li><code>CORS</code>, 通过设置<code>Access-Control-Allow-Origin</code>请求头
<ul><li>根据请求方法和携带参数的不同又分为<code>简单请求</code>和<code>非简单请求</code>，<code>非简单请求</code>需要发出<code>OPTIONS预请求</code></li></ul></li> <li><code>document.domain</code>，只适用于<code>二级域名</code>相同的情况下</li> <li><code>window.name</code>，即在一个窗口的生命周期内，窗口载入的所有的页面都是共享一个<code>window.name</code></li> <li><code>postMessage</code></li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code>// a.html
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>iframe</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://localhost:4000/b.html<span class="token punctuation">&quot;</span></span> <span class="token attr-name">frameborder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>0<span class="token punctuation">&quot;</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>frame<span class="token punctuation">&quot;</span></span> <span class="token special-attr"><span class="token attr-name">onload</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span><span class="token value javascript language-javascript"><span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span><span class="token punctuation">&quot;</span></span></span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- 等它加载完触发一个事件 --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>iframe</span><span class="token punctuation">&gt;</span></span> 
<span class="token comment">&lt;!-- 内嵌在http://localhost:3000/a.html --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  <span class="token keyword">function</span> <span class="token function">load</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> frame <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'frame'</span><span class="token punctuation">)</span>
    frame<span class="token punctuation">.</span>contentWindow<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'我爱你'</span><span class="token punctuation">,</span> <span class="token string">'http://localhost:4000'</span><span class="token punctuation">)</span> <span class="token comment">//发送数据</span>
    window<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment">//接受返回数据</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token comment">//我不爱你</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token comment">&lt;!-- http://localhost:4000/b.html --&gt;</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript">
  window<span class="token punctuation">.</span><span class="token function-variable function">onmessage</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">e</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>e<span class="token punctuation">.</span>data<span class="token punctuation">)</span> <span class="token comment">//我爱你</span>
    e<span class="token punctuation">.</span>source<span class="token punctuation">.</span><span class="token function">postMessage</span><span class="token punctuation">(</span><span class="token string">'我不爱你'</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>origin<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div></li></ul></li></ul> <h3 id="渲染流程"><a href="#渲染流程" class="header-anchor">#</a> 渲染流程</h3> <ul><li>由于渲染机制过于复杂，所以渲染模块在执行过程中会被划分为很多<code>子阶段</code>，输入的<code>HTML</code>经过这些<code>子阶段</code>，最后输出<code>像素</code>。我们把这样的一个处理流程叫做<code>渲染流水线</code>。</li> <li>渲染流水线
<ul><li>构建<code>DOM树</code>：解析<code>HTML</code>，转换为浏览器能够理解的<code>DOM结构</code></li> <li>样式计算：计算出<code>DOM节点</code>中每个元素的具体样式
<ul><li>把<code>CSS</code>转换为浏览器能够理解的结构CSSOM</li> <li>转换样式表中的属性值，使其标准化</li> <li>计算出<code>DOM树</code>中每个节点的具体样式</li></ul></li> <li>布局阶段：计算出<code>DOM树</code>中<code>可见元素</code>的几何位置
<ul><li>创建布局树
<ul><li>遍历<code>DOM树</code>中的所有<code>可见节点</code>，并把这些节点加到布局中</li> <li>不可见的节点会被布局树忽略掉</li></ul></li> <li>布局计算：计算布局树节点的<code>坐标位置</code></li></ul></li> <li>分层：因为页面中有很多复杂的效果，如一些复杂的<code>3D变换</code>、<code>页面滚动</code>，或者使用<code>z-index</code>做<code>z轴排序</code>等。渲染引擎还需要为特定的节点生成专用的<code>图层</code>，并生成一棵对应的<code>图层树</code> <ul><li>拥有<code>层叠上下文属性</code>的元素会被提升为单独的<code>图层</code></li> <li>需要<code>剪裁</code>的地方也会被创建为<code>图层</code></li></ul></li> <li>图层绘制
<ul><li>绘制列表：渲染引擎实现<code>图层</code>的绘制会分步操作，会把一个<code>图层</code>的绘制拆分成很多小的<code>绘制指令</code>，然后再把这些指令按照顺序组成一个<code>待绘制列表</code></li></ul></li> <li><code>栅格化</code>操作：绘制列表只是用来记录绘制顺序和绘制指令的列表，而实际上绘制操作是由渲染引擎中的<code>合成线程</code>来完成的
<ul><li><code>栅格化</code>是指任何将<code>向量图形</code>转换成<code>位图</code>的过程</li> <li><code>合成线程</code>会将<code>图层</code>分成<code>图块</code>渲染</li> <li>然后<code>合成线程</code>会按照<code>视口</code>附近的<code>图块</code>来优先生成<code>位图</code>，实际生成<code>位图</code>的操作是由<code>栅格化</code>来执行的</li></ul></li> <li>合成与显示
<ul><li>一旦所有图块都被<code>栅格化</code>，<code>合成线程</code>就会生成一个绘制图块的命令<code>DrawQuad</code>，然后将该命令提交给浏览器进程</li> <li><code>合成线程</code>将其页面内容绘制到<code>内存</code>中，最后再将<code>内存</code>显示在屏幕上
<img src="https://cdn.jsdelivr.net/gh/artoriaschan/image-hosting@master/blog/gpu-raster.7bzkc74k24s0.webp" alt="渲染流水线"></li></ul></li></ul></li></ul> <h3 id="v8"><a href="#v8" class="header-anchor">#</a> V8</h3> <ul><li>编译流水线
<ul><li>运行时环境：堆空间和栈空间、全局执行上下文、全局作用域、内置的内建函数、宿主环境提供的扩展函数和对象，还有消息循环系统。
<ul><li>堆空间和栈空间
<ul><li>栈空间主要是用来管理<code>JavaScript函数调用</code>的，在函数调用过程中，涉及到<code>上下文相关的内容</code>都会存放在栈上。</li> <li>每个栈帧对应着一个未运行完的函数，栈帧中保存了该函数的返回地址和局部变量。</li> <li>堆空间是一种树形的存储结构，用来存储对象类型的离散的数据。</li> <li><code>JavaScript</code>中除了原生类型的数据，其他的都是对象类型，诸如<code>函数</code>、<code>数组</code>，在浏览器中还有<code>window对象</code>、<code>document对象</code>等，这些都是存在堆空间的。</li></ul></li> <li>全局执行上下文
<ul><li><code>执行上下文</code>中主要包含三部分，<code>变量环境</code>、<code>词法环境</code>和 <code>this</code> 关键字。</li> <li><code>全局执行上下文</code>在 V8 的生存周期内是不会被销毁的，它会一直保存在堆中。</li></ul></li> <li>全局作用域
<ul><li><code>作用域</code>是指程序源代码中<code>定义变量</code>的区域。作用域规定了<code>如何查找变量</code>，也就是确定当前执行代码对变量的访问权限。</li> <li>JavaScript 采用词法作用域(lexical scoping)，也就是静态作用域。</li> <li>同一个全局执行上下文中，都能存在多个作用域。</li></ul></li></ul></li> <li><code>惰性解析</code>与闭包
<ul><li>所谓<code>惰性解析</code>是指解析器在解析的过程中，如果遇到<code>函数声明</code>，那么会<code>跳过</code>函数内部的代码，并不会为其生成<code>AST</code>和<code>字节码</code>，而仅仅生成顶层代码的<code>AST</code>和<code>字节码</code>。</li> <li>但是当遇到<code>闭包问题</code>所导致的引用<code>外部执行上下文中的变量</code>的情况时，就会导致如何保存外部执行上下文的问题，而<code>预解析器</code>就是解决这问题的。
<ul><li><code>预解析器</code>可以判断当前函数是不是存在一些语法上的错误</li> <li><code>预解析器</code>另外的一个重要的功能就是检查函数内部是否引用了<code>外部变量</code>，如果引用了外部的变量，<code>预解析器</code>会将栈中的变量<code>复制到堆中</code>，在下次执行到该函数的时候，直接使用<code>堆中的引用</code>，这样就解决了闭包所带来的问题。</li></ul></li></ul></li> <li>V8执行JS过程
<ul><li><code>字节码</code>：<code>解释器（Ignition）</code>根据<code>AST</code>来生成<code>字节码</code>（也称中间码）。
<ul><li><code>字节码</code>降低了内存占用，主要还是直接编译成二进制机器代码会占用过多内存。</li> <li><code>字节码</code>提升代码启动速度，生成机器代码比生成<code>字节码</code>需要花费更久的时间。</li> <li><code>字节码</code>可以降低代码的复杂度。</li></ul></li> <li><code>优化编译器</code>：当存在热代码的时候，V8 会借着<code>TurboFan</code>将为<code>热代码</code>的<code>字节码</code>转为<code>机器码</code>并缓存下来。
<ul><li>当热代码经过修改，则<code>TurboFan</code>会将<code>热代码</code>退回到<code>AST</code>这一步，这个时候解释器会重新解释执行被修改的代码。</li></ul></li> <li>流程图片
<img src="https://cdn.jsdelivr.net/gh/artoriaschan/image-hosting@master/blog/upload_2df821c7eb5ae566121a391292f48a42.5obkm9fjrf40.webp" alt="flow"></li> <li><a href="https://www.zoo.team/article/the-process-of-executing-js-in-v8" target="_blank" rel="noopener noreferrer">v8 执行 js 的过程<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></li> <li>垃圾回收
<ul><li>目前<code>V8</code>采用了两个垃圾回收器，主垃圾回收器 - <code>Major GC</code>和副垃圾回收器 - <code>Minor GC</code>(Scavenger)。<code>V8</code>之所以使用了两个垃圾回收器，主要是受到了<code>代际假说</code>（The Generational Hypothesis）的影响。</li> <li>在<code>V8</code>中，会把堆分为<code>新生代</code>和<code>老生代</code>两个区域，<code>新生代</code>中存放的是生存时间短的对象，<code>老生代</code>中存放生存时间久的对象。</li> <li>副垃圾回收器 - <code>Minor GC</code>(Scavenger)，主要负责<code>新生代</code>的垃圾回收；主垃圾回收器 - <code>Major GC</code>，主要负责<code>老生代</code>的垃圾回收。</li> <li>副垃圾回收器 - <code>Minor GC</code> <ul><li>新生代中的垃圾数据用<code>Scavenge</code>算法来处理。所谓<code>Scavenge</code>算法，是把新生代空间对半划分为两个区域，一半是<code>对象区域</code> (from-space)，一半是<code>空闲区域</code> (to-space)。
<ul><li>在垃圾回收过程中，首先要对对象区域中的对象做<code>标记</code>；标记完成之后，就进入<code>垃圾清理阶段</code>。</li> <li>副垃圾回收器会把这些存活的对象<code>复制</code>到空闲区域中，同时它还会把这些对象有序地排列起来，所以这个复制过程，也就相当于完成了<code>内存整理</code>操作，复制后空闲区域就没有内存碎片了。</li> <li>完成复制后，对象区域与空闲区域进行角色翻转。</li></ul></li> <li>为了执行效率，一般新生区的空间会被设置得比较小。</li> <li>副垃圾回收器还会采用<code>对象晋升策略</code>，也就是移动那些经过两次垃圾回收依然还存活的对象到<code>老生代</code>中。</li></ul></li> <li>主垃圾回收器 - <code>Major GC</code> <ul><li>主垃圾回收器是采用<code>标记 - 清除</code>（Mark-Sweep）的算法进行垃圾回收的。
<ul><li><code>标记阶段</code>就是从一组根元素开始，递归遍历这组根元素，在这个遍历过程中，能到达的元素称为活动对象，没有到达的元素就可以判断为垃圾数据。</li> <li>接下来就是垃圾的<code>清除过程</code>。主垃圾回收器会直接将标记为<code>垃圾的数据清理掉</code>。</li></ul></li> <li>对一块内存多次执行<code>标记 - 清除</code>算法后，会产生大量不连续的<code>内存碎片</code>，这时又引入了<code>标记 - 整理</code>（Mark-Compact）算法用于内存整理。
<ul><li>先标记可回收对象，让所有存活的对象都向一端移动。</li> <li>然后直接清理掉这一端之外的内存。</li></ul></li></ul></li></ul></li> <li>其他优化
<ul><li>快属性与慢属性
<ul><li><code>V8</code>实现对象存储时，并没有完全采用<code>字典</code>的存储方式，这是因为<code>字典</code>是<code>非线性</code>的数据结构，查询效率会<code>低于线性</code>的数据结构。</li> <li>在<code>ECMAScript</code>规范中定义了<code>数字属性</code>应该按照索引值<code>大小升序排列</code>，<code>字符串属性</code>根据创建时的<code>顺序升序排列</code>。</li> <li>把对象中的<code>数字属性</code>称为<code>排序属性</code>，在<code>V8</code>中被称为<code>elements</code>，<code>字符串属性</code>就被称为<code>常规属性</code>，在<code>V8</code>中被称为<code>properties</code>。</li> <li>在<code>V8</code>内部，为了有效地提升存储和访问这两种属性的性能，分别使用了两个<code>线性数据结构</code>来分别保存<code>排序属性</code>和<code>常规属性</code>。</li> <li>将不同的属性分别保存到<code>elements属性</code>和<code>properties属性</code>中，无疑简化了程序的复杂度，但是在查找元素时，却多了一步查找操作。</li> <li><code>V8</code>采取了一个权衡的策略以加快查找属性的效率，这个策略是将部分常规属性<code>直接存储</code>到对象本身，我们把这称为<code>对象内属性</code> (in-object properties)。不过对象内属性的数量是<code>固定</code>的，默认是<code>10</code>个。</li> <li>我们将保存在<code>线性数据结构</code>中的属性称之为<code>“快属性”</code>。如果一个对象的<code>属性过多</code>时，<code>V8</code>就会采取另外一种存储策略，那就是<code>“慢属性”</code>策略，但<code>慢属性</code>的对象内部会有独立的<code>非线性数据结构</code> (词典) 作为<code>属性存储容器</code>。</li></ul></li> <li>隐藏类
<ul><li><code>V8</code>在运行<code>JavaScript</code>的过程中，会假设<code>JavaScript</code>中的对象是<code>静态</code>的，具体地讲，<code>V8</code>对每个对象做如下两点假设：
<ul><li>对象创建好了之后就<code>不会添加</code>新的属性。</li> <li>对象创建好了之后也<code>不会删除</code>属性。</li></ul></li> <li>符合这两个假设之后，<code>V8</code>会为每个对象创建一个<code>隐藏类</code>，对象的<code>隐藏类</code>中记录了该对象一些基础的<code>布局信息</code>，包括以下两点：
<ul><li>对象中所包含的<code>所有的属性</code>。</li> <li>每个属性相对于对象的<code>偏移量</code>。</li> <li>在<code>V8</code>中，把<code>隐藏类</code>又称为<code>map</code>，每个对象都有一个<code>map</code>属性，其值指向内存中的<code>隐藏类</code>。</li></ul></li> <li>有了<code>map</code>之后，当你再次访问<code>对象属性</code>时，<code>V8</code>会查询对象的<code>map</code>中属性相对对象起始地址的<code>偏移量</code>，然后将对象起始地址加上<code>偏移量</code>，就得到了所查找的属性的值在内存中的位置。</li></ul></li></ul></li></ul> <h3 id="从输入url到页面展示出来-浏览器都经历了什么步骤"><a href="#从输入url到页面展示出来-浏览器都经历了什么步骤" class="header-anchor">#</a> 从输入URL到页面展示出来，浏览器都经历了什么步骤</h3> <ul><li>URL解析</li> <li>DNS查询(包括CDN地址查询)</li> <li>TCP连接</li> <li>HTTP请求</li> <li>响应请求</li> <li>页面渲染</li></ul> <h2 id="框架"><a href="#框架" class="header-anchor">#</a> 框架</h2> <h3 id="vue"><a href="#vue" class="header-anchor">#</a> Vue</h3> <ul><li><p>双向绑定</p> <ul><li><code>new Vue()</code>首先执行初始化，对<code>data</code>执行响应化处理，这个过程发生<code>Observe</code>中。</li> <li>同时对模板执行<code>编译</code>，找到其中<code>动态绑定</code>的数据，从<code>data</code>中获取并初始化视图，这个过程发生在<code>Compile</code>中。</li> <li>同时定义⼀个<code>更新函数</code>和<code>Watcher</code>，将来对应数据变化时<code>Watcher</code>会调用更新函数。</li> <li>由于<code>data</code>的某个<code>key</code>在⼀个视图中可能出现多次，所以每个<code>key</code>都需要⼀个管家<code>Dep</code>来管理多个<code>Watcher</code>。</li> <li>将来<code>data</code>中数据⼀旦发生变化，会首先找到对应的<code>Dep</code>，通知所有<code>Watcher</code>执行更新函数。
<img src="https://cdn.jsdelivr.net/gh/artoriaschan/image-hosting@master/blog/1584426603806-61f9354f-785c-4e82-beff-b2c09e13611b.49atpgjgqy00.webp" alt="flow"></li></ul></li> <li><p>为什么<code>data</code>属性是一个<code>函数</code>而不是一个<code>对象</code>？</p> <ul><li><code>根实例对象</code>data可以是<code>对象</code>也可以是<code>函数</code>（根实例是单例），<strong>不</strong>会产生<code>数据污染</code>情况</li> <li><code>组件实例对象</code>data必须为<code>函数</code>，目的是为了防止多个组件实例对象之间<code>共用</code>一个data，产生<code>数据污染</code>。采用<code>函数</code>的形式，<code>initData</code>时会将其作为工厂函数都会返回全新<code>data</code>对象</li></ul></li> <li><p><code>动态</code>给<code>Vue</code>的<code>data</code>添加一个<code>新属性</code>时会发生什么？怎样解决？</p> <ul><li><code>Object.defineProperty</code>不能实现对象新增属性的拦截</li> <li>可采取下面三种解决方案：
<ul><li><code>Vue.set()</code></li> <li><code>Object.assign()</code></li> <li><code>$forceUpdate</code></li></ul></li></ul></li> <li><p>异步批量更新</p> <ul><li>当响应式数据修改时，会触发 <code>setter</code> ，而 <code>setter</code> 会调用 <code>dep.notify</code> 方法，通知所有的 <code>watcher</code> 更新视图</li> <li>在调用 <code>watcher.update</code> 时，正常情况下会调用到 <code>queueWatcher</code> 函数，将当前的 <code>watcher</code> 放入 <code>queue</code> 中</li> <li>最后在 <code>nextTick</code> 中执行 <code>flushSchedulerQueue</code> 函数，遍历 <code>queue</code> 中所有的 <code>watcher</code> ，执行 <code>watcher.run</code> 方法</li></ul></li> <li><p>$set实现</p></li> <li><p>nextTick实现</p> <ul><li>Promise实现</li> <li>MutationObserver实现</li> <li>setImmediate实现</li> <li>setTimeout实现</li></ul></li> <li><p>插件</p> <ul><li>插件通常用来为 Vue 添加全局功能。
<ul><li>添加全局方法或者属性。</li> <li>添加全局资源：指令/过滤器/过渡等。</li> <li>通过全局混入来添加一些组件选项。</li> <li>添加 Vue 实例方法，通过把它们添加到 Vue.prototype 上实现。</li> <li>提供第三方库的API，同时提供上面提到的一个或多个功能。</li></ul></li> <li>插件实现：</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>MyPlugin<span class="token punctuation">.</span><span class="token function-variable function">install</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">Vue<span class="token punctuation">,</span> options</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. 添加全局方法或 property</span>
  Vue<span class="token punctuation">.</span><span class="token function-variable function">myGlobalMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 逻辑...</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// 2. 添加全局资源</span>
  Vue<span class="token punctuation">.</span><span class="token function">directive</span><span class="token punctuation">(</span><span class="token string">'my-directive'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    <span class="token function">bind</span> <span class="token punctuation">(</span><span class="token parameter">el<span class="token punctuation">,</span> binding<span class="token punctuation">,</span> vnode<span class="token punctuation">,</span> oldVnode</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 逻辑...</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 3. 注入组件选项</span>
  Vue<span class="token punctuation">.</span><span class="token function">mixin</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">created</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// 逻辑...</span>
    <span class="token punctuation">}</span>
    <span class="token operator">...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token comment">// 4. 添加实例方法</span>
  <span class="token class-name">Vue</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">$myMethod</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">methodOptions</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// 逻辑...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div></li> <li><p>组件通讯</p> <ul><li><p>父子组件之间的通信</p> <ul><li><code>props</code></li> <li><code>emit</code></li> <li><code>ref</code></li></ul></li> <li><p>兄弟组件之间的通信</p> <ul><li><code>EventBus</code></li> <li>通过共同祖辈<code>$parent</code>或者<code>$root</code>搭建通信桥连</li></ul></li> <li><p>祖孙与后代组件之间的通信</p> <ul><li>设置批量向下传属性<code>$attrs</code>和<code>$listeners</code></li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code>  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>Grandson</span> <span class="token attr-name">v-bind</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$attrs<span class="token punctuation">&quot;</span></span> <span class="token attr-name">v-on</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>$listeners<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>Grandson</span><span class="token punctuation">&gt;</span></span>  
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><code>provide</code>与<code>inject</code></li></ul></li> <li><p>非关系组件间之间的通信</p> <ul><li><code>vuex</code></li></ul></li></ul></li> <li><p>常用修饰符</p> <ul><li>表单修饰符
<ul><li><code>lazy</code></li> <li><code>trim</code></li> <li><code>number</code></li></ul></li> <li>事件修饰符
<ul><li><code>stop</code>：阻止事件冒泡</li> <li><code>prevent</code>：阻止事件的默认行为</li> <li><code>self</code></li> <li><code>once</code></li> <li><code>capture</code>：使事件触发在捕获阶段</li> <li><code>passive</code></li> <li><code>native</code>：绑定事件到组件的根元素</li></ul></li> <li>鼠标按键修饰符
<ul><li><code>left</code>：左键点击</li> <li><code>right</code>：右键点击</li> <li><code>middle</code>：中键点击</li></ul></li> <li>键值修饰符：键盘修饰符是用来修饰键盘事件。</li> <li>v-bind修饰符
<ul><li><code>sync</code>：会扩展成一个更新父组件绑定值的<code>v-on</code>侦听器。</li> <li><code>prop</code>：作为一个<code>DOM property</code>绑定而不是作为<code>HTML attribute</code>绑定。
<ul><li><code>HTML attributes</code>为定义在<code>HTML元素</code>标签上的属性</li> <li><code>DOM properties</code>为<code>HTML标签</code>对应的<code>DOM对象</code>上的属性</li> <li>很多<code>HTML attributes</code>在<code>DOM对象</code>上有与之同名的<code>DOM properties</code></li> <li><code>HTML attributes</code>的作用是给<code>DOM properties</code>附初始值</li></ul></li> <li><code>camel</code>：将<code>kebab-case attribute</code>转换为<code>camelCase</code>。</li></ul></li></ul></li></ul> <h3 id="vue3"><a href="#vue3" class="header-anchor">#</a> Vue3</h3> <ul><li>新特性
<ul><li>TypeScript重写，更友好的TS支持，更好的类型检测</li> <li>全新设计的<code>响应式API</code> <ul><li>通过<code>Proxy</code>实现响应式数据</li></ul></li> <li><code>diff</code>算法优化</li> <li>编译优化
<ul><li><code>Block</code>与<code>PatchFlags</code> <ul><li>使用一系列<code>PatchFlags</code>标记，对<code>动态节点</code>进行说明。在创建阶段将<code>动态节点</code>添加到<code>dynamicChildren</code>中。把带有该属性的<code>虚拟节点</code>称为<code>块（Block）</code>。</li> <li>一个<code>Block</code>不仅能收集他的<code>直接动态子节点</code>，还能够收集所有<code>动态子代节点</code>。</li> <li>在<code>Block</code>中，渲染器的更新操作是以<code>Block</code>为维度。直接更新<code>dynamicChildren</code>数组中的<code>动态节点</code>。</li> <li>由于<code>dynamicChildren</code>数组收集的<code>动态节点</code>是忽略<code>虚拟DOM</code>的<code>树层级</code>的。所以会导致更新失败的问题。例如带<code>v-if</code>和<code>v-for</code>指令的节点。而解决方案则如下：
<ul><li>将带有<code>v-if</code>、<code>v-else-if</code>、<code>v-else</code>指令的节点也变成<code>Block</code>。</li> <li>将<code>v-for</code>指令的节点变成<code>Block</code>，并且用<code>Fragment</code>类型表达<code>v-for</code>指令的渲染结果。</li> <li>当<code>Fragment</code>中的动态节点<code>结构不稳定</code>时，即更新前后同一个<code>Block</code>的<code>dynamicChildren</code>数组中收集的<code>动态节点</code>数量和顺序<code>不一致</code>时，则直接抛弃根据<code>dynamicChildren</code>进行<code>靶向更新</code>的手段。使用<code>children</code>进行<code>diff</code>操作进行更新。</li></ul></li></ul></li> <li>静态提升
<ul><li>将<code>纯静态节点</code>的渲染提升到<code>渲染函数</code>之外。</li> <li>静态提升是以<code>树</code>为单位。</li> <li>将<code>纯静态props</code>提升到<code>渲染函数</code>之外。</li></ul></li> <li>预字符串化
<ul><li><code>预字符串化</code>是基于<code>静态提升</code>的一种优化策略。当模板中大量存在连续<code>纯静态节点</code>被<code>静态提升</code>后，<code>预字符串化</code>能够将这些<code>静态节点</code>序列化为<code>字符串</code>。</li> <li>大量静态内容通过<code>innerHTML</code>进行设置，在性能上有一定优势。</li> <li>减少创建虚拟节点产生的<code>性能开销</code>。</li> <li>减少<code>内存占用</code>。</li></ul></li> <li>事件监听缓存</li></ul></li> <li>引入<code>Tree-Shaking</code>，减少打包体积</li></ul></li> <li>diff算法
<ul><li>diff算法主要应用在<code>新旧节点</code>存在一组<code>新旧子节点</code>的情况下。</li> <li>简单diff算法
<ul><li>最简单的操作逻辑是，对于<code>newChildren</code>和<code>oldChildren</code>，挨个比对，执行<code>patch函数</code>打补丁。
<ul><li>对于不同<code>vnode.type</code>，直接卸载旧节点，挂载新节点。</li> <li>对于<code>vnode.type</code>相同，则直接复用<code>DOM</code>更新内容。</li></ul></li> <li>但上面的操作在有不同类型子节点移动时不是最优的<code>DOM</code>操作。所以我们要做以下优化：
<ul><li>要考虑到节点的<code>移动</code>情况，更大程度上复用存在的<code>DOM</code>，以减少<code>DOM</code>操作。</li> <li>不能单单根据<code>vnode.type</code>来判断节点是否相同，这个判断对于子节点<code>类型相同</code>，但其<code>children</code>不相同则会判断失效。</li> <li>这时需要引入<code>key</code>，使<code>vnode.type</code>与<code>key</code>共同定位一个节点。</li></ul></li> <li>如何找到需要移动的元素？
<ul><li>遍历新子节点，获取新子节点在旧子节点中的索引<code>index</code>，判断<code>索引值</code>与当前遇到的<code>最大索引值</code><strong>lastIndex</strong>的大小关系，如果比当前遇到的<code>最大索引值</code><strong>小</strong>，则说明该节点需要移动。</li> <li>移动节点指的是，移动一个<code>vnode</code>对应的真实<code>DOM</code>节点。</li></ul></li> <li>如何移动节点？
<ul><li>当判断当前节点需要移动时，直接将当前节点<code>vnode.el</code>对应的<code>DOM</code>节点移动到<code>lastIndex</code>对应的虚拟节点<code>vnode.el</code>的<code>DOM</code>节点后面即可。</li></ul></li> <li>如何处理新增节点？
<ul><li>定义<code>find</code>变量，用于标识是否找到<code>可复用节点</code>。若未找到即<code>find</code>为<code>false</code>，则走新节点<code>挂载</code>逻辑。</li> <li>此时需要找到当前<code>newVnode</code>在<code>newChildren</code>中的<code>前一个</code>节点，如果存在，则使用<code>前一个节点</code>的<code>DOM</code>的<code>下一个兄弟节点</code>作为<code>锚点</code>，若无则使用容器元素的第一个<code>DOM</code>子节点作为<code>锚点</code>，将新节点挂载在<code>锚点</code>之前。</li></ul></li> <li>如何移除不存在的节点呢？
<ul><li>在对比完<code>新旧节点</code>后，重新遍历一遍<code>旧节点</code>，挨个判断是否存在<code>新节点</code>中，没有则直接<code>卸载</code>即可。</li></ul></li></ul></li> <li>双向diff算法
<ul><li>简单diff算法是存在<code>弊端</code>的，主要是在于他对DOM的<code>移动操作</code>不是最优的。</li> <li>双端diff算法是一种同时对新旧两组子节点的<code>两个端点</code>进行比较的算法，需要四个变量来表示<code>新旧双端</code>的索<code>引</code>，即<code>oldStartIdx</code>，<code>oldEndIdx</code>，n<code>ewStartIdx</code>，<code>newEndIdx</code>。</li> <li>这时我们需要循环的按照以下步骤进行比较，找出能复用的节点，并执行相关的操作，循环条件为<code>oldStartIdx &lt;= oldEndIdx &amp;&amp; newStartIdx &lt;= newEndIdx</code>：
<ul><li><code>newStartIdx</code>对应节点与<code>oldStartIdx</code>对应节点比较，<code>oldStartVnode.key === newStartVnode,key</code> <ul><li>都处于头部，不需要真实DOM移动，只需要<code>打补丁</code>即可。</li></ul></li> <li><code>newEndIdx</code>对应节点与<code>oldEndIdx</code>对应节点比较，<code>oldEndVnode.key === newEndVnode,key</code> <ul><li>都处于尾部，不需要真实DOM移动，只需要<code>打补丁</code>即可。</li></ul></li> <li><code>newEndIdx</code>对应节点与<code>oldStartIdx</code>对应节点比较，<code>oldStartVnode.key === newEndVnode.key</code> <ul><li>将<code>oldStartIdx</code>所指向的<code>vnode</code>对应的<code>真实DOM</code>移动到<code>oldEndIdx</code>所指向的<code>vnode</code>所对应的<code>真实DOM</code>后。</li> <li>锚点为<code>oldEndVnode.el.nextSibling</code>。</li></ul></li> <li><code>newStartIdx</code>对应节点与<code>oldEndIdx</code>对应节点比较，<code>oldEndVnode.key === newStartVnode.key</code> <ul><li>将<code>oldEndIdx</code>所指向的<code>vnode</code>对应的<code>真实DOM</code>移动到<code>oldStartIdx</code>所指向的<code>vnode</code>所对应的<code>真实DOM</code>前。</li> <li>锚点为<code>oldStartVnode.el</code>。</li></ul></li> <li>当没有命中上述四种情况时，我们需要拿新的一组子节点的<code>头部节点(newStartVnode)</code>去旧的一组子节点中寻找。
<ul><li>若在旧子节点中找到：
<ul><li>我们将其移动到<code>oldStartVnode</code>节点之前</li> <li>并且将其在旧节点中的索引对应的元素置为<code>undefined</code>。</li></ul></li> <li>若未在旧子节点中找到，则说明该节点为新增节点
<ul><li>只需要将其挂载到<code>当前头部节点（oldStartVnode）</code>之前即可</li></ul></li></ul></li></ul></li> <li>在执行完上述循环后，我们需要考虑可能会遗漏<code>新增子节点</code>的问题，所以我们需要判断<code>oldEndIdx &lt; oldStartIdx &amp;&amp; newStartIdx &lt;= newEndIdx</code>是否成立，若成立则代表存在遗漏<code>新增子节点</code>。
<ul><li>这时我们需要循环遍历<code>[newStartIdx, newEndIdx]</code>范围的新子节点，依次将其挂载到当前<code>头部节点（oldStartVnode）</code>之前。</li></ul></li> <li>这时我们需要考虑<code>移除不存在的元素</code>的问题。依旧是根据索引进行判断，<code>newEndIdx &lt; newStartIdx &amp;&amp; oldStartIdx &lt;= oldEndIdx</code>，若成立则代表存在需要<code>移除的节点</code>。
<ul><li>这时我们需要循环遍历<code>[oldStartIdx, oldEndIdx]</code>范围的旧子节点，依次将其卸载即可。</li></ul></li></ul></li> <li>快速diff算法
<ul><li>快速diff算法参考纯文本diff算法的思路，增加了<code>预处理</code>步骤。
<ul><li>首先声明索引变量<code>j = 0</code>，<code>正向遍历</code>新旧两组节点，遇到相同节点<code>打补丁</code>即可。并继续向下遍历。</li> <li>若遇到不同节点，则跳出遍历循环。分别获取新旧节点的<code>newEnd</code>和<code>oldEnd</code>索引，<code>反向遍历</code>两组节点。遇到相同节点打补丁即可，并继续向上遍历。</li></ul></li> <li>新增节点的情况
<ul><li>当<code>oldEnd &lt; j</code>时，说明<code>预处理</code>阶段，所有<code>旧节点</code>遍历完毕。此时判断<code>newEnd &gt;= j</code>，若成立，则说明<code>新节点</code>中，仍有<code>未处理</code>的<code>新节点</code>。</li> <li>此时我们需要单独处理这些<code>未处理</code>的<code>新节点</code>，判断条件为<code>oldEnd &lt; j &amp;&amp; newEnd &gt;= j</code>。在新节点中，这些节点都是挂载在<code>newEnd + 1</code>的<code>vnode</code>对应的<code>真实DOM</code>节点之前，所以以n<code>ewChildren[newEnd + 1].el</code>为锚点，依次将<code>未处理</code>的<code>新节点</code>插入到<code>锚点</code>之前。</li></ul></li> <li>删除节点的情况
<ul><li>当<code>newEnd &lt; j</code>时，说明<code>预处理</code>阶段，所有<code>新节点</code>遍历完毕。此时判断<code>oldEnd &gt;= j</code>，若成立，则说明<code>旧节点</code>中，有需要<code>卸载</code>的<code>旧节点</code>。</li> <li>此时依次遍历<code>未卸载</code>的节点，依次<code>卸载</code>即可。</li></ul></li> <li>节点存在移动的情况
<ul><li>上述的分析建立在预处理后恰好有一组节点<code>处理完成</code>的情况，但是这种理想情况并非常态，可能会出现预处理后两组节点都存在的情况。</li> <li>首先我们需要新建一个<code>source</code>数组用来维护相同的<code>新节点</code>在<code>旧节点序列</code>中的<code>位置索引</code>，用于计算出<code>最长递增序列</code>，辅助完成<code>DOM移动</code>操作。</li> <li>在生成<code>source</code>数组时，可以通过创建<code>{key:newIndex}</code>的索引表<code>keyIndex</code>，将 <mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="O"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-msup><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-script style="vertical-align:0.363em;"><mjx-mn size="s" class="mjx-n"><mjx-c c="2"></mjx-c></mjx-mn></mjx-script></mjx-msup><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo></mjx-math></mjx-container> 的时间复杂度降为 <mjx-container jax="CHTML" class="MathJax"><mjx-math class=" MJX-TEX"><mjx-mi class="mjx-i"><mjx-c c="O"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c="("></mjx-c></mjx-mo><mjx-mi class="mjx-i"><mjx-c c="n"></mjx-c></mjx-mi><mjx-mo class="mjx-n"><mjx-c c=")"></mjx-c></mjx-mo></mjx-math></mjx-container> 。<code>source</code>数组的<code>index</code>代表相同的<code>新子节点</code>的<code>相对位置索引</code>，索引所对应的<code>元素</code>则是在<code>旧子节点</code>序列中的<code>位置索引</code>。</li> <li>在得到<code>source</code>数组后，我们通过遍历<code>旧节点</code>，从<code>keyIndex</code>中根据<code>旧节点的key</code>获取在<code>新节点序列</code>中的<code>k</code>，判断<code>k</code>是否存在
<ul><li>如果<code>存在</code>，则说明<code>旧节点</code>复用，则进行<code>打补丁</code>操作，并且顺便判断是否存在需要移动
<ul><li>我们使用<code>pos</code>来保存<code>最大索引值</code>，使用<code>moved</code>来保存<code>是否移动</code>的状态
<ul><li>当<code>pos &gt; k</code>时，将<code>moved</code>置为<code>true</code></li> <li>反之则将<code>k</code>赋值给<code>pos</code></li></ul></li></ul></li> <li>如果<code>不存在</code>，则说明<code>旧节点</code>需要<code>移除</code>，直接<code>卸载</code>即可。</li> <li>在这之中使用<code>patched</code>保存<code>已经更新过</code>的节点数量，当<code>patched &gt; count</code>时，直接<code>卸载旧节点</code>即可。<code>count</code>为<code>待更新</code>的<code>新节点</code>的<code>数量</code>。</li></ul></li> <li>此时<code>moved</code>为<code>true</code>时，说明需要处理<code>DOM移动</code>。
<ul><li>首先根据<code>source</code>数组获取<code>最大递增子序列</code><strong>seq</strong>，并获取其在<code>source</code>数组中的<code>位置索引</code>。此时<code>最大递增子序列</code>代表在<code>新旧子节点</code>更新时，所对应的节点的<code>位置</code>相对<code>没有变化</code>。</li> <li>此时我们需要<code>反向</code>遍历<code>剩余新节点</code>，声明<code>i</code>和<code>s</code>，分为为<code>剩余新子节点</code>及<code>seq</code>的索引，并都指向序列的<code>最后一位</code>：
<ul><li>source[i] === -1，说明当前节点是<code>新增节点</code>，直接<code>挂载</code>，<code>挂载锚点</code>为其<code>下一个节点</code>对应的<code>真实DOM</code>。锚点为<code>newChildren[pos + 1].el</code>。</li> <li>i !== seq[s]，说明当前节点需要移动，将其移动到其在<code>newChildren</code>中对应的<code>下一个节点</code>对应的<code>真实DOM</code>之前。锚点为<code>newChildren[pos + 1].el</code>。</li> <li>i === seq[s]，说明节点不需要移动，<code>s--</code>。</li></ul></li></ul></li></ul></li></ul></li></ul></li></ul> <h3 id="ssr"><a href="#ssr" class="header-anchor">#</a> SSR</h3> <ul><li><p>CSR：浏览器获取HTML，加载静态资源，并进行解释和执行，ajax技术请求API数据，浏览器根据数据进行动态内容的渲染，最终呈现完整页面。</p></li> <li><p>SSR：服务器根据模板及数据拼接出最终的HTML字符串，然后发送给浏览器，浏览器解析HTML内容并渲染</p></li> <li><p>CSR与SSR的区别</p> <ul><li>对于CSR来说，SEO不友好，存在白屏问题，但是对服务器资源占用少，并且用户体验友好</li> <li>相对来说SSR，则是恰好相反，占用服务器资源多，并且用户体验不友好，但是对于SEO来说则是友好，由于SSR的内容到达时间更快，所以说没有白屏问题</li></ul></li> <li><p>优点</p> <ul><li>更快的内容到达时间</li> <li>统一的心智模型</li> <li>更好的 SEO</li></ul></li> <li><p>同构渲染</p> <ul><li>同构渲染分为首次渲染和非首次渲染</li> <li>首次渲染
<ul><li>首次渲染的流程与SSR一致，服务端最终会拼接好HTML，并且在HTML中存在静态资源链接。</li> <li>浏览器接收到HTML后会解析HTML字符串，同时也会和CSR一致，加载静态资源，并进行解释和执行，这是JavaScript会进行激活操作，也就是Vue.js中常说的<code>'hydration'</code>。
<ul><li>Vue.js在已经渲染的DOM元素和Vue.js组件所渲染的虚拟DOM之间建立联系。</li> <li>Vue.js从HTML页面中提取由服务端序列化后发送过来的数据，用以初始化整个Vue.js应用程序。</li></ul></li> <li>激活完成后，整个应用程序已经完全被Vue.js接管成为CSR应用。</li> <li>同构渲染并不会提升可交互时间（TTI）</li></ul></li></ul></li> <li><p>开启SSR</p> <ul><li>Vue.js 应用开启SSR，首先需要启动一个Node.js服务，拦截所有路由请求。</li> <li>调用<code>createSSRApp</code>函数生成app实例，并且调用<code>renderToString(app)</code>生成HTML字符串，并且将当前字符串插入到模板的容器元素内，返回给浏览器</li> <li>客户端激活也需要使用<code>createSSRApp</code>，否则无法成功激活。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token comment">// 此文件运行在 Node.js 服务器上</span>
<span class="token keyword">import</span> express <span class="token keyword">from</span> <span class="token string">'express'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createSSRApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> renderToString <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue/server-renderer'</span>

<span class="token keyword">const</span> server <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createSSRApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">data</span><span class="token operator">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span><span class="token punctuation">{</span> count<span class="token operator">:</span> <span class="token number">1</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    template<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;button @click=&quot;count++&quot;&gt;{{ count }}&lt;/button&gt;</span><span class="token template-punctuation string">`</span></span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>

  <span class="token function">renderToString</span><span class="token punctuation">(</span>app<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">html</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
    &lt;!DOCTYPE html&gt;
    &lt;html&gt;
      &lt;head&gt;
        &lt;title&gt;Vue SSR Example&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        &lt;div id=&quot;app&quot;&gt;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>html<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&lt;/div&gt;
      &lt;/body&gt;
    &lt;/html&gt;
    </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

server<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'ready'</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 该文件运行在浏览器中</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> createSSRApp <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vue'</span>

<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">createSSRApp</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  <span class="token comment">// ...和服务端完全一致的应用实例</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">// 在客户端挂载一个 SSR 应用时会假定</span>
<span class="token comment">// HTML 是预渲染的，然后执行激活过程，</span>
<span class="token comment">// 而不是挂载新的 DOM 节点</span>
app<span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">'#app'</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br></div></div></li> <li><p>客户端激活</p> <ul><li>当应用的代码在客户端执行时不会再次创建DOM元素，而是做了如下两件事情：
<ul><li>在页面中的DOM元素与虚拟节点对象之间建立联系</li> <li>为页面中的DOM元素添加事件绑定</li></ul></li></ul></li> <li><p>注意事项</p> <ul><li>服务端渲染时应用的当前快照，不存在数据变更后重新渲染的情况。</li> <li>服务端渲染由于不需要渲染真实的DOM元素，所以只会触发组件的<code>beforeCreate</code>和<code>onCreated</code>钩子。</li> <li>因为组件的代码既在浏览器中执行，又在Node.js环境中执行，所以避免使用平台特有API，如果非要使用的话，可以根据环境判断执行，或者将API的调用执行放入<code>onMounted</code>钩子中。</li> <li>为了避免不同请求公用一个应用实例导致状态污染，在服务端渲染时，我们需要为每一个请求创建一个全新的应用实例。</li> <li>对于只想在客户端渲染的组件，可以使用<code>&lt;ClientOnly&gt;</code>进行包裹。</li> <li>对于想在服务端渲染预先加载的接口数据，可以使用<code>onServerPrefetch</code>钩子执行接口请求。</li></ul></li></ul> <h3 id="react"><a href="#react" class="header-anchor">#</a> React</h3> <ul><li>this.setState
<ul><li>legacy模式
<ul><li>能获取executionContext(例如用户事件)时，是异步执行的</li> <li>不能获取executionContext(例如setTimeout)时，是同步执行的</li></ul></li> <li>concurrent模式
<ul><li>concurrent模式下的setState永远都是异步调度的</li></ul></li> <li>批量更新
<ul><li>根据更新的优先级判断，如果多次的更新优先级相同，则不会再去向调度器注册一次更新任务，而是直接return。</li></ul></li></ul></li> <li>声明周期
<ul><li>挂载
<ul><li><code>constructor()</code></li> <li><code>getDerivedStateFromProps()</code></li> <li><code>UNSAFE_componentWillMount()</code>：即将弃用，不推荐使用</li> <li><code>render()</code></li> <li><code>componentDidMount()</code></li></ul></li> <li>更新
<ul><li><code>getDerivedStateFromProps()</code></li> <li><code>UNSAFE_componentWillReceiveProps()</code>：即将弃用，不推荐使用</li> <li><code>shouldComponentUpdate()</code></li> <li><code>UNSAFE_componentWillUpdate()</code>：即将弃用，不推荐使用</li> <li><code>render()</code></li> <li><code>getSnapshotBeforeUpdate()</code></li> <li><code>componentDidUpdate()</code></li></ul></li> <li>卸载
<ul><li><code>componentWillUnmount()</code></li></ul></li> <li>错误处理
<ul><li><code>getDerivedStateFromError()</code></li> <li><code>componentDidCatch()</code></li></ul></li></ul></li> <li>合成事件
<ul><li><code>React</code>基于<code>浏览器</code>的<code>事件机制</code>自身实现了一套<code>事件机制</code>，包括<code>事件注册</code>、<code>事件合成</code>、<code>事件冒泡</code>、<code>事件派发</code>等。</li> <li><code>React</code>通过<code>事件代理</code>，将所有事件都挂载在<code>根DOM节点</code>对象上。</li></ul></li> <li>高阶组件
<ul><li>在<code>React</code>中，<code>高阶组件</code>即接受<code>一个</code>或<code>多个组件</code>作为参数并且返回<code>一个组件</code>，本质也就是<code>一个函数</code>，并不是<code>一个组件</code>。</li> <li><code>高阶组件</code>的主要功能是<code>封装</code>并<code>分离</code>组件的<code>通用逻辑</code>，让<code>通用逻辑</code>在组件间更好地被复用。</li> <li>约定
<ul><li>不要改变<code>原始组件</code>，而应该使用<code>组合</code></li> <li>将不相关的<code>props</code>传递给被包裹的组件</li> <li>最大化可<code>组合</code>性</li> <li><code>包装显示名称</code>以便轻松调试</li> <li>不要在<code>render</code>方法中使用<code>HOC</code></li> <li>如果向一个<code>高阶组件</code>添加<code>ref</code>引用，那么<code>ref</code>指向的是最外层容器组件实例的，而不是被包裹的组件，如果需要传递<code>refs</code>的话，则使用<code>React.forwardRef</code>。</li></ul></li></ul></li> <li>HOOKS
<ul><li>解决问题
<ul><li>难以<code>重用</code>和共享组件中的与<code>状态相关的逻辑</code></li> <li>逻辑复杂的组件难以开发与维护，当我们的组件需要处理多个互不相关的<code>local state</code>时，每个生命周期函数中可能会包含着各种互不相关的逻辑在里面</li> <li>类组件中的<code>this</code>增加<code>学习成本</code>，类组件在基于现有工具的优化上存在些许问题</li> <li>由于业务变动，<code>函数组件</code>不得不改为<code>类组件</code>等等</li></ul></li> <li><code>useState</code> <ul><li>返回一个<code>state</code>，以及更新<code>state</code>的函数。</li></ul></li> <li><code>useEffect</code> <ul><li>相当于<code>componentDidMount</code>、<code>componentDidUpdate</code>。</li> <li>与上述生命周期不同的是传给<code>useEffect</code>的函数会在浏览器完成<code>布局</code>与<code>绘制</code>之后，在一个<code>延迟事件</code>中被调用。</li> <li><code>useEffect</code>函数需返回一个<code>清除函数</code>。</li> <li>可以给<code>useEffect</code>传递第二个参数，它是<code>effect</code>所依赖的值<code>数组</code>。实现在<code>依赖项修改</code>后才执行<code>effect</code>。</li></ul></li> <li><code>useContext</code> <ul><li>接收一个<code>context</code>对象（<code>React.createContext</code>的返回值）并返回该<code>context</code>的当前值。</li> <li>调用了<code>useContext</code>的组件总会在<code>context</code>值变化时重新渲染。</li></ul></li> <li><code>useReducer</code> <ul><li><code>state</code>逻辑较复杂且包含<code>多个子值</code>，或者下一个<code>state</code>依赖于之前的<code>state</code>等，<code>useReducer</code>会比<code>useState</code>更适用。</li></ul></li> <li><code>useCallback</code> <ul><li>把<code>内联回调函数</code>及<code>依赖项数组</code>作为参数传入<code>useCallback</code>，它将返回该回调函数的<code>memoized</code>版本，该回调函数仅在某个<code>依赖项改变</code>时才会<code>更新</code>。</li></ul></li> <li><code>useMemo</code> <ul><li>把<code>“创建”函数</code>和<code>依赖项数组</code>作为参数传入<code>useMemo</code>，它仅会在某个<code>依赖项改变</code>时才重新计算<code>memoized值</code>。</li></ul></li> <li><code>useRef</code> <ul><li><code>useRef</code>返回一个可变的<code>ref对象</code>，其<code>.current</code>属性被初始化为传入的参数（initialValue）。返回的<code>ref对象</code>在组件的整个生命周期内持续存在。</li> <li><code>useRef</code>是针对<code>函数组件</code>的，如果是<code>类组件</code>则使用<code>React.createRef</code>。<code>React.createRef</code>也可以在<code>函数组件</code>中使用。</li></ul></li> <li><code>useImperativeHandle</code> <ul><li><code>useImperativeHandle</code>可以让你在使用<code>ref</code>时自定义暴露给<code>父组件</code>的实例值。</li> <li><code>useImperativeHandle</code>应当与<code>React.forwardRef</code>一起使用。</li></ul></li> <li><code>useLayoutEffect</code> <ul><li>其函数签名与<code>useEffect</code>相同，但它会在所有的<code>DOM</code>变更之后<code>同步</code>调用<code>effect</code>。可以使用它来<code>读取DOM布局</code>并<code>同步触发重渲染</code>。</li></ul></li> <li>useDebugValue</li></ul></li> <li>diff算法（协调）
<ul><li>类似<code>简单diff算法</code></li></ul></li></ul> <h2 id="工程化"><a href="#工程化" class="header-anchor">#</a> 工程化</h2> <h3 id="编译工具"><a href="#编译工具" class="header-anchor">#</a> 编译工具</h3> <p>*Babel <a href="https://juejin.cn/post/7025237833543581732" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <ul><li>babel-loader
<ul><li><code>babel-loader</code>的本质就是一个函数，我们匹配到对应的<code>jsx?/tsx?</code>的文件交给<code>babel-loader</code></li></ul></li> <li>@babel/core
<ul><li><code>@babel/core</code>是<code>Babel</code>最核心的一个<code>编译库</code>，他可以将我们的代码进行<strong>词法分析--语法分析--语义分析</strong>过程从而生成<code>AST抽象语法树</code>，从而对于“这棵树”的操作之后再通过<code>编译</code>称为新代码。</li> <li><code>@babel/core</code>通过<code>transform</code>方法将我们的代码进行编译。</li></ul></li> <li>@babel/preset-env
<ul><li><code>@babel/preset-env</code>的主要作用就是告诉<code>Babel</code>我需要以为什么样的规则进行<code>代码转换</code>。</li></ul></li> <li>polyfill
<ul><li><code>@babel/polyfill</code> <ul><li>配合<code>@babel/preset-env</code> <ul><li><code>useBuiltIns: &quot;false&quot;</code>，<code>Babel</code>根据我们配置的浏览器兼容性列表(<code>browserList</code>)，仅仅会转化ES语法，并不会转化任何API和方法。</li> <li><code>useBuiltIns: &quot;entry&quot;</code>，<code>Babel</code>根据我们配置的浏览器兼容性列表(<code>browserList</code>)然后<strong>全量</strong>引入不兼容的<code>polyfills</code>。</li> <li><code>useBuiltIns: &quot;usage&quot;</code>，<code>Babel</code>会根据配置的浏览器兼容性列表(<code>browserList</code>)，以及代码中<code>使用到的API</code>进行引入<code>polyfills</code><strong>按需加载</strong>。</li> <li>在我们使用<code>useBuiltIns:entry/usage</code>时，需要额外指定<code>core-js</code>这个参数。</li></ul></li> <li><code>@babel/polyfill</code>这种方式可能会存在污染全局作用域。</li></ul></li> <li><code>babel/runtime</code>更像是一种<code>按需加载</code>的解决方案，会将引入方式由智能完全交由我们自己，我们需要什么自己引入什么。
<ul><li><code>babel-runtime</code>无法做到智能化分析，需要我们<code>手动引入</code>。</li> <li><code>babel-runtime</code>编译过程中会重复<code>生成冗余代码</code>。</li> <li>配合<code>@babel/plugin-transform-runtime</code>
*通过分析我们的项目中所使用到<code>需要转译的js代码</code>，从而实现模块化从<code>babel-runtime</code>中引入所需的<code>polyfills</code>实现。</li></ul></li> <li><a href="https://www.jmarkoski.com/understanding-babel-preset-env-and-transform-runtime" target="_blank" rel="noopener noreferrer">关于@babel/preset-env与@babel/runtime最佳实践参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li> <li>插件实现
<ul><li>常用类库
<ul><li><code>@babel/core</code>：上边我们说过<code>@babel/core</code>是<code>Babel</code>的核心库，核心的<code>API</code>都在这里。比如上边我们讲到的<code>transform</code>，<code>parse</code>方法。</li> <li><code>@babel/parser</code>：<code>Babel</code>解析器。</li> <li><code>@babel/types</code>：这个模块包含手动构建<code>AST</code>和检查<code>AST</code>节点类型的方法(比如通过对应的<code>API</code>生成对应的节点)。</li> <li><code>@babel/traverse</code>：这个模块用于对<code>AST</code>的遍历，它维护了整棵树的状态(需要注意的是<code>traverse</code>对于<code>AST</code>是一种深度遍历)。</li> <li><code>@babel/generator</code>：这个模块用于代码的生成，通过<code>AST</code>生成新的代码返回。</li></ul></li> <li>工作流程
<ul><li><code>Parse</code>（解析）阶段：这个阶段将我们的<code>js代码</code>(字符串)进行词法分析生成一系列<code>tokens</code>，之后再进行<code>语法分析</code>将<code>tokens</code>组合称为一颗<code>AST抽象语法树</code>。(比如<code>@babel/parser</code>它的作用就是这一步)</li> <li><code>Transform</code>（转化）阶段：这个阶段<code>Babel</code>通过对于这棵树的遍历，从而对于<code>旧AST</code>进行增删改查，将新的<code>js语法节点</code>转化称为浏览器兼容的语法节点。(<code>@babel/traverse</code>就是在这一步进行遍历这棵树)</li> <li><code>Generator</code>（生成）阶段：这个阶段<code>Babel</code>会将<code>新AST</code>转化同样进行深度遍历从而生成新的代码。(<code>@babel/generator</code>)</li></ul></li></ul></li> <li>esbuild</li> <li>swc</li></ul> <h3 id="打包工具"><a href="#打包工具" class="header-anchor">#</a> 打包工具</h3> <ul><li>Webpack
<ul><li>构建流程
<ul><li><code>初始化流程</code>：从配置文件和Shell语句中读取与合并参数，并初始化需要使用的插件和配置插件等执行环境所需要的参数</li> <li><code>编译构建流程</code>：从<code>Entry</code>发出，针对每个<code>Module</code>串行调用对应的<code>Loader</code>去<code>翻译</code>文件内容，再找到该<code>Module</code>依赖的<code>Module</code>，<code>递归</code>地进行编译处理</li> <li><code>输出流程</code>：对<code>编译</code>后的<code>Module</code>组合成<code>Chunk</code>，把<code>Chunk</code>转换成文件，输出到文件系统</li></ul></li> <li>loader
<ul><li>默认情况下，在遇到<code>import</code>或者<code>require</code>加载模块的时候，<code>Webpack</code>只支持对<code>js</code>和<code>json</code>文件打包。</li> <li><code>loader</code>本质上就是一个<code>函数</code>，接受我们的源代码作为入参同时返回处理后的结果。</li> <li>配置loader有三种方式：
<ul><li>配置方式（推荐）：在<code>webpack.config.js</code>文件中指定<code>loader</code></li> <li>内联方式：在每个<code>import</code>语句中显式指定<code>loader</code> <blockquote><p>import Styles from 'style-loader!css-loader?modules!./styles.css'</p></blockquote></li> <li>CLI 方式：在<code>shell</code>命令中指定它们</li></ul></li> <li>特性
<ul><li><code>loader</code>支持<code>链式调用</code>，链中的每个<code>loader</code>会处理之前已处理过的资源，最终变为js代码。顺序为<code>相反顺序</code>执行。</li> <li><code>loader</code>可以是<code>同步</code>的，也可以是<code>异步</code>的</li> <li><code>loader</code>运行在<code>Node.js</code>中，并且能够执行任何操作</li> <li><code>loader</code>能够产生额外的任意文件</li></ul></li> <li>常见loader
<ul><li><code>style-loader</code>: 将<code>css</code>添加到DOM的内联样式标签<code>style</code>里。</li> <li><code>css-loader</code> :允许将<code>css</code>文件通过<code>require</code>的方式引入，并返回<code>css</code>代码。</li> <li>css预处理loader：<code>stylus-loader</code>/<code>less-loader</code>/<code>sass-loader</code>，均为css预处理器解析的<code>loader</code>版本。</li> <li><code>postcss-loader</code>: 用<code>postcss</code>来处理<code>CSS</code>。</li> <li><code>file-loader</code>: 分发文件到<code>output</code>目录并返回相对路径。</li> <li><code>url-loader</code>: 和<code>file-loader</code>类似，但是当文件小于设定的limit时可以返回<code>base64</code>。</li> <li><code>babel-loader</code>：用<code>Babel</code>来转换<code>JS</code>。</li> <li><code>svg-sprite-loader</code>：将会把依赖的svg塞到一个个symbol中，合成一个大的svg。symbol的id如果不特别指定，就是你的文件名。</li> <li><code>svgo-loader</code>：为<code>SVGO</code>的<code>loader</code>版本。<code>SVGO</code>是<code>svg</code>优化器，包含很多插件。</li> <li><code>vue-loader</code>：编译<code>vue单文件组件</code>到<code>render</code>渲染函数。</li></ul></li></ul></li> <li>plugin
<ul><li><code>plugin</code>赋予其各种灵活的功能，例如<code>打包优化</code>、<code>资源管理</code>、<code>环境变量注入</code>等，它们会运行在<code>Webpack</code>的不同阶段（<code>钩子</code>/<code>生命周期</code>），贯穿了<code>Webpack</code>整个<code>编译周期</code>。</li> <li><code>plugin</code>其本质是一个具有<code>apply</code>方法<code>JavaScript</code>对象。<code>apply</code>方法会被<code>Webpack Compiler</code>调用，并且在整个编译生命周期都可以访问<code>Compiler</code>对象。</li> <li><code>plugin</code>通过<code>发布订阅</code>的模式，通过<code>compiler</code>上监听事件。然后再打包编译过程中触发监听的事件从而添加一定的逻辑影响打包结果。</li> <li>常用的编译生命周期钩子有：
<ul><li><code>entry-option</code>：初始化<code>option</code>。</li> <li><code>run</code>：启动一次新的编译。</li> <li><code>compile</code>： 该事件是为了告诉插件一次新的编译将要启动，同时会给插件带上 <code>compiler</code> 对象。</li> <li><code>compilation</code>：当 <code>Webpack</code> 以开发模式运行时，每当检测到文件变化，一次新的 <code>Compilation</code> 将被创建。一个 <code>Compilation</code> 对象包含了当前的 <code>模块资源</code> 、 <code>编译生成资源</code> 、 <code>变化的文件</code> 等。 <code>Compilation</code> 对象也提供了很多事件回调供插件做扩展。</li> <li><code>make</code>：一个新的 <code>Compilation</code> 创建完毕，即将从 <code>Entry</code> 开始读取文件，根据文件类型和配置的 <code>Loader</code> 对文件进行编译，编译完后再找出该文件依赖的文件，递归的编译和解析。</li> <li><code>after-compile</code>： 一次 <code>Compilation</code> 执行完成。</li> <li><code>seal</code>：所有模块及其依赖的模块都通过 <code>Loader</code> 转换完成后，根据依赖关系开始生成 <code>Chunk</code> 。</li> <li><code>emit</code>：确定好要输出哪些文件后，执行文件输出，可以在这里获取和修改输出内容。</li> <li><code>after-emit</code>：在将内存中<code>assets</code>内容写到磁盘文件夹之后。</li> <li><code>done</code>： 成功完成一次完成的编译和输出流程。</li> <li><code>failed</code>： 如果在编译和输出流程中遇到异常导致<code>Webpack</code>退出时，就会直接跳转到本步骤，插件可以在本事件中获取到具体的错误原因。</li></ul></li> <li>常见plugin
<ul><li><code>html-webpack-plugin</code>：在打包结束后，⾃动生成⼀个<code>HTML</code>⽂文件，并把打包生成的<code>js模块</code>引⼊到该<code>HTML</code>中，同时可以压缩<code>HTML</code>。</li> <li><code>clean-webpack-plugin</code>: 删除（清理）构建目录。</li> <li><code>mini-css-extract-plugin</code>：提取<code>CSS</code>到一个单独的文件中。</li> <li><code>css-minimizer-webpack-plugin</code>：利用<code>cssnano</code>优化并压缩<code>CSS</code>代码。</li> <li><code>terser-webpack-plugin</code>：利用<code>terser</code>压缩<code>js</code>代码。</li> <li><code>DefinePlugin</code>：允许在编译时创建配置的全局对象，是一个<code>Webpack</code>内置的插件。</li></ul></li></ul></li> <li>hash策略
<ul><li><code>hash</code> 是跟整个项目的构建相关，只要项目里有文件更改，整个项目构建的hash值都会更改，并且全部文件都共用相同的hash值。（粒度整个项目）</li> <li><code>chunkhash</code> 是根据不同的入口进行依赖文件解析，构建对应的chunk（模块），生成对应的hash值。只有被修改的chunk（模块）在重新构建之后才会生成新的hash值，不会影响其他的chunk。（粒度entry的每个入口文件）。</li> <li><code>contenthash</code> 是跟每个生成的文件有关，每个文件都有一个唯一的hash值。当要构建的文件内容发生改变时，就会生成新的hash值，且该文件的改变并不会影响和它同一个模块下的其他文件。（粒度每个文件的内容）。</li></ul></li> <li><code>Webapck 5</code>新特性
<ul><li>内置<code>静态资源</code>的构建能力</li> <li>内置<code>文件系统缓存</code></li> <li>内置<code>worker</code>的构建能力</li> <li>不在为<code>Node.js</code>模块提供自动引用<code>Polyfills</code></li> <li>对<code>Tree-Shaking</code>进行了优化
<ul><li>内部模块<code>Tree-Shaking</code></li> <li>嵌套的<code>Tree-Shaking</code></li> <li>CommonJs <code>Tree-Shaking</code></li></ul></li> <li>模块联邦(Module Federation) <a href="https://segmentfault.com/a/1190000041329448" target="_blank" rel="noopener noreferrer">参考文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>能<code>轻易实现</code>在两个使用<code>Webpack</code>构建的项目之间<code>共享代码</code>，甚至组合不同的应用为一个应用。</li></ul></li></ul></li></ul></li> <li>Rollup
<ul><li><code>Rollup</code>是基于<code>ESM</code>的<code>JavaScript</code>打包工具。</li> <li><code>Rollup</code>的亮点在于同一个地方，一次性加载。能针对源码进行<code>Tree Shaking</code>(去除那些已被定义但没被使用的代码)，以及<code>Scope Hoisting</code>以减小输出文件大小提升运行性能。</li> <li>构建流程
<ul><li>获取入口文件的内容，包装成<code>module</code>，生成抽象语法树</li> <li>对入口文件抽象语法树进行依赖解析</li> <li>生成最终代码</li> <li>写入目标文件</li></ul></li></ul></li> <li>Tree-Sharking
<ul><li><code>Tree-Sharking</code>的本质是消除无用的js代码。无用代码消除在广泛存在于传统的编程语言编译器中，编译器可以判断出某些代码根本不影响输出，然后消除这些代码，这个称之为<code>DCE</code>（<code>dead code elimination</code>）。</li> <li><code>Tree-Sharking</code>和传统的<code>DCE</code>的方法又不太一样，传统的<code>DCE</code>消灭不可能执行的代码，而<code>Tree-Sharking</code>更关注于消除没有用到的代码。</li> <li><code>ESM</code>模块间的依赖关系是确定的，和运行时的状态无关，可以进行可靠的<code>静态分析</code>，这就是<code>Tree-Sharking</code>的基础。</li></ul></li> <li>Scope Hoisting
<ul><li>构建后的代码会存在<code>大量闭包</code>，造成体积增大，运行代码时创建的<code>函数作用域</code>变多，<code>内存开销</code>变大。<code>Scope Hoisting</code>将所有模块的代码按照引用顺序放在一个<code>函数作用域</code>里，然后适当的重命名一些变量以防止<code>变量名冲突</code>。</li> <li>分析出模块之间的<code>依赖关系</code>，尽可能将打散的模块合并到<code>一个函数</code>中，前提是不能造成<code>代码冗余</code>。 因此<strong>只有那些被引用了一次的模块才能被合并</strong>。</li> <li>必须是<code>ES6</code>的语法，因为有很多第三方库仍采用<code>CommonJS</code>语法，为了充分发挥<code>Scope Hoisting</code>的作用，需要转化为<code>ES6模块化</code>语法。</li></ul></li></ul> <h3 id="bundleless"><a href="#bundleless" class="header-anchor">#</a> bundleless</h3> <ul><li>Vite <a href="https://zhuanlan.zhihu.com/p/467325485" target="_blank" rel="noopener noreferrer">参考文章<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li>特点
<ul><li><code>快速</code>的冷启动: <code>No Bundle</code> + <code>esbuild</code> 预构建</li> <li>即时的模块<code>热更新</code>: 基于<code>ESM</code>的<code>HMR</code>，同时利用<code>浏览器缓存策略</code>提升速度</li> <li>真正的<code>按需加载</code>: 利用浏览器<code>ESM</code>支持，实现真正的按需加载</li></ul></li> <li>核心原理
<ul><li>当声明一个<code>script</code>标签<code>type</code>类型为<code>module</code>时，当浏览器解析资源时，会往当前域名发起一个<code>GET</code>请求<code>js文件</code>。</li> <li>请求到了<code>js文件</code>，会检测到内部含有<code>import</code>引入的包，又会<code>import</code>引用发起<code>HTTP请求</code>获取模块的内容文件，如<code>Example1.vue</code>、<code>example2.ts</code>。</li> <li><code>Vite</code>启动一个<code>koa服务器</code>拦截这些请求，并在后端进行相应的处理将项目中使用的文件通过简单的分解与整合，然后再以<code>ESM格式</code>返回返回给浏览器。</li> <li><code>Vite</code>扩展了<code>Rollup</code>的<code>插件API</code>，这意味着<code>Vite</code>用户可以利用<code>Rollup插件</code>的强大生态系统，同时根据需要也能够扩展<code>开发服务器</code>和<code>SSR功能</code>。</li> <li>拦截时需要考虑几点：
<ul><li><p>裸模块导入的处理</p> <ul><li>原生<code>ES</code>导入不支持下面这样的裸模块导入，通过<code>依赖预构建</code>和<code>重新导入</code>方法
<blockquote><p>import { someMethod } from 'my-dep'</p></blockquote></li> <li><code>依赖预构建</code> <ul><li><code>Vite</code>的开发服务器将所有代码视为<code>原生ES模块</code>。因此，<code>Vite</code>必须先将作为<code>CommonJS</code>或<code>UMD</code>发布的依赖项转换为<code>ESM</code>。</li> <li><code>Vite</code>将有许多内部模块的<code>ESM</code>依赖关系转换为单个模块，以提高后续页面加载性能。</li></ul></li> <li><code>Vite</code>会将预构建的依赖缓存到<code>node_modules/.vite</code>。</li> <li>重写导入为合法的<code>URL</code>，例如<code>/node_modules/.vite/my-dep.js?v=f3sf2ebd</code>以便浏览器能够正确导入它们。</li> <li>解析后的<code>依赖请求</code>会以<code>HTTP</code>头<code>max-age=31536000,immutable</code><strong>强缓存</strong>，以提高在开发时的页面<code>重载性能</code>。</li></ul></li> <li><p>Vue单文件的处理</p> <ul><li><code>@vitejs/plugin-vue</code>：支持<code>Vue 3</code>单文件组件</li> <li><code>underfin/vite-plugin-vue2</code>：支持<code>Vue 2</code>单文件组件</li></ul></li> <li><p>JSX文件的处理</p> <ul><li><code>JSX</code>的转译默认是通过<code>esbuild</code></li> <li><code>@vitejs/plugin-vue-jsx</code>支持<code>Vue 3 JSX</code></li> <li>自定义的<code>jsxFactory</code>和<code>jsxFragment</code>可以使用<code>esbuild选项</code>进行配置。</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code>  <span class="token comment">// vite.config.js</span>
  <span class="token keyword">import</span> <span class="token punctuation">{</span> defineConfig <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'vite'</span>

  <span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token function">defineConfig</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    esbuild<span class="token operator">:</span> <span class="token punctuation">{</span>
      jsxFactory<span class="token operator">:</span> <span class="token string">'h'</span><span class="token punctuation">,</span>
      jsxFragment<span class="token operator">:</span> <span class="token string">'Fragment'</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div></li> <li><p><code>TypeScript</code>文件的处理</p> <ul><li><code>Vite</code>仅执行<code>.ts</code>文件的<code>转译</code>工作，并<strong>不</strong>执行任何<code>类型检查</code>。<code>Vite</code>使用<code>esbuild</code>将<code>TypeScript</code>转译到<code>JavaScript</code>。</li></ul></li></ul></li> <li>HMR原理
<ul><li><code>Vite</code>整个热更新过程可以分成四步
<ul><li>创建一个<code>WebSocket</code>服务端和<code>Client</code>文件，启动服务</li> <li>通过<code>chokidar</code>监听文件变更</li> <li>当代码变更后，服务端进行判断并推送到客户端</li> <li>客户端根据推送的<code>信息</code>执行不同操作的更新</li></ul></li></ul></li></ul></li></ul></li> <li>snowpack</li></ul> <h2 id="性能优化"><a href="#性能优化" class="header-anchor">#</a> 性能优化</h2> <h3 id="网络优化"><a href="#网络优化" class="header-anchor">#</a> 网络优化</h3> <ul><li>使用CDN分发静态资源</li> <li>使用HTTP 2.0</li> <li>使用浏览器缓存</li> <li>减少HTTP请求</li></ul> <h3 id="体积优化"><a href="#体积优化" class="header-anchor">#</a> 体积优化</h3> <ul><li>JS代码压缩</li> <li>CSS代码压缩</li> <li>HTML文件代码压缩</li> <li>文件大小压缩</li> <li>图片压缩与优化
<ul><li>对于能够显示 WebP 格式的浏览器尽量使用 WebP 格式</li> <li>小图使用 base64 格式</li> <li>将多个图标文件整合到一张图片中（雪碧图）</li></ul></li> <li>代码分离</li> <li>字体图标代替图片</li></ul> <h3 id="加载优化"><a href="#加载优化" class="header-anchor">#</a> 加载优化</h3> <ul><li>CSS写头部，JS写底部</li> <li><code>script</code>标签增加<code>defer</code>属性</li> <li>资源预加载：<code>&lt;link ref=&quot;preload&quot;&gt;</code></li> <li>资源预链接：<code>&lt;link ref=&quot;preconnect&quot;&gt;</code></li> <li>DNS预解析：<code>&lt;link ref=&quot;dns-prefetch&quot;&gt;</code></li> <li>内联chunk</li> <li>图片懒加载</li> <li>gzip：打包的时候就打成<code>gzip</code>包，不需要服务器再去做压缩</li></ul> <h3 id="代码优化"><a href="#代码优化" class="header-anchor">#</a> 代码优化</h3> <ul><li>用transform等新属性来实现动画</li> <li>降低CSS选择器的复杂性</li> <li>避免过多的回流与重绘</li> <li>合理利用节流和防抖</li> <li>使用事件委托</li> <li>首屏加载优化：主要在<code>SPA</code>应用的<code>白屏优化</code> <ul><li><code>路由懒加载</code></li> <li>异步组件：<code>defineAsyncComponent</code></li> <li>使用<code>resolutions</code>统一依赖版本</li></ul></li></ul> <h2 id="前端安全"><a href="#前端安全" class="header-anchor">#</a> 前端安全</h2> <h3 id="xss"><a href="#xss" class="header-anchor">#</a> XSS</h3> <ul><li>XSS 攻击是指在用户在访问信任的网站时注入恶意攻击脚本（主要是JavaScript），对客户端网页进行篡改，对用户浏览器进行控制或者获取用户隐私数据的一种攻击方式。</li> <li>攻击者对客户端网页注入的恶意脚本一般包括 JavaScript，有时也会包含 HTML 和 Flash。有很多种方式进行 XSS 攻击，但它们的共同点为：获取用户隐私数据像 cookie、session ，进行一些恶意操作。</li> <li>注入方式多种多样，总之，如果开发者没有将用户输入的文本进行合适的过滤，就贸然插入到 HTML 中，这很容易造成注入漏洞。攻击者可以利用漏洞，构造出恶意的代码指令，进而利用恶意代码危害数据安全。</li> <li>攻击类型
<ul><li>存储型XSS攻击</li> <li>反射型XSS攻击</li> <li>DOM型XSS攻击</li></ul></li> <li>防御措施
<ul><li>输入过滤</li> <li>纯前端渲染</li> <li>转义HTML</li> <li>预防DOM型XSS攻击
<ul><li>使用.innerHTML、.outerHTML、document.write() 时要特别小心，应尽量使用 .textContent、.setAttribute() 等。</li> <li>DOM 中的内联事件监听器，a标签的href属性，JavaScript的eval，setTimeout，setInterval，都能吧字符串作为代码运行，避免不可信的数据拼接到字符串中传递给这些 API。</li></ul></li> <li>使用内容安全策略(CSP)头部</li> <li>输入内容长度控制</li> <li>HttpOnly Cookie</li></ul></li></ul> <h3 id="csrf"><a href="#csrf" class="header-anchor">#</a> CSRF</h3> <ul><li><p>是一种挟制用户在当前已登录的Web应用程序上执行非本意的操作的攻击方法。</p></li> <li><p>攻击过程</p> <ul><li>简单地说，是攻击者通过一些技术手段欺骗用户的浏览器去访问一个自己曾经认证过的网站并运行一些操作。</li> <li>可见完成一次CSRF攻击，用户必须依次存在着两个操作：
<ul><li>登录信任网站A，并保存Cookie</li> <li>在不登出网站A的情况下，点击危险网站B</li></ul></li></ul></li> <li><p>特点</p> <ul><li>攻击一般发起在第三方网站，而不是被攻击的网站。被攻击的网站无法防止攻击发生。</li> <li>攻击利用受害者在被攻击网站的登录凭证，冒充受害者提交操作；而不是直接窃取数据。</li> <li>整个过程攻击者并不能获取到受害者的登录凭证，仅仅是“冒用”。</li> <li>跨站请求可以用各种方式：图片URL、超链接、CORS、Form提交等等。</li></ul></li> <li><p>常见攻击类型</p> <ul><li><p>GET类型</p> <ul><li>GET类型的CSRF利用非常简单，只需要一个HTTP请求，一般会这样利用：</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>img</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://bank.example/withdraw?amount=10000&amp;for=hacker<span class="token punctuation">&quot;</span></span> <span class="token punctuation">&gt;</span></span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div></li> <li><p>POST类型</p> <ul><li>这种类型的CSRF利用起来通常使用的是一个自动提交的表单，如：</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://bank.example/withdraw<span class="token punctuation">&quot;</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span>POST</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>account<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>xiaoming<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>amount<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>10000<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hidden<span class="token punctuation">&quot;</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>for<span class="token punctuation">&quot;</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>hacker<span class="token punctuation">&quot;</span></span> <span class="token punctuation">/&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script"><span class="token language-javascript"> document<span class="token punctuation">.</span>forms<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><p>链接类型</p> <ul><li>用户需要手动点击触发</li></ul> <div class="language-html line-numbers-mode"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>http://test.com/csrf/withdraw.php?amount=1000&amp;for=hacker<span class="token punctuation">&quot;</span></span> <span class="token attr-name">taget</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>_blank<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
  重磅消息！！
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span><span class="token punctuation">/&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li></ul></li> <li><p>防御措施</p> <ul><li>CSRF通常从第三方网站发起，被攻击的网站无法防止攻击发生，只能通过增强自己网站针对CSRF的防护能力来提升安全性。</li> <li>阻止不明外域的访问
<ul><li>同源检测：同源验证是一个相对简单的防范方法，能够防范绝大多数的CSRF攻击。
<ul><li>在HTTP协议中，每一个异步请求都会携带两个Header，用于标记来源域名：Origin Header、Referer Header。</li></ul></li> <li>Samesite Cookie属性
<ul><li>那就是为Set-Cookie响应头新增Samesite属性，它用来标明这个 Cookie是个“同站 Cookie&quot;，同站Cookie只能作为第一方Cookie，不能作为第三方Cookie，Samesite 有两个属性值，分别是 Strict 和 Lax。</li></ul></li></ul></li> <li>提交时要求附加本域才能获取的信息
<ul><li>添加校验token</li> <li>双重Cookie验证</li></ul></li></ul></li></ul> <h2 id="node-js"><a href="#node-js" class="header-anchor">#</a> Node.js</h2> <h3 id="基本概念及原理"><a href="#基本概念及原理" class="header-anchor">#</a> 基本概念及原理</h3> <h3 id="常用模块"><a href="#常用模块" class="header-anchor">#</a> 常用模块</h3> <ul><li>cluster</li></ul> <h3 id="web-框架"><a href="#web-框架" class="header-anchor">#</a> Web 框架</h3> <ul><li>Koa
<ul><li><p>中间件原理（洋葱模型）</p> <ul><li>每次请求进入应用时，都会创建一个新的上下文对象ctx，并且传入依次调用的中间件中处理</li> <li>每一个中间件都会调用next方法，将当前的处理权交给下一个中间件，最后一个next执行后，会依次向上回溯，执行next方法调用后的代码。</li> <li>也就是说，每一个中间件，都有两次处理时机</li> <li>Koa-Compose</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">function</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token parameter">middleware</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>Array<span class="token punctuation">.</span><span class="token function">isArray</span><span class="token punctuation">(</span>middleware<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&quot;Middleware stack must be an array!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">const</span> fn <span class="token keyword">of</span> middleware<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> fn <span class="token operator">!==</span> <span class="token string">&quot;function&quot;</span><span class="token punctuation">)</span> <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">TypeError</span><span class="token punctuation">(</span><span class="token string">&quot;Middleware must be composed of functions!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">context<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> index <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">function</span> <span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> index<span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&quot;next() called multiple times&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      index <span class="token operator">=</span> i<span class="token punctuation">;</span>
      <span class="token keyword">let</span> fn <span class="token operator">=</span> middleware<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">===</span> middleware<span class="token punctuation">.</span>length<span class="token punctuation">)</span> fn <span class="token operator">=</span> next<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>fn<span class="token punctuation">)</span> <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">try</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">resolve</span><span class="token punctuation">(</span><span class="token function">fn</span><span class="token punctuation">(</span>context<span class="token punctuation">,</span> <span class="token function">dispatch</span><span class="token punctuation">.</span><span class="token function">bind</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span> i <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> Promise<span class="token punctuation">.</span><span class="token function">reject</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token function-variable function">m1</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;m1 before&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;m1 after&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">m2</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;m2 before&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;m2 after&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">m3</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;m3 before&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;m3 after&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> fn <span class="token operator">=</span> <span class="token function">compose</span><span class="token punctuation">(</span><span class="token punctuation">[</span>m1<span class="token punctuation">,</span> m2<span class="token punctuation">,</span> m3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;next&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&quot;respond&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// m1 before</span>
<span class="token comment">// m2 before</span>
<span class="token comment">// m3 before</span>
<span class="token comment">// next</span>
<span class="token comment">// m3 after</span>
<span class="token comment">// m2 after</span>
<span class="token comment">// m1 after</span>
<span class="token comment">// respond</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br></div></div></li> <li><p>常用中间件</p> <ul><li>错误处理</li></ul> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token keyword">const</span> <span class="token function-variable function">catchError</span> <span class="token operator">=</span> <span class="token keyword">async</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span><span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token keyword">catch</span><span class="token punctuation">(</span>error<span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>errorCode<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span>
      ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span>
        code<span class="token operator">:</span> err<span class="token punctuation">.</span>code<span class="token punctuation">,</span>
        message<span class="token operator">:</span> err<span class="token punctuation">.</span>message<span class="token punctuation">,</span>
        errorCode<span class="token operator">:</span> err<span class="token punctuation">.</span>errorCode<span class="token punctuation">,</span>
        request<span class="token operator">:</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ctx<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>ctx<span class="token punctuation">.</span>path<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      ctx<span class="token punctuation">.</span>app<span class="token punctuation">.</span><span class="token function">emit</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">,</span> err<span class="token punctuation">,</span> ctx<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><ul><li>koa-router</li> <li>koa-bodyparser</li> <li>koa-views：进行视图模板渲染</li> <li>koa-static：静态文件服务</li> <li>koa-session</li> <li>koa-jwt</li> <li>koa-logger</li></ul></li></ul></li> <li>egg.js
<ul><li>egg-bin：整个框架的入口，负责开发环境下命令行的解析（启动、调试、测试）。</li> <li>egg-cluster：负责开发环境、生产环境下的进程启动和通信。
<ul><li><a href="https://zhuanlan.zhihu.com/p/116018129" target="_blank" rel="noopener noreferrer">egg中的master、worker和agent<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></li></ul></li></ul> <h2 id="其他"><a href="#其他" class="header-anchor">#</a> 其他</h2> <h3 id="面向对象的特征"><a href="#面向对象的特征" class="header-anchor">#</a> 面向对象的特征</h3> <ul><li>封装</li> <li>继承</li> <li>多态：多态就是同一个接口，使用不同的实例而执行不同操作</li></ul> <div class="language-ts line-numbers-mode"><pre class="language-ts"><code><span class="token keyword">class</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  <span class="token function">sound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Dog</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span><span class="token punctuation">{</span>
  <span class="token function">sound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">Cat</span> <span class="token keyword">extends</span> <span class="token class-name">Animal</span> <span class="token punctuation">{</span>
  <span class="token function">sound</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">function</span> <span class="token function">makeSound</span><span class="token punctuation">(</span>animal<span class="token operator">:</span> Animal<span class="token punctuation">)</span><span class="token punctuation">{</span>
  animal<span class="token punctuation">.</span><span class="token function">sound</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h3 id="为什么堆比栈大"><a href="#为什么堆比栈大" class="header-anchor">#</a> 为什么堆比栈大</h3> <ul><li>栈的功能主要是函数调用、局部变量申请、函数参数传递所使用的空间，是为函数调用的实现提供一些保存、恢复操作。</li> <li>栈帧中主要存储的数据有局部变量、函数返回地址、函数参数。在一个程序中这些信息总共也没多少，所以一般情况下栈空间都特别小。</li> <li>而且栈空间用户无法操作，是由编译器和操作系统决定的。</li> <li>堆是一块用户可以操作的空间，可以存储任何数据，包括音视频、数据库等等。堆的空间可大可小，看你自己的需求。</li></ul></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/artoriaschan/edit/master/src/03.技术/05.面试/01.2022 Review.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=interview" title="标签">#interview</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/07/23, 17:53:01</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/note/rust-notes/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Rust 学习笔记</div></a> <a href="/pages/fe34cd/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">2022 Interview</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/note/rust-notes/" class="prev">Rust 学习笔记</a></span> <span class="next"><a href="/pages/fe34cd/">2022 Interview</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:dalecracker@gmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/artoriaschan" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2018-2022
    <span>Artorias Chan | <a href="https://raw.githubusercontent.com/artoriaschan/blog/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c17531b4.js" defer></script><script src="/assets/js/2.3e7b8786.js" defer></script><script src="/assets/js/85.7ef6ce1f.js" defer></script>
  </body>
</html>