<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>lerna管理前端packages的最佳实践 | 三行代码</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <meta name="description" content="Web development, Frontend, JavaScript">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="theme-color" content="#11a8cd">
    <link rel="preload" href="/assets/css/0.styles.c149dbaa.css" as="style"><link rel="preload" href="/assets/js/app.c17531b4.js" as="script"><link rel="preload" href="/assets/js/2.3e7b8786.js" as="script"><link rel="preload" href="/assets/js/22.9bd77fe5.js" as="script"><link rel="prefetch" href="/assets/js/10.2234e2c8.js"><link rel="prefetch" href="/assets/js/100.42ab15ac.js"><link rel="prefetch" href="/assets/js/101.e6fef504.js"><link rel="prefetch" href="/assets/js/11.14461477.js"><link rel="prefetch" href="/assets/js/12.157d8dc0.js"><link rel="prefetch" href="/assets/js/13.a7890c3d.js"><link rel="prefetch" href="/assets/js/14.d0894eb7.js"><link rel="prefetch" href="/assets/js/15.bb14362f.js"><link rel="prefetch" href="/assets/js/16.e34746ec.js"><link rel="prefetch" href="/assets/js/17.ca83e363.js"><link rel="prefetch" href="/assets/js/18.9a14520a.js"><link rel="prefetch" href="/assets/js/19.ceb87610.js"><link rel="prefetch" href="/assets/js/20.0d0d893e.js"><link rel="prefetch" href="/assets/js/21.a2cae791.js"><link rel="prefetch" href="/assets/js/23.3ca57ee7.js"><link rel="prefetch" href="/assets/js/24.5df7731a.js"><link rel="prefetch" href="/assets/js/25.becd8254.js"><link rel="prefetch" href="/assets/js/26.21837df4.js"><link rel="prefetch" href="/assets/js/27.12585d76.js"><link rel="prefetch" href="/assets/js/28.4aff2d40.js"><link rel="prefetch" href="/assets/js/29.606a725e.js"><link rel="prefetch" href="/assets/js/3.953185bb.js"><link rel="prefetch" href="/assets/js/30.281826a9.js"><link rel="prefetch" href="/assets/js/31.3e0344fb.js"><link rel="prefetch" href="/assets/js/32.1ef62439.js"><link rel="prefetch" href="/assets/js/33.7f023c0c.js"><link rel="prefetch" href="/assets/js/34.ad479baf.js"><link rel="prefetch" href="/assets/js/35.dc52b883.js"><link rel="prefetch" href="/assets/js/36.a8a20daf.js"><link rel="prefetch" href="/assets/js/37.c33aae67.js"><link rel="prefetch" href="/assets/js/38.d458af07.js"><link rel="prefetch" href="/assets/js/39.668922f9.js"><link rel="prefetch" href="/assets/js/4.c115e727.js"><link rel="prefetch" href="/assets/js/40.dd259277.js"><link rel="prefetch" href="/assets/js/41.0685dabf.js"><link rel="prefetch" href="/assets/js/42.90bf1511.js"><link rel="prefetch" href="/assets/js/43.81710a1b.js"><link rel="prefetch" href="/assets/js/44.a20853a1.js"><link rel="prefetch" href="/assets/js/45.a0a76abf.js"><link rel="prefetch" href="/assets/js/46.95e74803.js"><link rel="prefetch" href="/assets/js/47.ba80bcea.js"><link rel="prefetch" href="/assets/js/48.ddc3aede.js"><link rel="prefetch" href="/assets/js/49.3040c348.js"><link rel="prefetch" href="/assets/js/5.7d5490f2.js"><link rel="prefetch" href="/assets/js/50.9e45cd68.js"><link rel="prefetch" href="/assets/js/51.3a5eacd8.js"><link rel="prefetch" href="/assets/js/52.2a50b570.js"><link rel="prefetch" href="/assets/js/53.8059a783.js"><link rel="prefetch" href="/assets/js/54.3e54252d.js"><link rel="prefetch" href="/assets/js/55.50b455ff.js"><link rel="prefetch" href="/assets/js/56.43d7e6b7.js"><link rel="prefetch" href="/assets/js/57.dc8bbc95.js"><link rel="prefetch" href="/assets/js/58.c0b76901.js"><link rel="prefetch" href="/assets/js/59.28ec02f3.js"><link rel="prefetch" href="/assets/js/6.8749434b.js"><link rel="prefetch" href="/assets/js/60.001ff532.js"><link rel="prefetch" href="/assets/js/61.b9d6b6db.js"><link rel="prefetch" href="/assets/js/62.81245a10.js"><link rel="prefetch" href="/assets/js/63.8332ae73.js"><link rel="prefetch" href="/assets/js/64.357b1d40.js"><link rel="prefetch" href="/assets/js/65.947a76a1.js"><link rel="prefetch" href="/assets/js/66.59c57da7.js"><link rel="prefetch" href="/assets/js/67.02d525a5.js"><link rel="prefetch" href="/assets/js/68.808b1fd2.js"><link rel="prefetch" href="/assets/js/69.703935c0.js"><link rel="prefetch" href="/assets/js/7.7aa8fb69.js"><link rel="prefetch" href="/assets/js/70.9c6a4dbf.js"><link rel="prefetch" href="/assets/js/71.955445a1.js"><link rel="prefetch" href="/assets/js/72.5ae810be.js"><link rel="prefetch" href="/assets/js/73.40b461f0.js"><link rel="prefetch" href="/assets/js/74.eb777c24.js"><link rel="prefetch" href="/assets/js/75.cf25358f.js"><link rel="prefetch" href="/assets/js/76.f2b37de5.js"><link rel="prefetch" href="/assets/js/77.5db6e6e5.js"><link rel="prefetch" href="/assets/js/78.2fcfdf72.js"><link rel="prefetch" href="/assets/js/79.501697d3.js"><link rel="prefetch" href="/assets/js/8.6aee0b06.js"><link rel="prefetch" href="/assets/js/80.1c75a4c9.js"><link rel="prefetch" href="/assets/js/81.eb9a1728.js"><link rel="prefetch" href="/assets/js/82.d18239f7.js"><link rel="prefetch" href="/assets/js/83.b4360fed.js"><link rel="prefetch" href="/assets/js/84.206370c0.js"><link rel="prefetch" href="/assets/js/85.7ef6ce1f.js"><link rel="prefetch" href="/assets/js/86.711072c9.js"><link rel="prefetch" href="/assets/js/87.8db4bcfa.js"><link rel="prefetch" href="/assets/js/88.d23ba184.js"><link rel="prefetch" href="/assets/js/89.9cd79b2e.js"><link rel="prefetch" href="/assets/js/9.9d5551f6.js"><link rel="prefetch" href="/assets/js/90.1000b730.js"><link rel="prefetch" href="/assets/js/91.0c90c597.js"><link rel="prefetch" href="/assets/js/92.e6b9a689.js"><link rel="prefetch" href="/assets/js/93.3ba18b6b.js"><link rel="prefetch" href="/assets/js/94.8eb468d2.js"><link rel="prefetch" href="/assets/js/95.7b5e4261.js"><link rel="prefetch" href="/assets/js/96.6d0c67f2.js"><link rel="prefetch" href="/assets/js/97.98f63f27.js"><link rel="prefetch" href="/assets/js/98.f7445085.js"><link rel="prefetch" href="/assets/js/99.f9a1abbd.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c149dbaa.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu have-body-img"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="https://cdn.jsdelivr.net/gh/artoriaschan/image-hosting@master/blog/20200105104632.15vzpyhnwvuk.png" alt="三行代码" class="logo"> <span class="site-name can-hide">三行代码</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/d533f9/" class="nav-link">基础知识</a></li><li class="dropdown-subitem"><a href="/pages/6d91ad/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/pages/c5fd6c/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/pages/8da03e/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/pages/28de07/" class="nav-link">杂谈</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/vue2/" class="nav-link">Vue 2 源码解析</a></li><li class="dropdown-subitem"><a href="/note/vue3/" class="nav-link">Vue 3 源码解析</a></li><li class="dropdown-subitem"><a href="/note/react17/" class="nav-link">React 17 源码解析</a></li><li class="dropdown-subitem"><a href="/note/vite/" class="nav-link">Vite 源码解析</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/9f15c1a281d8bedb/" class="nav-link">Stylus</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/33969f/" class="nav-link">Interview</a></li><li class="dropdown-item"><h4>Rust</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/rust-notes/" class="nav-link">Rust 学习笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="转载" class="dropdown-title"><a href="/reship/" class="link-title">转载</a> <span class="title" style="display:none;">转载</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/ed5303/" aria-current="page" class="nav-link router-link-exact-active router-link-active">前端精读</a></li></ul></div></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/artoriaschan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.jsdelivr.net/gh/artoriaschan/image-hosting@master/blog/WechatIMG1.6c8n1rhrpqg0.jpeg"> <div class="blogger-info"><h3>陈先生</h3> <span>☭ 让我们一起粉碎资本主义吧， 达瓦里氏！☭</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/web/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><h4>前端文章</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/pages/d533f9/" class="nav-link">基础知识</a></li><li class="dropdown-subitem"><a href="/pages/6d91ad/" class="nav-link">JavaScript</a></li><li class="dropdown-subitem"><a href="/pages/c5fd6c/" class="nav-link">Vue</a></li><li class="dropdown-subitem"><a href="/pages/8da03e/" class="nav-link">React</a></li><li class="dropdown-subitem"><a href="/pages/28de07/" class="nav-link">杂谈</a></li></ul></li><li class="dropdown-item"><h4>学习笔记</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/vue2/" class="nav-link">Vue 2 源码解析</a></li><li class="dropdown-subitem"><a href="/note/vue3/" class="nav-link">Vue 3 源码解析</a></li><li class="dropdown-subitem"><a href="/note/react17/" class="nav-link">React 17 源码解析</a></li><li class="dropdown-subitem"><a href="/note/vite/" class="nav-link">Vite 源码解析</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="页面" class="dropdown-title"><a href="/ui/" class="link-title">页面</a> <span class="title" style="display:none;">页面</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/8309a5b876fc95e3/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/pages/0a83b083bdf257cb/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/pages/9f15c1a281d8bedb/" class="nav-link">Stylus</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/9a7ee40fc232253e/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/pages/4c778760be26d8b3/" class="nav-link">GitHub技巧</a></li><li class="dropdown-item"><!----> <a href="/pages/117708e0af7f0bd9/" class="nav-link">Nodejs</a></li><li class="dropdown-item"><!----> <a href="/pages/33969f/" class="nav-link">Interview</a></li><li class="dropdown-item"><h4>Rust</h4> <ul class="dropdown-subitem-wrapper"><li class="dropdown-subitem"><a href="/note/rust-notes/" class="nav-link">Rust 学习笔记</a></li></ul></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="转载" class="dropdown-title"><a href="/reship/" class="link-title">转载</a> <span class="title" style="display:none;">转载</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/ed5303/" aria-current="page" class="nav-link router-link-exact-active router-link-active">前端精读</a></li></ul></div></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/artoriaschan" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>前端精读评论</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/ed5303/" aria-current="page" class="active sidebar-link">lerna管理前端packages的最佳实践</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ed5303/#背景" class="sidebar-link">背景</a></li><li class="sidebar-sub-header"><a href="/pages/ed5303/#什么是lerna" class="sidebar-link">什么是lerna</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ed5303/#常用命令" class="sidebar-link">常用命令</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/ed5303/#lerna-json解析" class="sidebar-link">lerna.json解析</a></li><li class="sidebar-sub-header"><a href="/pages/ed5303/#使用lerna的基本工作流" class="sidebar-link">使用lerna的基本工作流</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ed5303/#环境配置" class="sidebar-link">环境配置</a></li><li class="sidebar-sub-header"><a href="/pages/ed5303/#初始化一个lerna工程" class="sidebar-link">初始化一个lerna工程</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/ed5303/#使用lerna提升开发流程体验" class="sidebar-link">使用lerna提升开发流程体验</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ed5303/#项目初始化" class="sidebar-link">项目初始化</a></li><li class="sidebar-sub-header"><a href="/pages/ed5303/#增加依赖" class="sidebar-link">增加依赖</a></li><li class="sidebar-sub-header"><a href="/pages/ed5303/#发布到npm" class="sidebar-link">发布到npm</a></li><li class="sidebar-sub-header"><a href="/pages/ed5303/#更新模块" class="sidebar-link">更新模块</a></li><li class="sidebar-sub-header"><a href="/pages/ed5303/#集中版本号或独立版本号" class="sidebar-link">集中版本号或独立版本号</a></li><li class="sidebar-sub-header"><a href="/pages/ed5303/#总结" class="sidebar-link">总结</a></li></ul></li><li class="sidebar-sub-header"><a href="/pages/ed5303/#lerna最佳实践" class="sidebar-link">lerna最佳实践</a></li><li class="sidebar-sub-header"><a href="/pages/ed5303/#工具整合" class="sidebar-link">工具整合</a></li><li class="sidebar-sub-header"><a href="/pages/ed5303/#yarn-workspaces" class="sidebar-link">yarn workspaces</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/pages/ed5303/#命令" class="sidebar-link">命令</a></li></ul></li></ul></li><li><a href="/pages/a852b5/" class="sidebar-link">精读《Immer.js》源码</a></li><li><a href="/pages/cad92e/" class="sidebar-link">精读《现代 js 框架存在的根本原因》</a></li><li><a href="/pages/5acf31/" class="sidebar-link">精读《Serverless 给前端带来了什么》</a></li><li><a href="/pages/2db518/" class="sidebar-link">精读《snowpack》</a></li><li><a href="/pages/bc061a/" class="sidebar-link">精读《可视化搭建思考 - 富文本搭建》</a></li><li><a href="/pages/86fb3a/" class="sidebar-link">前端性能优化 24 条建议</a></li></ul></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-1cd794fe><div class="articleInfo" data-v-1cd794fe><ul class="breadcrumbs" data-v-1cd794fe><li data-v-1cd794fe><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-1cd794fe></a></li> <li data-v-1cd794fe><a href="/categories/?category=%E8%BD%AC%E8%BD%BD" title="分类" data-v-1cd794fe>转载</a></li> <li data-v-1cd794fe><a href="/categories/?category=%E5%89%8D%E7%AB%AF%E7%B2%BE%E8%AF%BB%E8%AF%84%E8%AE%BA" title="分类" data-v-1cd794fe>前端精读评论</a></li> <!----></ul> <div class="info" data-v-1cd794fe><div title="作者" class="author iconfont icon-touxiang" data-v-1cd794fe><a href="https://github.com/artoriaschan" target="_blank" title="作者" class="beLink" data-v-1cd794fe>Artorias Chan</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-1cd794fe><a href="javascript:;" data-v-1cd794fe>2018-07-21</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-content"></div></div></div> <h1><!---->
          lerna管理前端packages的最佳实践
        </h1> <!----> <div class="theme-vdoing-content content__default"><h2 id="背景"><a href="#背景" class="header-anchor">#</a> 背景</h2> <p>对于维护过多个package的同学来说，都会遇到一个选择：<strong>这些package是放在一个仓库里维护还是放在多个仓库里单独维护</strong>，数量较少的时候，多个仓库维护不会有太大问题，但是当package数量逐渐增多时，一些问题逐渐暴露出来：
<strong>一、<strong>package之间相互依赖，开发人员需要在本地手动执行</strong>npm link</strong>，维护版本号的更替；
**二、**issue难以统一追踪，管理，因为其分散在独立的repo里；
**三、**每一个package都包含独立的node_modules，而且大部分都包含babel,webpack等开发时依赖，安装耗时冗余并且占用过多空间。</p> <h2 id="什么是lerna"><a href="#什么是lerna" class="header-anchor">#</a> 什么是lerna</h2> <p>lerna到底是什么呢？lerna官网上是这样描述的。</p> <blockquote><p>用于管理具有多个包的JavaScript项目的工具。
这个介绍可以说很清晰了，引入lerna后，上面提到的问题不仅迎刃而解，更为开发人员提供了一种管理多packages javascript项目的方式。
**一、**自动解决packages之间的依赖关系。
**二、**通过git 检测文件改动，自动发布。
**三、**根据git 提交记录，自动生成CHANGELOG</p></blockquote> <h3 id="常用命令"><a href="#常用命令" class="header-anchor">#</a> 常用命令</h3> <h4 id="全局安装lerna"><a href="#全局安装lerna" class="header-anchor">#</a> 全局安装lerna</h4> <p>lerna 我们需要全局安装lerna工具。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">npm</span> i -g lerna
<span class="token comment"># 或</span>
$ <span class="token function">yarn</span> global <span class="token function">add</span> lerna
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="为所有项目安装依赖-类似于npm-yarn-i"><a href="#为所有项目安装依赖-类似于npm-yarn-i" class="header-anchor">#</a> 为所有项目安装依赖，类似于npm/yarn i</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ lerna bootstrap
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="提交对项目的更新"><a href="#提交对项目的更新" class="header-anchor">#</a> 提交对项目的更新</h4> <p>运行该命令会执行如下的步骤：</p> <ol><li>运行lerna updated来决定哪一个包需要被publish</li> <li>如果有必要，将会更新lerna.json中的version</li> <li>将所有更新过的的包中的package.json的version字段更新</li> <li>将所有更新过的包中的依赖更新</li> <li>为新版本创建一个git commit或tag</li> <li>将包publish到npm上</li></ol> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ lerna publish <span class="token comment"># 用于发布更新</span>
$ lerna publish --skip-git <span class="token comment"># 不会创建git commit或tag</span>
$ lerna publish --skip-npm <span class="token comment"># 不会把包publish到npm上</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="使用lerna-初始化项目"><a href="#使用lerna-初始化项目" class="header-anchor">#</a> 使用lerna 初始化项目</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ lerna init <span class="token comment"># 固定模式(Fixed mode)默认为固定模式，packages下的所有包共用一个版本号(version)</span>
$ lerna init --independent <span class="token comment"># 独立模式(Independent mode)，每一个包有一个独立的版本号</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="为packages文件夹下的package安装依赖"><a href="#为packages文件夹下的package安装依赖" class="header-anchor">#</a> 为packages文件夹下的package安装依赖</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ lerna <span class="token function">add</span> <span class="token operator">&lt;</span>package<span class="token operator">&gt;</span><span class="token punctuation">[</span>@version<span class="token punctuation">]</span> <span class="token punctuation">[</span>--dev<span class="token punctuation">]</span> <span class="token comment"># 命令签名</span>

<span class="token comment"># 例如</span>
$ lerna <span class="token function">add</span> module-1 --scope<span class="token operator">=</span>module-2 <span class="token comment"># 将 module-1 安装到 module-2</span>
$ lerna <span class="token function">add</span> module-1 --scope<span class="token operator">=</span>module-2 --dev <span class="token comment"># 将 module-1 安装到 module-2 的 devDependencies 下</span>
$ lerna <span class="token function">add</span> module-1 <span class="token comment"># 将 module-1 安装到除 module-1 以外的所有模块</span>
$ lerna <span class="token function">add</span> babel-core <span class="token comment"># 将 babel-core 安装到所有模块</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="卸载依赖"><a href="#卸载依赖" class="header-anchor">#</a> 卸载依赖</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ lerna <span class="token builtin class-name">exec</span> -- <span class="token operator">&lt;</span>command<span class="token operator">&gt;</span> <span class="token punctuation">[</span><span class="token punctuation">..</span>args<span class="token punctuation">]</span> <span class="token comment"># 在所有包中运行该命令</span>

<span class="token comment"># 例如</span>
$ lerna <span class="token builtin class-name">exec</span> --scope<span class="token operator">=</span>npm-list  <span class="token function">yarn</span> remove listr <span class="token comment"># 将 npm-list 包下的 listr 卸载</span>
$ lerna <span class="token builtin class-name">exec</span> -- <span class="token function">yarn</span> remove listr <span class="token comment"># 将所有包下的 listr 卸载</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="对包是否发生过变更"><a href="#对包是否发生过变更" class="header-anchor">#</a> 对包是否发生过变更</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ lerna updated
<span class="token comment"># 或</span>
$ lerna <span class="token function">diff</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="显示packages下的各个package的version"><a href="#显示packages下的各个package的version" class="header-anchor">#</a> 显示packages下的各个package的version</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ lerna <span class="token function">ls</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="清理node-modules"><a href="#清理node-modules" class="header-anchor">#</a> 清理node_modules</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ lerna clean
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="lerna-run"><a href="#lerna-run" class="header-anchor">#</a> lerna run</h4> <p>运行npm script，可以指定具体的package。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ lerna run <span class="token operator">&lt;</span>script<span class="token operator">&gt;</span> -- <span class="token punctuation">[</span><span class="token punctuation">..</span>args<span class="token punctuation">]</span> <span class="token comment"># 在所有包下运行指定</span>

<span class="token comment"># 例如</span>
$ lerna run <span class="token builtin class-name">test</span> <span class="token comment"># 运行所有包的 test 命令</span>
$ lerna run build <span class="token comment"># 运行所有包的 build 命令</span>
$ lerna run --parallel <span class="token function">watch</span> <span class="token comment"># 观看所有包并在更改时发报，流式处理前缀输出</span>

$ lerna run --scope my-component <span class="token builtin class-name">test</span> <span class="token comment"># 运行 my-component 模块下的 test</span>

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br></div></div><p><a href="https://github.com/lerna/lerna/tree/master/commands/run#readme" target="_blank" rel="noopener noreferrer">参考<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="lerna-json解析"><a href="#lerna-json解析" class="header-anchor">#</a> lerna.json解析</h2> <div class="language-json line-numbers-mode"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;version&quot;</span><span class="token operator">:</span> <span class="token string">&quot;1.1.3&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;npmClient&quot;</span><span class="token operator">:</span> <span class="token string">&quot;npm&quot;</span><span class="token punctuation">,</span>
  <span class="token property">&quot;command&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
    <span class="token property">&quot;publish&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;ignoreChanges&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token string">&quot;ignored-file&quot;</span><span class="token punctuation">,</span>
        <span class="token string">&quot;*.md&quot;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token property">&quot;bootstrap&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>
      <span class="token property">&quot;ignore&quot;</span><span class="token operator">:</span> <span class="token string">&quot;component-*&quot;</span><span class="token punctuation">,</span>
      <span class="token property">&quot;npmClientArgs&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;--no-package-lock&quot;</span><span class="token punctuation">]</span>      
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token property">&quot;packages&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;packages/*&quot;</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><p>**version：**当前库的版本
<strong>npmClient：</strong> 允许指定命令使用的client， 默认是 npm， 可以设置成 yarn
**command.publish.ignoreChanges：**可以指定那些目录或者文件的变更不会被publish
**command.bootstrap.ignore：**指定不受 bootstrap 命令影响的包
**command.bootstrap.npmClientArgs：**指定默认传给 lerna bootstrap 命令的参数
**command.bootstrap.scope：**指定那些包会受 lerna bootstrap 命令影响
**packages：**指定包所在的目录</p> <h2 id="使用lerna的基本工作流"><a href="#使用lerna的基本工作流" class="header-anchor">#</a> 使用lerna的基本工作流</h2> <h3 id="环境配置"><a href="#环境配置" class="header-anchor">#</a> 环境配置</h3> <ul><li>Git 在一个lerna工程里，是通过git来进行代码管理的。所以你首先要确保本地有正确的git环境。 如果需要多人协作开发，请先创建正确的git中心仓库的链接。 因此需要你了解基本的git操作，在此不再赘述。</li> <li>npm仓库 无论你管理的package是要发布到官网还是公司的私有服务器上，都需要正确的仓库地址和用户名。 你可运行下方的命令来检查，本地的npm registry地址是否正确。</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">npm</span> config <span class="token function">ls</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li>lerna 我们需要全局安装lerna工具</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">npm</span> i -g lerna
<span class="token comment"># 或</span>
$ <span class="token function">yarn</span> global <span class="token function">add</span> lerna
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="初始化一个lerna工程"><a href="#初始化一个lerna工程" class="header-anchor">#</a> 初始化一个lerna工程</h3> <blockquote><p>在这个例子中，我将在我本地d:/jobs 根目录下初始化一个lerna工程。
1、在<code>d:/jobs</code>下创建一个空的文件夹，命名为<code>lerna-demo</code>：</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">mkdir</span> lerna-demo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>2、初始化 通过cmd进入相关目录，进行初始化</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> d:/jobs/lerna-demo
$ lerna init
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>执行成功后，目录下将会生成这样的目录结构。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>- packages(目录)
- lerna.json(配置文件)
- package.json(工程描述文件)
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>3、添加一个测试package</p> <blockquote><p>默认情况下，package是放在packages目录下的。</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 进入packages目录</span>
<span class="token builtin class-name">cd</span> d:/jobs/lerna-demo/packages
<span class="token comment"># 创建一个packge目录</span>
<span class="token function">mkdir</span> module-1
<span class="token comment"># 进入module-1 package目录</span>
<span class="token builtin class-name">cd</span> module-1
<span class="token comment"># 初始化一个package</span>
<span class="token function">npm</span> init -y
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>执行完毕，工程下的目录结构如下:</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>--packages
	--module-1
		package.json
--lerna.json
--package.json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>4、安装各packages依赖 这一步操作，官网上是这样描述的</p> <blockquote><p>在当前的Lerna仓库中引导包。安装所有依赖项并链接任何交叉依赖项。</p></blockquote> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token builtin class-name">cd</span> d:/lerna-demo
$ lerna bootstrap
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>在现在的测试package中，module-1是没有任何依赖的，因此为了更加接近真实情况。你可已在module-1的<code>package.json</code>文件中添加一些第三方库的依赖。 这样的话，当你执行完该条命令后，你会发现module-1的依赖已经安装上了。</p> <p>5、发布 在发布的时候，就需要<code>git</code>工具的配合了。 所以在发布之前，请确认此时该lerna工程是否已经连接到git的远程仓库。你可以执行下面的命令进行查看。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token function">git</span> remote -v
// print log
origin  git@github.com:meitianyitan/docm.git <span class="token punctuation">(</span>fetch<span class="token punctuation">)</span>
origin  git@github.com:meitianyitan/docm.git <span class="token punctuation">(</span>push<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>本篇文章的代码托管在Github上。因此会显示此远程链接信息。 如果你还没有与远程仓库链接，请首先在github创建一个空的仓库，然后根据相关提示信息，进行链接。</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ lerna publish
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>执行这条命令，你就可以根据cmd中的提示，一步步的发布packges了。
实际上在执行该条命令的时候，lerna会做很多的工作。</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>-  Run the equivalent of  `lerna updated`  to determine which packages need to be published.
-  If necessary, increment the  `version`  key in  `lerna.json`.
-  Update the  `package.json`  of all updated packages to their new versions.
-  Update all dependencies of the updated packages with the new versions, specified with a  [caret (^)](https://docs.npmjs.com/files/package.json#dependencies).
-  Create a new git commit and tag for the new version.
-  Publish updated packages to npm.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>到这里为止，就是一个最简单的lerna的工作流了。但是lerna还有更多的功能等待你去发掘。
lerna有两种工作模式,Independent mode和Fixed/Locked mode，在这里介绍可能会对初学者造成困扰，但因为实在太重要了，还是有必要提一下的。
lerna的默认模式是Fixed/Locked mode，在这种模式下，实际上lerna是把工程当作一个整体来对待。每次发布packges，都是全量发布，无论是否修改。但是在Independent mode下，lerna会配合Git，检查文件变动，只发布有改动的packge。</p> <h2 id="使用lerna提升开发流程体验"><a href="#使用lerna提升开发流程体验" class="header-anchor">#</a> 使用lerna提升开发流程体验</h2> <p>接下来，我们从一个demo出发，了解基于lerna的开发流程。</p> <h3 id="项目初始化"><a href="#项目初始化" class="header-anchor">#</a> 项目初始化</h3> <p><img src="/assets/img/img1.f46d27d3.jpg" alt="img1.jpg"></p> <p>我们需要维护一个UI组件库，其包含2个组件，分别为House（房子）和Window（窗户）组件，其中House组件依赖于Window组件。
我们使用lerna初始化整个项目，并且在packages里新建了2个package，执行命令进行初始化：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ lerna init
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>初始化化后目录结构如下所示：</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code><span class="token punctuation">.</span>
├── lerna<span class="token punctuation">.</span>json
├── <span class="token keyword">package</span><span class="token punctuation">.</span>json
└── packages
    ├── house
    │   ├── index<span class="token punctuation">.</span>js
    │   ├── node_modules
    │   └── <span class="token keyword">package</span><span class="token punctuation">.</span>json
    └── window
        ├── index<span class="token punctuation">.</span>js
        ├── node_modules
        └── <span class="token keyword">package</span><span class="token punctuation">.</span>json
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><h3 id="增加依赖"><a href="#增加依赖" class="header-anchor">#</a> 增加依赖</h3> <p><img src="/assets/img/img2.7b241eb4.jpg" alt="img2.jpg"></p> <p>接下来，我们来为组件增加些依赖，首先House组件不能只由Window构成，还需要添加一些外部依赖（在这里我们假定为lodash）。我们执行：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ lerna <span class="token function">add</span> lodash --scope<span class="token operator">=</span>house
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>这句话会将lodash增添到House的dependencies属性里，这会儿你可以去看看package.json是不是发生变更了。</p> <p>我们还需要将Window添加到House的依赖里，执行：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ lerna <span class="token function">add</span> window --scope<span class="token operator">=</span>house
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>就是这么简单，它会自动检测到window隶属于当前项目，直接采用symlink的方式关联过去。</p> <blockquote><p>symlink:符号链接，也就是平常所说的建立超链接，此时House的node_modules里的Window直接链接至项目里的Window组件，而不会再重新拉取一份，这个对本地开发是非常有用的。</p></blockquote> <h3 id="发布到npm"><a href="#发布到npm" class="header-anchor">#</a> 发布到npm</h3> <p><img src="/assets/img/img3.7ce9128e.jpg" alt="img3.jpg"></p> <p>接下来我们只需要简单地执行lerna publish，确认升级的版本号，就可以批量将所有的package发布到远程。</p> <blockquote><p>默认情况下会推送到系统目前npm对应的registry里，实际项目里可以根据配置leran.json切换所使用的npm客户端。</p></blockquote> <h3 id="更新模块"><a href="#更新模块" class="header-anchor">#</a> 更新模块</h3> <p><img src="/assets/img/img4.76e70f25.jpg" alt="img4.jpg"></p> <p>接下来，我们变更了Window组件，执行一下lerna updated，便可以得知有哪些组件发生了变更。</p> <div class="language-js line-numbers-mode"><pre class="language-js"><code>→ lerna updated
lerna info version <span class="token number">2.9</span><span class="token number">.1</span>
lerna info Checking <span class="token keyword">for</span> updated packages<span class="token operator">...</span>
lerna info Comparing <span class="token keyword">with</span> v1<span class="token punctuation">.</span><span class="token number">0.9</span><span class="token punctuation">.</span>
lerna info Checking <span class="token keyword">for</span> prereleased packages<span class="token operator">...</span>
lerna info result
<span class="token operator">-</span> jx<span class="token operator">-</span>house
<span class="token operator">-</span> jx<span class="token operator">-</span>window
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>我们可以看到，虽然我们只变更了window组件，但是lerna能够帮助我们检查到所有依赖于它的组件，对于没有关联的组件，是不会出现在更新列表里的，这个对于相比之前人工维护版本依赖的更新，是非常稳健的。</p> <h3 id="集中版本号或独立版本号"><a href="#集中版本号或独立版本号" class="header-anchor">#</a> 集中版本号或独立版本号</h3> <p>截止目前，我们已经成功发布了2个package，现在再新增一个Tree组件，它和其他2个package保持独立，随后我们执行lerna publish，它会提示Tree组件的版本号将会从0.0.0升级至1.0.0，但是事实上Tree组件仅仅是刚创建的，这点不利于版本号的语义化，lerna已经考虑到了这一点，它包含2种版本号管理机制。</p> <ul><li>fixed模式下，模块发布新版本时，都会升级到leran.json里编写的version字段</li> <li>independent模式下，模块发布新版本时，会逐个询问需要升级的版本号，基准版本为它自身的package.json，这样就避免了上述问题。</li></ul> <p>如果需要各个组件维护自身的版本号，那么就使用independent模式，只需要去配置leran.json即可。</p> <h3 id="总结"><a href="#总结" class="header-anchor">#</a> 总结</h3> <p><img src="/assets/img/img4.76e70f25.jpg" alt="img4.jpg">
lerna不负责构建，测试等任务，它提出了一种集中管理package的目录模式，提供了一套自动化管理程序，让开发者不必再深耕到具体的组件里维护内容，在项目根目录就可以全局掌控，基于npm scripts，可以很好地完成组件构建，代码格式化等操作，并在最后一公里，用lerna变更package版本，将其上传至远端。</p> <h2 id="lerna最佳实践"><a href="#lerna最佳实践" class="header-anchor">#</a> lerna最佳实践</h2> <p>为了能够使lerna发挥最大的作用，根据这段时间使用lerna 的经验，总结出一个最佳实践。下面是一些特性。</p> <ul><li>采用Independent模式</li> <li>根据Git提交信息，自动生成changelog</li> <li>eslint规则检查</li> <li>prettier自动格式化代码</li> <li>提交代码，代码检查hook</li> <li>遵循semver版本规范
大家应该也可以看出来，在开发这种工程的过程的，最为重要的一点就是规范。因为应用场景各种各样，你必须保证发布的packge是规范的，代码是规范的，一切都是有迹可循的。这点我认为是非常重要的。</li></ul> <h2 id="工具整合"><a href="#工具整合" class="header-anchor">#</a> 工具整合</h2> <p>在这里引入的工具都是为了解决一个问题，就是工程和代码的规范问题。</p> <ul><li>husky</li> <li>lint-staged</li> <li>prettier</li> <li>eslint</li></ul> <h2 id="yarn-workspaces"><a href="#yarn-workspaces" class="header-anchor">#</a> yarn workspaces</h2> <h3 id="命令"><a href="#命令" class="header-anchor">#</a> 命令</h3> <h4 id="在根目录安装-npm-包-以-danger-为例"><a href="#在根目录安装-npm-包-以-danger-为例" class="header-anchor">#</a> 在根目录安装 npm 包，以 danger 为例：</h4> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>$ <span class="token function">yarn</span> <span class="token function">add</span> danger --dev -W
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><blockquote><p>本文系转载，更多详情点击<a href="http://www.sosout.com/2018/07/21/lerna-repo.html" target="_blank" rel="noopener noreferrer">原地址<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></blockquote></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/artoriaschan/edit/master/src/05.转载/01.前端精读评论/01.lerna-repo.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <div class="tags"><a href="/tags/?tag=Lerna" title="标签">#Lerna</a><a href="/tags/?tag=Monorepo" title="标签">#Monorepo</a></div> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2022/07/23, 17:53:01</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/pages/a852b5/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">精读《Immer.js》源码</div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/pages/a852b5/">精读《Immer.js》源码</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><div class="icons"><a href="mailto:dalecracker@gmail.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/artoriaschan" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2018-2022
    <span>Artorias Chan | <a href="https://raw.githubusercontent.com/artoriaschan/blog/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <div class="body-bg" style="background:url() center center / cover no-repeat;opacity:0.5;"></div> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.c17531b4.js" defer></script><script src="/assets/js/2.3e7b8786.js" defer></script><script src="/assets/js/22.9bd77fe5.js" defer></script>
  </body>
</html>